<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 4 Classification | Remote Sensing in the Social Sciences</title>
  <meta name="description" content="Lab 4 Classification | Remote Sensing in the Social Sciences" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 4 Classification | Remote Sensing in the Social Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 4 Classification | Remote Sensing in the Social Sciences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lab3.html"/>

<script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html"><i class="fa fa-check"></i>PreLab: Getting Started</a><ul>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="0.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#data-and-methods"><i class="fa fa-check"></i><b>0.1</b> Data and Methods</a></li>
<li class="chapter" data-level="0.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images-and-image-collections"><i class="fa fa-check"></i><b>0.2</b> Images and Image Collections</a><ul>
<li class="chapter" data-level="0.2.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images"><i class="fa fa-check"></i><b>0.2.1</b> Images</a></li>
<li class="chapter" data-level="0.2.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#image-collections"><i class="fa fa-check"></i><b>0.2.2</b> Image Collections</a></li>
<li class="chapter" data-level="0.2.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#sensed-versus-derived-imagery"><i class="fa fa-check"></i><b>0.2.3</b> Sensed versus Derived Imagery</a></li>
</ul></li>
<li class="chapter" data-level="0.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#geometries"><i class="fa fa-check"></i><b>0.3</b> Geometries</a></li>
<li class="chapter" data-level="0.4" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features-and-feature-collections"><i class="fa fa-check"></i><b>0.4</b> Features and Feature Collections</a><ul>
<li class="chapter" data-level="0.4.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features"><i class="fa fa-check"></i><b>0.4.1</b> Features</a></li>
<li class="chapter" data-level="0.4.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#feature-collections"><i class="fa fa-check"></i><b>0.4.2</b> Feature Collections</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#methods-reducers"><i class="fa fa-check"></i><b>0.5</b> Methods: Reducers</a></li>
<li class="chapter" data-level="0.6" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#joins-and-arrays"><i class="fa fa-check"></i><b>0.6</b> Joins and Arrays</a><ul>
<li class="chapter" data-level="0.6.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#join"><i class="fa fa-check"></i><b>0.6.1</b> Join</a></li>
<li class="chapter" data-level="0.6.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#arrays"><i class="fa fa-check"></i><b>0.6.2</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#additional-resources"><i class="fa fa-check"></i><b>0.7</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="lab1.html"><a href="lab1.html"><i class="fa fa-check"></i><b>1</b> Remote Sensing Background</a><ul>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1.1" data-path="lab1.html"><a href="lab1.html#what-is-a-digital-image"><i class="fa fa-check"></i><b>1.1</b> What is a digital image?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="lab1.html"><a href="lab1.html#from-digital-image-to-geospatial-image"><i class="fa fa-check"></i><b>1.1.1</b> From digital image to geospatial image</a></li>
<li class="chapter" data-level="1.1.2" data-path="lab1.html"><a href="lab1.html#visualize-a-digital-image"><i class="fa fa-check"></i><b>1.1.2</b> Visualize a Digital Image</a></li>
<li class="chapter" data-level="1.1.3" data-path="lab1.html"><a href="lab1.html#digital-image-visualization-and-stretching"><i class="fa fa-check"></i><b>1.1.3</b> Digital Image Visualization and Stretching</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="lab1.html"><a href="lab1.html#spatial-resolution"><i class="fa fa-check"></i><b>1.2</b> Spatial Resolution</a><ul>
<li class="chapter" data-level="1.2.1" data-path="lab1.html"><a href="lab1.html#modis"><i class="fa fa-check"></i><b>1.2.1</b> MODIS</a></li>
<li class="chapter" data-level="1.2.2" data-path="lab1.html"><a href="lab1.html#multispectral-scanners"><i class="fa fa-check"></i><b>1.2.2</b> Multispectral Scanners</a></li>
<li class="chapter" data-level="1.2.3" data-path="lab1.html"><a href="lab1.html#thematic-mapper-tm"><i class="fa fa-check"></i><b>1.2.3</b> Thematic Mapper (TM)</a></li>
<li class="chapter" data-level="1.2.4" data-path="lab1.html"><a href="lab1.html#national-agriculture-imagery-program-naip"><i class="fa fa-check"></i><b>1.2.4</b> National Agriculture Imagery Program (NAIP)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="lab1.html"><a href="lab1.html#spectral-resolution"><i class="fa fa-check"></i><b>1.3</b> Spectral Resolution</a></li>
<li class="chapter" data-level="1.4" data-path="lab1.html"><a href="lab1.html#temporal-resolution"><i class="fa fa-check"></i><b>1.4</b> Temporal Resolution</a><ul>
<li class="chapter" data-level="1.4.1" data-path="lab1.html"><a href="lab1.html#modis-1"><i class="fa fa-check"></i><b>1.4.1</b> MODIS</a></li>
<li class="chapter" data-level="1.4.2" data-path="lab1.html"><a href="lab1.html#landsat"><i class="fa fa-check"></i><b>1.4.2</b> Landsat</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="lab1.html"><a href="lab1.html#radiometric-resolution"><i class="fa fa-check"></i><b>1.5</b> Radiometric Resolution</a></li>
<li class="chapter" data-level="1.6" data-path="lab1.html"><a href="lab1.html#resampling-and-reprojection"><i class="fa fa-check"></i><b>1.6</b> Resampling and ReProjection</a></li>
<li class="chapter" data-level="1.7" data-path="lab1.html"><a href="lab1.html#additional-exercises"><i class="fa fa-check"></i><b>1.7</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#where-to-submit"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab2.html"><a href="lab2.html"><i class="fa fa-check"></i><b>2</b> Digital Imagery &amp; Image Processing</a><ul>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#overview-2"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="2.1" data-path="lab2.html"><a href="lab2.html#searching-for-imagery-exercise-1"><i class="fa fa-check"></i><b>2.1</b> Searching for Imagery (Exercise 1)</a></li>
<li class="chapter" data-level="2.2" data-path="lab2.html"><a href="lab2.html#visualizing-landsat-imagery"><i class="fa fa-check"></i><b>2.2</b> Visualizing Landsat Imagery</a></li>
<li class="chapter" data-level="2.3" data-path="lab2.html"><a href="lab2.html#plot-at-sensor-radiance"><i class="fa fa-check"></i><b>2.3</b> Plot at-Sensor Radiance</a></li>
<li class="chapter" data-level="2.4" data-path="lab2.html"><a href="lab2.html#plot-top-of-atmosphere-toa-reflectance"><i class="fa fa-check"></i><b>2.4</b> Plot Top-of-Atmosphere (TOA) Reflectance</a></li>
<li class="chapter" data-level="2.5" data-path="lab2.html"><a href="lab2.html#plot-surface-reflectance"><i class="fa fa-check"></i><b>2.5</b> Plot Surface Reflectance</a></li>
<li class="chapter" data-level="2.6" data-path="lab2.html"><a href="lab2.html#additional-exercises-1"><i class="fa fa-check"></i><b>2.6</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#where-to-submit-1"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab3.html"><a href="lab3.html"><i class="fa fa-check"></i><b>3</b> Spectral Indices &amp; Transformations</a><ul>
<li class="chapter" data-level="" data-path="lab3.html"><a href="lab3.html#overview-3"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="3.1" data-path="lab3.html"><a href="lab3.html#spectral-indices"><i class="fa fa-check"></i><b>3.1</b> Spectral Indices</a><ul>
<li class="chapter" data-level="3.1.1" data-path="lab3.html"><a href="lab3.html#important-indices"><i class="fa fa-check"></i><b>3.1.1</b> Important Indices</a></li>
<li class="chapter" data-level="3.1.2" data-path="lab3.html"><a href="lab3.html#linear-transformations"><i class="fa fa-check"></i><b>3.1.2</b> Linear Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="lab3.html"><a href="lab3.html#spectral-transformation"><i class="fa fa-check"></i><b>3.2</b> Spectral Transformation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="lab3.html"><a href="lab3.html#linear-filtering"><i class="fa fa-check"></i><b>3.2.1</b> Linear Filtering</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="lab3.html"><a href="lab3.html#additional-exercises-2"><i class="fa fa-check"></i><b>3.3</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab3.html"><a href="lab3.html#where-to-submit-2"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab4.html"><a href="lab4.html"><i class="fa fa-check"></i><b>4</b> Classification</a><ul>
<li class="chapter" data-level="" data-path="lab4.html"><a href="lab4.html#overview-4"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="4.1" data-path="lab4.html"><a href="lab4.html#unsupervised-classification"><i class="fa fa-check"></i><b>4.1</b> Unsupervised Classification</a></li>
<li class="chapter" data-level="4.2" data-path="lab4.html"><a href="lab4.html#supervised-classification"><i class="fa fa-check"></i><b>4.2</b> Supervised Classification</a></li>
<li class="chapter" data-level="4.3" data-path="lab4.html"><a href="lab4.html#accuracy-assessment"><i class="fa fa-check"></i><b>4.3</b> Accuracy Assessment</a></li>
<li class="chapter" data-level="4.4" data-path="lab4.html"><a href="lab4.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>4.4</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="4.5" data-path="lab4.html"><a href="lab4.html#additional-exercises-3"><i class="fa fa-check"></i><b>4.5</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab4.html"><a href="lab4.html#where-to-submit-3"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Remote Sensing in the Social Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab4" class="section level1">
<h1><span class="header-section-number">Lab 4</span> Classification</h1>
<div id="overview-4" class="section level2 unnumbered">
<h2>Overview</h2>
<p>Although humans can look at a satellite image and identify objects or land cover types based on their visual characteristics, it’s typically both difficult and time consuming to do this consistently across large areas. To aid in this process, computers can employ a variety of machine learning techniques to more quickly evaluate patterns in the data and yield insights about what we can “see” in the imagery. Understanding image classification is an essential part of contemporary remote sensing, and opportunities abound for work in this growing field.</p>
<!-- By training ML models to efficiently process the underlying data and return labeled information, we can focus on the insights that this information affords.  -->
<p>Google Earth Engine offers many different types of classification approaches. At a high level, we can think of classification as a way of “predicting” labels to attach to a given series of pixels. In this lab we will explore two main types of classification - supervised and unsupervised, and you become more familiar with the processes of training data collection, classifier selection, classifier training, and accuracy assessment. At completion, you should be able to apply these skills to assess change in a given area.</p>
<!-- We will introduce both components and work our way through several examples.  -->
<!-- ## Introduction to Classification -->
<p>Within the context of image (land use) classification, let us define prediction as guessing the value of some geographic variable of interest <code>g</code>, using a function <code>G</code> that takes as input a pixel vector <strong><code>p</code></strong>:</p>
<p><span class="math display">\[
G_{t}(p_{i}) = g_{i}
\]</span>
The <em>i</em> in this equation refers to a particular instance from a set of pixels. Think of <em>G</em> as a guessing function and <span class="math inline">\(g_{i}\)</span> as the guess for pixel <em>i</em>. The <strong>T</strong> in the subscript of <em>G</em> refers to a <em>training set</em> (a set of known values for <strong>p</strong> and the correct <em>g</em>), used to infer the structure of <em>G</em>. You have to choose a suitable <em>G</em> to train with <strong>T</strong>.</p>
<p>When <code>g</code> is nominal, or a fixed category (ex., <code>{'water', 'vegetation', 'bare'}</code>), we call this classification. When <code>g</code> is numeric (ex., <code>{0, 1, 2, 3}</code>), we call this regression.</p>
<p>This is a very generalized description of the types problem addressed in a broad range of fields including mathematics, statistics, data mining, machine learning. For our purposes, we will go through some examples using these concepts in Google Earth Engine and then provide more resources for further reading at the end.</p>
</div>
<div id="unsupervised-classification" class="section level2">
<h2><span class="header-section-number">4.1</span> Unsupervised Classification</h2>
<p>Unsupervised classification finds unique groupings in the dataset without the need for training data. The computer will cycle through the pixels, look at the characteristics of the different bands you instruct it to view, and pixel-by-pixel begin to group information together. Perhaps pixels with a blue hue and a low NIR value are grouped together, while green-dominant pixels are also grouped together. The outcome of unsupervised classification is that each pixel is categorized within the context of the image, and there will be the number of categories specified. One important note, is that the number of clusters is set by the user, and this plays a major role in how the algorithm operates. Too many clusters may create unnecessary noise, while too few clusters may not have sufficient granularity.</p>
<p>Google Earth Engine provides <a href="https://developers.google.com/earth-engine/guides/clustering">documentation</a> on working with unsupervised classification within their ecosystem, and we will be focusing on the <code>ee.Clusterer</code> package, which provides a flexible unsupervised classification (or clustering) in an easy-to-use way.</p>
<!-- Clusterers are used in the same manner as classifiers in Earth Engine. -->
<p>The general workflow for clustering is as follows:</p>
<ol style="list-style-type: decimal">
<li>Assemble features with numeric properties you want as inputs for your clusterer</li>
<li>Instantiate a clusterer and set its parameters if necessary (e.g., number of clusters)</li>
<li>“Train” (build/run) the clusterer model by indicating which data it should use</li>
<li>Apply the clusterer to predict the values in an image or feature collection</li>
<li>Assign a label the clusters</li>
</ol>
<p>Note that in this case, ‘train’ means to develop/run the model. Begin by creating a study region - in this case we will be working the Brazilian Amazon.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="lab4.html#cb1-1"></a><span class="co">// Lab: Unsupervised Classification (Clustering)</span></span>
<span id="cb1-2"><a href="lab4.html#cb1-2"></a><span class="co">// Create region</span></span>
<span id="cb1-3"><a href="lab4.html#cb1-3"></a><span class="kw">var</span> region <span class="op">=</span>  <span class="va">ee</span>.<span class="va">Geometry</span>.<span class="at">Polygon</span>([[</span>
<span id="cb1-4"><a href="lab4.html#cb1-4"></a>  [<span class="op">-</span><span class="fl">54.07419968695418</span><span class="op">,</span> <span class="fl">-3.558053010380929</span>]<span class="op">,</span></span>
<span id="cb1-5"><a href="lab4.html#cb1-5"></a>  [<span class="op">-</span><span class="fl">54.07419968695418</span><span class="op">,</span> <span class="fl">-3.8321399733300234</span>]<span class="op">,</span></span>
<span id="cb1-6"><a href="lab4.html#cb1-6"></a>  [<span class="op">-</span><span class="fl">53.14310837836043</span><span class="op">,</span> <span class="fl">-3.8321399733300234</span>]<span class="op">,</span></span>
<span id="cb1-7"><a href="lab4.html#cb1-7"></a>  [<span class="op">-</span><span class="fl">53.14310837836043</span><span class="op">,</span> <span class="fl">-3.558053010380929</span>]]]<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-8"><a href="lab4.html#cb1-8"></a><span class="va">Map</span>.<span class="at">addLayer</span>(region<span class="op">,</span> <span class="op">{},</span> <span class="st">&quot;Region&quot;</span>)<span class="op">;</span></span>
<span id="cb1-9"><a href="lab4.html#cb1-9"></a><span class="va">Map</span>.<span class="at">centerObject</span>(region<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span></code></pre></div>
<p>Now let’s add in a function to mask clouds and cloud shadows.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="lab4.html#cb2-1"></a><span class="co">// Function to mask clouds based on the pixel_qa band of Landsat 8 SR data.</span></span>
<span id="cb2-2"><a href="lab4.html#cb2-2"></a><span class="kw">function</span> <span class="at">maskL8sr</span>(image) <span class="op">{</span></span>
<span id="cb2-3"><a href="lab4.html#cb2-3"></a><span class="co">// Bits 3 and 5 are cloud shadow and cloud, respectively.</span></span>
<span id="cb2-4"><a href="lab4.html#cb2-4"></a>        <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb2-5"><a href="lab4.html#cb2-5"></a>        <span class="kw">var</span> cloudsBitMask <span class="op">=</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb2-6"><a href="lab4.html#cb2-6"></a>        <span class="co">// Get the pixel QA band.</span></span>
<span id="cb2-7"><a href="lab4.html#cb2-7"></a>        <span class="kw">var</span> qa <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb2-8"><a href="lab4.html#cb2-8"></a>        <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb2-9"><a href="lab4.html#cb2-9"></a>        <span class="kw">var</span> mask <span class="op">=</span> <span class="va">qa</span>.<span class="at">bitwiseAnd</span>(cloudShadowBitMask).<span class="at">eq</span>(<span class="dv">0</span>)</span>
<span id="cb2-10"><a href="lab4.html#cb2-10"></a>                .<span class="at">and</span>(<span class="va">qa</span>.<span class="at">bitwiseAnd</span>(cloudsBitMask).<span class="at">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb2-11"><a href="lab4.html#cb2-11"></a>           <span class="cf">return</span> <span class="va">image</span>.<span class="at">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb2-12"><a href="lab4.html#cb2-12"></a><span class="op">}</span></span></code></pre></div>
<p>Import Landsat 8 data, filter the data to the date range, apply the function to mask out pixels with clouds or cloud shadows rendering them unclear, and let’s start to work within the study region.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="lab4.html#cb3-1"></a><span class="co">// Load Landsat 8 annual composites.</span></span>
<span id="cb3-2"><a href="lab4.html#cb3-2"></a><span class="kw">var</span> landsat <span class="op">=</span> <span class="va">ee</span>.<span class="at">ImageCollection</span>(<span class="st">&#39;LANDSAT/LC08/C01/T1_SR&#39;</span>)</span>
<span id="cb3-3"><a href="lab4.html#cb3-3"></a>      .<span class="at">filterDate</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2019-12-31&#39;</span>)</span>
<span id="cb3-4"><a href="lab4.html#cb3-4"></a>      .<span class="at">map</span>(maskL8sr)</span>
<span id="cb3-5"><a href="lab4.html#cb3-5"></a>      .<span class="at">filterBounds</span>(region)</span>
<span id="cb3-6"><a href="lab4.html#cb3-6"></a>      .<span class="at">median</span>()<span class="op">;</span></span>
<span id="cb3-7"><a href="lab4.html#cb3-7"></a><span class="co">//Display Landsat data</span></span>
<span id="cb3-8"><a href="lab4.html#cb3-8"></a><span class="kw">var</span> visParams <span class="op">=</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="lab4.html#cb3-9"></a>       <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb3-10"><a href="lab4.html#cb3-10"></a>       <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb3-11"><a href="lab4.html#cb3-11"></a>       <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb3-12"><a href="lab4.html#cb3-12"></a>       <span class="dt">gamma</span><span class="op">:</span> <span class="fl">1.4</span><span class="op">,</span></span>
<span id="cb3-13"><a href="lab4.html#cb3-13"></a><span class="op">};</span></span>
<span id="cb3-14"><a href="lab4.html#cb3-14"></a><span class="va">Map</span>.<span class="at">centerObject</span>(region<span class="op">,</span> <span class="dv">9</span>)<span class="op">;</span></span>
<span id="cb3-15"><a href="lab4.html#cb3-15"></a><span class="va">Map</span>.<span class="at">addLayer</span>(landsat<span class="op">,</span> visParams<span class="op">,</span> <span class="st">&quot;Landsat 8 (2016)&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>In this example, we will randomly sample 5000 pixels in the region to build a clustering model - we will use this ‘training’ data to find clustering groups and then apply it to predict values in the rest of the data. We will also set the variable <code>clusterNum</code> to identify how many categories to use. Start with 15, and modify based on the output and needs of your experiment. Note that we are using <code>ee.Clusterer.wekaKMeans</code>, which is a form of k-means clustering.</p>
<p>In brief, k-means clustering is one of the simplest and most common unsupervised learning algorithms. The k-means algorithm identifies k number of centroids, and then allocates every data point to the nearest cluster, while keeping the centroids as small as possible.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="lab4.html#cb4-1"></a><span class="co">// Create a training dataset.</span></span>
<span id="cb4-2"><a href="lab4.html#cb4-2"></a><span class="kw">var</span> training <span class="op">=</span> <span class="va">landsat</span>.<span class="at">sample</span>(<span class="op">{</span></span>
<span id="cb4-3"><a href="lab4.html#cb4-3"></a>     <span class="dt">region</span><span class="op">:</span> region<span class="op">,</span></span>
<span id="cb4-4"><a href="lab4.html#cb4-4"></a>     <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb4-5"><a href="lab4.html#cb4-5"></a>     <span class="dt">numPixels</span><span class="op">:</span> <span class="dv">5000</span></span>
<span id="cb4-6"><a href="lab4.html#cb4-6"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="lab4.html#cb4-7"></a><span class="kw">var</span> clusterNum <span class="op">=</span> <span class="dv">15</span>  </span>
<span id="cb4-8"><a href="lab4.html#cb4-8"></a><span class="co">// Instantiate the clusterer and train it.</span></span>
<span id="cb4-9"><a href="lab4.html#cb4-9"></a><span class="kw">var</span> clusterer <span class="op">=</span> <span class="va">ee</span>.<span class="va">Clusterer</span>.<span class="at">wekaKMeans</span>(clusterNum).<span class="at">train</span>(training)<span class="op">;</span></span>
<span id="cb4-10"><a href="lab4.html#cb4-10"></a><span class="co">// Cluster the input using the trained clusterer.</span></span>
<span id="cb4-11"><a href="lab4.html#cb4-11"></a><span class="kw">var</span> result <span class="op">=</span> <span class="va">landsat</span>.<span class="at">cluster</span>(clusterer)<span class="op">;</span></span>
<span id="cb4-12"><a href="lab4.html#cb4-12"></a><span class="at">print</span>(<span class="st">&quot;result&quot;</span><span class="op">,</span> <span class="va">result</span>.<span class="at">getInfo</span>())<span class="op">;</span></span>
<span id="cb4-13"><a href="lab4.html#cb4-13"></a><span class="co">// Display the clusters with random colors.</span></span>
<span id="cb4-14"><a href="lab4.html#cb4-14"></a><span class="va">Map</span>.<span class="at">addLayer</span>(<span class="va">result</span>.<span class="at">randomVisualizer</span>()<span class="op">,</span> <span class="op">{},</span> <span class="st">&#39;Unsupervised Classification&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>The resulting output shows a vivid display of colors. Under ‘Layers’, toggle the top-right of the map section and increase the transparency of the layer so as compare the classifed image to the natural color satellite imagery.</p>
<p>Change the value of <code>clusterNum</code> and run through some different options to evaluate the impact of varying this input. Note that the output of an unsupervised clustering model is not specifying that each pixel should be a certain type of label (ex, the pixel is ‘water’), but rather that these pixels have similar characteristics.</p>
<!-- **Question**: If you were going to use a clustering model to identify water in the image, is 15 an appropriate cluster number?  -->
<hr />
<p><i class="fa fa-file"></i> <strong>1. If you were going to use a clustering model to identify water in the image, is 15 an appropriate cluster number? What process or features would you look for to determine what an appropriate cluster number would be? What do you see when you adjust the number of clusters in this region?</strong></p>
<hr />
</div>
<div id="supervised-classification" class="section level2">
<h2><span class="header-section-number">4.2</span> Supervised Classification</h2>
<p>Supervised classification is an iterative process of obtaining training data, creating an initial model, reviewing the results and tuning the parameters. Many projects using supervised classification may take several months of years of fine-tuning, requiring constant refinement and maintenance. Below is a list of the steps of Supervised Learning according to GEE’s <a href="https://developers.google.com/earth-engine/classification">documentation</a>:
<!-- Just like in unsupervised classification, GEE offers [documentation](https://developers.google.com/earth-engine/classification) that provides several additions examples. --></p>
<ol style="list-style-type: decimal">
<li>Collect the training data</li>
<li>Instantiate the classifier</li>
<li>Train the classifier</li>
<li>Classify the image</li>
<li>Tune the model</li>
</ol>
<p>We will begin by creating training data manually within GEE. Using the geometry tools and the Landsat composite as a background, we can digitize training polygons. We’ll need to do two things: identify where polygons occur on the ground, and label them with the proper class number.</p>
<ol style="list-style-type: decimal">
<li>Draw a polygon around an area of bare earth (dirt, no vegetation), then <a href="https://developers.google.com/earth-engine/playground#geometry-tools">configure the import</a>. Import as FeatureCollection, then click <strong><code>+ New property</code></strong>. Name the new property ‘class’ and give it a value of 0. The dialog should show <strong>class</strong>: 0. Name the import ‘bare’.</li>
<li><strong><code>+ New property</code></strong> &gt; Draw a polygon around vegetation &gt; import as FeatureCollection &gt; add a property &gt; name it ‘class’ and give it a value of 1. Name the import ‘vegetation’.</li>
<li><strong><code>+ New property</code></strong> &gt; Draw a polygon around water &gt; import as FeatureCollection &gt; add a property &gt; name it ‘class’ and give it a value of 2. Name the import ‘water’.</li>
<li>You should have three FeatureCollection imports named ‘bare’, ‘vegetation’ and ‘water’. Merge them into one FeatureCollection:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="lab4.html#cb5-1"></a><span class="kw">var</span> trainingFeatures <span class="op">=</span> <span class="va">bare</span>.<span class="at">merge</span>(vegetation).<span class="at">merge</span>(water)<span class="op">;</span></span></code></pre></div>
<p>In the merged <code>FeatureCollection</code>, each Feature should have a property called ‘class’ where the classes are consecutive integers, one for each class, starting at 0. Verify that this is true.</p>
<p>For Landsat, we will use the following bands for their predictive values - we could just keep the visual bands, but using a larger number of predictive values in many cases improves the model’s ability to find relationships and patterns in the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="lab4.html#cb6-1"></a><span class="kw">var</span> predictionBands <span class="op">=</span> [<span class="st">&#39;B2&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;B6&#39;</span><span class="op">,</span> <span class="st">&#39;B7&#39;</span><span class="op">,</span> <span class="st">&#39;B10&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>]<span class="op">;</span></span></code></pre></div>
<p>Create a training set <strong>T</strong> for the classifier by sampling the Landsat composite with the merged features.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="lab4.html#cb7-1"></a><span class="kw">var</span> classifierTraining <span class="op">=</span> <span class="va">landsat</span>.<span class="at">select</span>(predictionBands)</span>
<span id="cb7-2"><a href="lab4.html#cb7-2"></a>  .<span class="at">sampleRegions</span>(<span class="op">{</span></span>
<span id="cb7-3"><a href="lab4.html#cb7-3"></a>   <span class="dt">collection</span><span class="op">:</span> trainingFeatures<span class="op">,</span> </span>
<span id="cb7-4"><a href="lab4.html#cb7-4"></a>   <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;class&#39;</span>]<span class="op">,</span> </span>
<span id="cb7-5"><a href="lab4.html#cb7-5"></a>   <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span></span>
<span id="cb7-6"><a href="lab4.html#cb7-6"></a>  <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>The choice of classifier is not always obvious, but a Classification and Regression Tree – often abbreviated as CART (a <a href="https://en.wikipedia.org/wiki/Decision_tree_learning">decision tree</a> when running in classification mode) is an excellent starting point. Instantiate a CART and train it.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="lab4.html#cb8-1"></a><span class="kw">var</span> classifier <span class="op">=</span> <span class="va">ee</span>.<span class="va">Classifier</span>.<span class="at">smileCart</span>().<span class="at">train</span>(<span class="op">{</span></span>
<span id="cb8-2"><a href="lab4.html#cb8-2"></a> <span class="dt">features</span><span class="op">:</span> classifierTraining<span class="op">,</span> </span>
<span id="cb8-3"><a href="lab4.html#cb8-3"></a> <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span> </span>
<span id="cb8-4"><a href="lab4.html#cb8-4"></a> <span class="dt">inputProperties</span><span class="op">:</span> predictionBands</span>
<span id="cb8-5"><a href="lab4.html#cb8-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Classify the image and display the output.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="lab4.html#cb9-1"></a><span class="kw">var</span> classified <span class="op">=</span> <span class="va">landsat</span>.<span class="at">select</span>(predictionBands)</span>
<span id="cb9-2"><a href="lab4.html#cb9-2"></a>                .<span class="at">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb9-3"><a href="lab4.html#cb9-3"></a><span class="va">Map</span>.<span class="at">addLayer</span>(classified<span class="op">,</span> </span>
<span id="cb9-4"><a href="lab4.html#cb9-4"></a>             <span class="op">{</span><span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> </span>
<span id="cb9-5"><a href="lab4.html#cb9-5"></a>              <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;red&#39;</span><span class="op">,</span> <span class="st">&#39;green&#39;</span><span class="op">,</span> <span class="st">&#39;blue&#39;</span>]<span class="op">},</span> </span>
<span id="cb9-6"><a href="lab4.html#cb9-6"></a>             <span class="st">&#39;classified&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Inspect the result. Some things to test if the result is unsatisfactory:</p>
<ol style="list-style-type: decimal">
<li><em>Use other classifiers</em>. Try some of the other classifiers in Earth Engine to see if the result is better or different. You can find different classifiers under <code>Docs</code> on the left panel of the console.</li>
<li><em>Different (or more) training data.</em> Try adjusting the shape and/or size of your training polygons to have a more representative sample of your classes. It is very common to either underfit or overfit your model when beginning the process.</li>
<li><em>Add more predictors.</em> For example, you can adding spectral indices to the input variables.</li>
</ol>
<hr />
<p><i class="fa fa-file"></i> <strong>2. Pursue at least two of the three options above to adjust your supervised classification. Describe what you do and how it affects your results, providing visuals where useful to support your text. </strong></p>
<hr />
</div>
<div id="accuracy-assessment" class="section level2">
<h2><span class="header-section-number">4.3</span> Accuracy Assessment</h2>
<p>The previous section asked the question whether the result is satisfactory or not. In remote sensing, the quantification of the answer is called accuracy assessment. In the regression context, a standard measure of accuracy is the <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">Root Mean Square Error</a> (RMSE) or the <a href="https://en.wikipedia.org/wiki/Correlation_and_dependence">correlation</a> between known and predicted values. (Although the RMSE is returned by the linear regression reducer, beware: this is computed from the training data and is not a fair estimate of expected prediction error when guessing a pixel not in the training set). It is testing how accurate the model is based on the existing training data, but proper methodology uses separate ground-truth values for testing. In the classification context, accuracy measurements are often derived from a <a href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a>.</p>
<p>The first step is to partition the set of known values into training and testing sets. Reusing the classification training set, add a column of random numbers used to partition the known data where about 60% of the data will be used for training and 40% for testing:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="lab4.html#cb10-1"></a><span class="kw">var</span> trainingTesting <span class="op">=</span> <span class="va">classifierTraining</span>.<span class="at">randomColumn</span>()<span class="op">;</span></span>
<span id="cb10-2"><a href="lab4.html#cb10-2"></a><span class="kw">var</span> trainingSet <span class="op">=</span> <span class="va">trainingTesting</span>.<span class="at">filter</span>(<span class="va">ee</span>.<span class="va">Filter</span>.<span class="at">lessThan</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span>  <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb10-3"><a href="lab4.html#cb10-3"></a><span class="kw">var</span> testingSet <span class="op">=</span> <span class="va">trainingTesting</span>.<span class="at">filter</span>(<span class="va">ee</span>.<span class="va">Filter</span>.<span class="at">greaterThanOrEquals</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span>  </span></code></pre></div>
<p>Train the classifier with the <code>trainingSet</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="lab4.html#cb11-1"></a><span class="kw">var</span> trained <span class="op">=</span> <span class="va">ee</span>.<span class="va">Classifier</span>.<span class="at">smileCart</span>().<span class="at">train</span>(<span class="op">{</span></span>
<span id="cb11-2"><a href="lab4.html#cb11-2"></a>  <span class="dt">features</span><span class="op">:</span> trainingSet<span class="op">,</span></span>
<span id="cb11-3"><a href="lab4.html#cb11-3"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span></span>
<span id="cb11-4"><a href="lab4.html#cb11-4"></a>  <span class="dt">inputProperties</span><span class="op">:</span> predictionBands</span>
<span id="cb11-5"><a href="lab4.html#cb11-5"></a><span class="op">}</span>)<span class="op">;</span>  </span></code></pre></div>
<p>Classify the <code>testingSet</code> and get a confusion matrix. Note that the classifier automatically adds a property called ‘classification’, which is compared to the ‘class’ property added when you imported your polygons:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="lab4.html#cb12-1"></a><span class="kw">var</span> confusionMatrix <span class="op">=</span>  <span class="va">ee</span>.<span class="at">ConfusionMatrix</span>(<span class="va">testingSet</span>.<span class="at">classify</span>(trained)</span>
<span id="cb12-2"><a href="lab4.html#cb12-2"></a>                                          .<span class="at">errorMatrix</span>(<span class="op">{</span><span class="dt">actual</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span></span>
<span id="cb12-3"><a href="lab4.html#cb12-3"></a>                                                        <span class="dt">predicted</span><span class="op">:</span> <span class="st">&#39;classification&#39;</span><span class="op">}</span>))<span class="op">;</span>  </span></code></pre></div>
<p>Print the confusion (error) matrix and expand the object to inspect the matrix. The entries represent the number of pixels. Items on the diagonal represent correct classification. Items off the diagonal are misclassifications, where the class in row <em>i</em> is classified as column <em>j</em>. It’s also possible to get basic descriptive statistics from the confusion matrix. For example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="lab4.html#cb13-1"></a><span class="at">print</span>(<span class="st">&#39;Confusion matrix:&#39;</span><span class="op">,</span> confusionMatrix)<span class="op">;</span></span>
<span id="cb13-2"><a href="lab4.html#cb13-2"></a><span class="at">print</span>(<span class="st">&#39;Overall Accuracy:&#39;</span><span class="op">,</span> <span class="va">confusionMatrix</span>.<span class="at">accuracy</span>())<span class="op">;</span></span>
<span id="cb13-3"><a href="lab4.html#cb13-3"></a><span class="at">print</span>(<span class="st">&#39;Producers Accuracy:&#39;</span><span class="op">,</span> <span class="va">confusionMatrix</span>.<span class="at">producersAccuracy</span>())<span class="op">;</span></span>
<span id="cb13-4"><a href="lab4.html#cb13-4"></a><span class="at">print</span>(<span class="st">&#39;Consumers Accuracy:&#39;</span><span class="op">,</span> <span class="va">confusionMatrix</span>.<span class="at">consumersAccuracy</span>())<span class="op">;</span>  </span></code></pre></div>
<p>Note that you can test different classifiers by replacing CART with some other classifier of interest. Also note that as a result of the randomness in the partition, you may get different results from different runs.</p>
<hr />
<p><i class="fa fa-file"></i> <strong>3. Upload your confusion (error) matrix for your preferred classification and describe the content of the table in terms of overall accuracy as well as user and producer error. </strong></p>
<hr />
</div>
<div id="hyperparameter-tuning" class="section level2">
<h2><span class="header-section-number">4.4</span> Hyperparameter Tuning</h2>
<p>Another fancy classifier is called a random forest (<a href="https://link.springer.com/article/10.1023/A:1010933404324">Breiman 2001</a>). A random forest is a ensemble model consisting of many decision trees that only contain a random selection of the input data. The simple logic underpinning random forests is that individual predictions from decision trees may not be accurate, but once combined, the average predictions from the trees will more closely approximate the truth.
<!-- , or a collection of random trees in that the predictions are used to compute an average (regression) or vote on a label (classification).  -->
Random forests can be used for both computing averages (regression) or determining labels (classification), and they rank among some of the most common as well as high-performing classification approahces. Because random forests tend to perform well, we need to make things a little harder for this exercise to be interesting. Let’s do that by adding noise to the training data:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="lab4.html#cb14-1"></a><span class="kw">var</span> sample <span class="op">=</span> <span class="va">landsat</span>.<span class="at">select</span>(predictionBands).<span class="at">sampleRegions</span>(</span>
<span id="cb14-2"><a href="lab4.html#cb14-2"></a>  <span class="op">{</span><span class="dt">collection</span><span class="op">:</span> trainingFeatures</span>
<span id="cb14-3"><a href="lab4.html#cb14-3"></a>   .<span class="at">map</span>(<span class="kw">function</span>(f) <span class="op">{</span></span>
<span id="cb14-4"><a href="lab4.html#cb14-4"></a>    <span class="cf">return</span>  <span class="va">f</span>.<span class="at">buffer</span>(<span class="dv">300</span>)</span>
<span id="cb14-5"><a href="lab4.html#cb14-5"></a>   <span class="op">}</span></span>
<span id="cb14-6"><a href="lab4.html#cb14-6"></a>       )<span class="op">,</span> <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;class&#39;</span>]<span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">}</span>)<span class="op">;</span>  </span>
<span id="cb14-7"><a href="lab4.html#cb14-7"></a><span class="kw">var</span> classifier <span class="op">=</span>  <span class="va">ee</span>.<span class="va">Classifier</span>.<span class="at">smileRandomForest</span>(<span class="dv">10</span>)</span>
<span id="cb14-8"><a href="lab4.html#cb14-8"></a>                .<span class="at">train</span>(<span class="op">{</span><span class="dt">features</span><span class="op">:</span> sample<span class="op">,</span></span>
<span id="cb14-9"><a href="lab4.html#cb14-9"></a>                <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span></span>
<span id="cb14-10"><a href="lab4.html#cb14-10"></a>                <span class="dt">inputProperties</span><span class="op">:</span> predictionBands</span>
<span id="cb14-11"><a href="lab4.html#cb14-11"></a>               <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb14-12"><a href="lab4.html#cb14-12"></a><span class="kw">var</span> classified <span class="op">=</span>  <span class="va">landsat</span>.<span class="at">select</span>(predictionBands).<span class="at">classify</span>(classifier)<span class="op">;</span>   <span class="va">Map</span>.<span class="at">addLayer</span>(classified<span class="op">,</span> <span class="op">{</span><span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span>  <span class="dt">palette</span><span class="op">:</span> </span>
<span id="cb14-13"><a href="lab4.html#cb14-13"></a>             [<span class="st">&#39;red&#39;</span><span class="op">,</span> <span class="st">&#39;green&#39;</span><span class="op">,</span> <span class="st">&#39;blue&#39;</span>]<span class="op">},</span> <span class="st">&#39;classified&#39;</span>)                                                                     </span></code></pre></div>
<p>Note that the only parameter to the classifier is the number of trees (10). How many trees should you use? Making that choice is often done through a process of choosing ‘optimal’ model arguments prior to running the learning algorithm – the process often called hyperparameter tuning. For example,</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="lab4.html#cb15-1"></a><span class="kw">var</span> sample  <span class="op">=</span> <span class="va">sample</span>.<span class="at">randomColumn</span>()<span class="op">;</span></span>
<span id="cb15-2"><a href="lab4.html#cb15-2"></a><span class="kw">var</span> train <span class="op">=</span> <span class="va">sample</span>.<span class="at">filter</span>(<span class="va">ee</span>.<span class="va">Filter</span>.<span class="at">lt</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb15-3"><a href="lab4.html#cb15-3"></a><span class="kw">var</span> test <span class="op">=</span> <span class="va">sample</span>.<span class="at">filter</span>(<span class="va">ee</span>.<span class="va">Filter</span>.<span class="at">gte</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb15-4"><a href="lab4.html#cb15-4"></a><span class="kw">var</span> numTrees <span class="op">=</span> <span class="va">ee</span>.<span class="va">List</span>.<span class="at">sequence</span>(<span class="dv">5</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb15-5"><a href="lab4.html#cb15-5"></a><span class="kw">var</span> accuracies <span class="op">=</span> <span class="va">numTrees</span>.<span class="at">map</span>(<span class="kw">function</span>(t) <span class="op">{</span></span>
<span id="cb15-6"><a href="lab4.html#cb15-6"></a><span class="kw">var</span> classifier <span class="op">=</span>  <span class="va">ee</span>.<span class="va">Classifier</span>.<span class="at">smileRandomForest</span>(t)</span>
<span id="cb15-7"><a href="lab4.html#cb15-7"></a>                .<span class="at">train</span>(<span class="op">{</span></span>
<span id="cb15-8"><a href="lab4.html#cb15-8"></a>          <span class="dt">features</span><span class="op">:</span> train<span class="op">,</span></span>
<span id="cb15-9"><a href="lab4.html#cb15-9"></a>          <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span></span>
<span id="cb15-10"><a href="lab4.html#cb15-10"></a>          <span class="dt">inputProperties</span><span class="op">:</span> predictionBands</span>
<span id="cb15-11"><a href="lab4.html#cb15-11"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb15-12"><a href="lab4.html#cb15-12"></a>  <span class="cf">return</span> <span class="va">test</span>.<span class="at">classify</span>(classifier)</span>
<span id="cb15-13"><a href="lab4.html#cb15-13"></a>    .<span class="at">errorMatrix</span>(<span class="st">&#39;class&#39;</span><span class="op">,</span>  <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb15-14"><a href="lab4.html#cb15-14"></a>    .<span class="at">accuracy</span>()<span class="op">;</span></span>
<span id="cb15-15"><a href="lab4.html#cb15-15"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb15-16"><a href="lab4.html#cb15-16"></a><span class="at">print</span>(<span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">array</span>.<span class="at">values</span>(<span class="op">{</span></span>
<span id="cb15-17"><a href="lab4.html#cb15-17"></a>  <span class="dt">array</span><span class="op">:</span> <span class="va">ee</span>.<span class="at">Array</span>(accuracies)<span class="op">,</span></span>
<span id="cb15-18"><a href="lab4.html#cb15-18"></a>  <span class="dt">axis</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-19"><a href="lab4.html#cb15-19"></a>  <span class="dt">xLabels</span><span class="op">:</span> numTrees</span>
<span id="cb15-20"><a href="lab4.html#cb15-20"></a><span class="op">}</span>))<span class="op">;</span>  </span></code></pre></div>
<p>You should see something like the following chart, in which the number of trees is on the x-axis and estimated accuracy is on the y-axis:</p>
<p><img src="Im_04_01.png" /></p>
<p>First, note that we always get very high accuracy in this simple example. Second, note
<!-- that while 10 is not the optimal number of trees,  -->
adding more
<!-- (up to about 20 or 30)  -->
trees eventually doesn’t yield much more accuracy for the increased computational burden we impose.</p>
<hr />
<p><i class="fa fa-file"></i> <strong>4. Upload the resulting graphic and interpret its output. </strong></p>
<hr />
<!-- Base don this graphic, 20 trees is probably a good number to use in the context of this example. -->
</div>
<div id="additional-exercises-3" class="section level2">
<h2><span class="header-section-number">4.5</span> Additional Exercises</h2>
<p>Design a four-class classification for your area of interest. Decide on suitable input data and manually collect training points (or polygons) if necessary. Tune a random forest classifier. In your code, have a variable called trees that sets the optimal number of trees according to your hyperparameter tuning process. Have a variable called <code>maxAccuracy</code> that stores the estimated accuracy for the optimal number of trees.</p>
<hr />
<p><i class="fa fa-file"></i> <strong>5. Upload your resulting classified image and describe the location and labels. Provide the confusion/error matrix for this region, the optimal number of trees, and <code>maxAccuracy</code> for the optimal number of trees. Are you satisfied with the classification output? Why or why not? </strong></p>
<hr />
</div>
<div id="where-to-submit-3" class="section level2 unnumbered">
<h2>Where to submit</h2>
<p>Submit your responses to these questions on <a href="https://www.gradescope.com/courses/293173/assignments/1446622/submissions">Gradescope</a> by 10am on Wednesday, September 30. If needed, the access code for our course is <code>6PEW3W</code>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab3.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["labs-rsss.pdf"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
