<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 8 Time Series | Remote Sensing in the Social Sciences</title>
  <meta name="description" content="Lab 8 Time Series | Remote Sensing in the Social Sciences" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 8 Time Series | Remote Sensing in the Social Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 8 Time Series | Remote Sensing in the Social Sciences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="nonlinear-regression.html"/>

<script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html"><i class="fa fa-check"></i>PreLab: Getting Started</a><ul>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="0.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#data-and-methods"><i class="fa fa-check"></i><b>0.1</b> Data and Methods</a></li>
<li class="chapter" data-level="0.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images-and-image-collections"><i class="fa fa-check"></i><b>0.2</b> Images and Image Collections</a><ul>
<li class="chapter" data-level="0.2.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images"><i class="fa fa-check"></i><b>0.2.1</b> Images</a></li>
<li class="chapter" data-level="0.2.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#image-collections"><i class="fa fa-check"></i><b>0.2.2</b> Image Collections</a></li>
<li class="chapter" data-level="0.2.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#sensed-versus-derived-imagery"><i class="fa fa-check"></i><b>0.2.3</b> Sensed versus Derived Imagery</a></li>
</ul></li>
<li class="chapter" data-level="0.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#geometries"><i class="fa fa-check"></i><b>0.3</b> Geometries</a></li>
<li class="chapter" data-level="0.4" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features-and-feature-collections"><i class="fa fa-check"></i><b>0.4</b> Features and Feature Collections</a><ul>
<li class="chapter" data-level="0.4.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features"><i class="fa fa-check"></i><b>0.4.1</b> Features</a></li>
<li class="chapter" data-level="0.4.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#feature-collections"><i class="fa fa-check"></i><b>0.4.2</b> Feature Collections</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#methods-reducers"><i class="fa fa-check"></i><b>0.5</b> Methods: Reducers</a></li>
<li class="chapter" data-level="0.6" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#joins-and-arrays"><i class="fa fa-check"></i><b>0.6</b> Joins and Arrays</a><ul>
<li class="chapter" data-level="0.6.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#join"><i class="fa fa-check"></i><b>0.6.1</b> Join</a></li>
<li class="chapter" data-level="0.6.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#arrays"><i class="fa fa-check"></i><b>0.6.2</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#additional-resources"><i class="fa fa-check"></i><b>0.7</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="lab1.html"><a href="lab1.html"><i class="fa fa-check"></i><b>1</b> Remote Sensing Background</a><ul>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1.1" data-path="lab1.html"><a href="lab1.html#what-is-a-digital-image"><i class="fa fa-check"></i><b>1.1</b> What is a digital image?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="lab1.html"><a href="lab1.html#from-digital-image-to-geospatial-image"><i class="fa fa-check"></i><b>1.1.1</b> From digital image to geospatial image</a></li>
<li class="chapter" data-level="1.1.2" data-path="lab1.html"><a href="lab1.html#visualize-a-digital-image"><i class="fa fa-check"></i><b>1.1.2</b> Visualize a Digital Image</a></li>
<li class="chapter" data-level="1.1.3" data-path="lab1.html"><a href="lab1.html#digital-image-visualization-and-stretching"><i class="fa fa-check"></i><b>1.1.3</b> Digital Image Visualization and Stretching</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="lab1.html"><a href="lab1.html#spatial-resolution"><i class="fa fa-check"></i><b>1.2</b> Spatial Resolution</a><ul>
<li class="chapter" data-level="1.2.1" data-path="lab1.html"><a href="lab1.html#modis"><i class="fa fa-check"></i><b>1.2.1</b> MODIS</a></li>
<li class="chapter" data-level="1.2.2" data-path="lab1.html"><a href="lab1.html#multispectral-scanners"><i class="fa fa-check"></i><b>1.2.2</b> Multispectral Scanners</a></li>
<li class="chapter" data-level="1.2.3" data-path="lab1.html"><a href="lab1.html#thematic-mapper-tm"><i class="fa fa-check"></i><b>1.2.3</b> Thematic Mapper (TM)</a></li>
<li class="chapter" data-level="1.2.4" data-path="lab1.html"><a href="lab1.html#national-agriculture-imagery-program-naip"><i class="fa fa-check"></i><b>1.2.4</b> National Agriculture Imagery Program (NAIP)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="lab1.html"><a href="lab1.html#spectral-resolution"><i class="fa fa-check"></i><b>1.3</b> Spectral Resolution</a></li>
<li class="chapter" data-level="1.4" data-path="lab1.html"><a href="lab1.html#temporal-resolution"><i class="fa fa-check"></i><b>1.4</b> Temporal Resolution</a><ul>
<li class="chapter" data-level="1.4.1" data-path="lab1.html"><a href="lab1.html#modis-1"><i class="fa fa-check"></i><b>1.4.1</b> MODIS</a></li>
<li class="chapter" data-level="1.4.2" data-path="lab1.html"><a href="lab1.html#landsat"><i class="fa fa-check"></i><b>1.4.2</b> Landsat</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="lab1.html"><a href="lab1.html#radiometric-resolution"><i class="fa fa-check"></i><b>1.5</b> Radiometric Resolution</a></li>
<li class="chapter" data-level="1.6" data-path="lab1.html"><a href="lab1.html#resampling-and-reprojection"><i class="fa fa-check"></i><b>1.6</b> Resampling and ReProjection</a></li>
<li class="chapter" data-level="1.7" data-path="lab1.html"><a href="lab1.html#additional-exercises"><i class="fa fa-check"></i><b>1.7</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#where-to-submit"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab2.html"><a href="lab2.html"><i class="fa fa-check"></i><b>2</b> Digital Imagery &amp; Image Processing</a><ul>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#overview-2"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="2.1" data-path="lab2.html"><a href="lab2.html#searching-for-imagery-exercise-1"><i class="fa fa-check"></i><b>2.1</b> Searching for Imagery (Exercise 1)</a></li>
<li class="chapter" data-level="2.2" data-path="lab2.html"><a href="lab2.html#visualizing-landsat-imagery"><i class="fa fa-check"></i><b>2.2</b> Visualizing Landsat Imagery</a></li>
<li class="chapter" data-level="2.3" data-path="lab2.html"><a href="lab2.html#plot-at-sensor-radiance"><i class="fa fa-check"></i><b>2.3</b> Plot at-Sensor Radiance</a></li>
<li class="chapter" data-level="2.4" data-path="lab2.html"><a href="lab2.html#plot-top-of-atmosphere-toa-reflectance"><i class="fa fa-check"></i><b>2.4</b> Plot Top-of-Atmosphere (TOA) Reflectance</a></li>
<li class="chapter" data-level="2.5" data-path="lab2.html"><a href="lab2.html#plot-surface-reflectance"><i class="fa fa-check"></i><b>2.5</b> Plot Surface Reflectance</a></li>
<li class="chapter" data-level="2.6" data-path="lab2.html"><a href="lab2.html#additional-exercises-1"><i class="fa fa-check"></i><b>2.6</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#where-to-submit-1"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab3.html"><a href="lab3.html"><i class="fa fa-check"></i><b>3</b> Spectral Indices &amp; Transformations</a><ul>
<li class="chapter" data-level="" data-path="lab3.html"><a href="lab3.html#overview-3"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="3.1" data-path="lab3.html"><a href="lab3.html#spectral-indices"><i class="fa fa-check"></i><b>3.1</b> Spectral Indices</a><ul>
<li class="chapter" data-level="3.1.1" data-path="lab3.html"><a href="lab3.html#important-indices"><i class="fa fa-check"></i><b>3.1.1</b> Important Indices</a></li>
<li class="chapter" data-level="3.1.2" data-path="lab3.html"><a href="lab3.html#linear-transformations"><i class="fa fa-check"></i><b>3.1.2</b> Linear Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="lab3.html"><a href="lab3.html#spectral-transformation"><i class="fa fa-check"></i><b>3.2</b> Spectral Transformation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="lab3.html"><a href="lab3.html#linear-filtering"><i class="fa fa-check"></i><b>3.2.1</b> Linear Filtering</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="lab3.html"><a href="lab3.html#additional-exercises-2"><i class="fa fa-check"></i><b>3.3</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab3.html"><a href="lab3.html#where-to-submit-2"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab4.html"><a href="lab4.html"><i class="fa fa-check"></i><b>4</b> Classification</a><ul>
<li class="chapter" data-level="" data-path="lab4.html"><a href="lab4.html#overview-4"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="4.1" data-path="lab4.html"><a href="lab4.html#unsupervised-classification"><i class="fa fa-check"></i><b>4.1</b> Unsupervised Classification</a></li>
<li class="chapter" data-level="4.2" data-path="lab4.html"><a href="lab4.html#supervised-classification"><i class="fa fa-check"></i><b>4.2</b> Supervised Classification</a></li>
<li class="chapter" data-level="4.3" data-path="lab4.html"><a href="lab4.html#accuracy-assessment"><i class="fa fa-check"></i><b>4.3</b> Accuracy Assessment</a></li>
<li class="chapter" data-level="4.4" data-path="lab4.html"><a href="lab4.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>4.4</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="4.5" data-path="lab4.html"><a href="lab4.html#additional-exercises-3"><i class="fa fa-check"></i><b>4.5</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab4.html"><a href="lab4.html#where-to-submit-3"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a><ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#overview-5"><i class="fa fa-check"></i>Overview</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-regression-1.html"><a href="linear-regression-1.html"><i class="fa fa-check"></i><b>6</b> Linear Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="linear-regression-1.html"><a href="linear-regression-1.html#regression"><i class="fa fa-check"></i><b>6.1</b> Regression</a><ul>
<li class="chapter" data-level="6.1.1" data-path="linear-regression-1.html"><a href="linear-regression-1.html#ordinary-least-squares-ols"><i class="fa fa-check"></i><b>6.1.1</b> Ordinary Least Squares (OLS)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>7</b> Nonlinear Regression</a></li>
<li class="chapter" data-level="8" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>8</b> Time Series</a><ul>
<li class="chapter" data-level="8.1" data-path="time-series.html"><a href="time-series.html#multi-temporal-data-in-earth-engine"><i class="fa fa-check"></i><b>8.1</b> Multi-Temporal Data in Earth Engine</a></li>
<li class="chapter" data-level="8.2" data-path="time-series.html"><a href="time-series.html#data-preparation-and-preprocessing"><i class="fa fa-check"></i><b>8.2</b> Data Preparation and Preprocessing</a></li>
<li class="chapter" data-level="8.3" data-path="time-series.html"><a href="time-series.html#linear-modeling-of-time"><i class="fa fa-check"></i><b>8.3</b> Linear Modeling of Time</a></li>
<li class="chapter" data-level="8.4" data-path="time-series.html"><a href="time-series.html#estimate-seasonality-with-a-harmonic-model"><i class="fa fa-check"></i><b>8.4</b> Estimate Seasonality with a Harmonic Model</a></li>
<li class="chapter" data-level="" data-path="time-series.html"><a href="time-series.html#where-to-submit-4"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Remote Sensing in the Social Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series" class="section level1">
<h1><span class="header-section-number">Lab 8</span> Time Series</h1>
<p><strong>Overview:</strong></p>
<p>One of the paradigm-changing features of Earth Engine is the ability to access decades of imagery without the previous limitation of needing to download, organize, store and process. Because these files can be prohibitively large, this limited most projects to viewing two or three images from different periods. With Earth Engine, users can access tens or hundreds of thousands of images to understand the context of change across decades.</p>
<p>The purpose of this lab is to establish a foundation for time series analysis of remotely sensed data, usually in the form of a temporally ordered stack of images. You will be introduced to concepts of smoothing, interpolation, linear modeling and phenology. At the completion of the lab, you will be able to perform analysis of multi-temporal data for determining trend and seasonality on a per-pixel basis.</p>
<div id="multi-temporal-data-in-earth-engine" class="section level2">
<h2><span class="header-section-number">8.1</span> Multi-Temporal Data in Earth Engine</h2>
<p>Time series in Earth Engine are represented as image collections. This can make time series analysis complicated because</p>
<ul>
<li>There is a different time series in each pixel</li>
<li>The size (length) of the time series varies across pixels</li>
<li>Missing data may occur in any pixel at any time (e.g. due to cloud masking, hardware errors)</li>
</ul>
<p>As a result of these complicating factors, analyzing time series in Earth Engine is unlike traditional methods. Specifically, use joins to define temporal relationships between collection items. As you will soon discover, it’s possible to perform many traditional time series methods by mapping functions over joined collections.
First, some very basic notation. A scalar pixel at time <em>t</em> is given by <span class="math display">\[p_{t}\]</span> and a pixel vector by <strong>p</strong><em>t</em>. An estimate is a variable with a hat on: (e.g. the estimated pixel value at time is <span class="math inline">\(p̂_{t}\)</span>). A time series is just a collection of <em>N</em> pixels, sorted chronologically: { <span class="math inline">\(p_{t}\)</span> = t_{0} + t_{1}… t_{n}$ }, where each <em>t</em> is the given value of each pixel in the series.</p>
</div>
<div id="data-preparation-and-preprocessing" class="section level2">
<h2><span class="header-section-number">8.2</span> Data Preparation and Preprocessing</h2>
<p>The first step in analysis of time series data is to import data of interest and plot it at an interesting location.</p>
<p>We will begin by importing Landsat 8 Surface Reflectance, Tier 1 (this data is currently deprecated, but works for this lab). Make a single point geometry with the drawing tools and position the point in a location of interest. (How about an annual grassland or a deciduous forest, which change characteristics seasonally) Name the import <code>roi</code>. Preprocess the Landsat imagery by filtering it to the location of interest, masking clouds, and adding the variables in the model:
<code>javascript var landsat_8_sr = ee.ImageCollection("LANDSAT/LC08/C01/T1_SR") // This field contains UNIX time in milliseconds. var timeField = 'system:time_start'; // Function to cloud mask from the pixel_qa band of Landsat 8 SR data. function maskL8sr(image) {   // Bits 3 and 5 are cloud shadow and cloud, respectively.   var cloudShadowBitMask = 1 &lt;&lt; 3;   var cloudsBitMask = 1 &lt;&lt; 5;   // Get the pixel QA band.   var qa = image.select('pixel_qa');   // Both flags should be set to zero, indicating clear conditions.   var mask = qa.bitwiseAnd(cloudShadowBitMask).eq(0)   .and(qa.bitwiseAnd(cloudsBitMask).eq(0));   // Return the masked image, scaled to reflectance, without the QA bands.   return image.updateMask(mask).divide(10000)   .select('B[0-9]*')   .copyProperties(image, ['system:time_start']); } // Use this function to add variables for NDVI, time and a constant // to Landsat 8 imagery. var addVariables = function(image) {   // Compute time in fractional years since the epoch.   var date = ee.Date(image.get(timeField));   var years = date.difference(ee.Date('1970-01-01'), 'year');   // Return the image with the added bands.   return image   // Add an NDVI band.   .addBands(image.normalizedDifference(['B5', 'B4']).rename('NDVI'))   // Add a time band.   .addBands(ee.Image(years).rename('t'))   .float()   // Add a constant band.   .addBands(ee.Image.constant(1)); }; // Remove clouds, add variables and filter to the area of interest. var filteredLandsat = landsat_8_sr .filterBounds(roi) .map(maskL8sr) .map(addVariables);</code></p>
<p>To visualize the data, make a chart at the location of interest. Add a linear trend line for reference (you’ll compute that line soon):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="time-series.html#cb13-1"></a><span class="co">// Plot a time series of NDVI at a single location.</span></span>
<span id="cb13-2"><a href="time-series.html#cb13-2"></a><span class="kw">var</span> l8Chart <span class="op">=</span> <span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(<span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">,</span> roi)</span>
<span id="cb13-3"><a href="time-series.html#cb13-3"></a>  .<span class="at">setChartType</span>(<span class="st">&#39;ScatterChart&#39;</span>)</span>
<span id="cb13-4"><a href="time-series.html#cb13-4"></a>  .<span class="at">setOptions</span>(<span class="op">{</span></span>
<span id="cb13-5"><a href="time-series.html#cb13-5"></a>   <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Landsat 8 NDVI time series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb13-6"><a href="time-series.html#cb13-6"></a>   <span class="dt">trendlines</span><span class="op">:</span> <span class="op">{</span><span class="dv">0</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb13-7"><a href="time-series.html#cb13-7"></a>                <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span></span>
<span id="cb13-8"><a href="time-series.html#cb13-8"></a>   <span class="op">}},</span></span>
<span id="cb13-9"><a href="time-series.html#cb13-9"></a>   <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-10"><a href="time-series.html#cb13-10"></a>   <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb13-11"><a href="time-series.html#cb13-11"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb13-12"><a href="time-series.html#cb13-12"></a><span class="at">print</span>(l8Chart)<span class="op">;</span></span></code></pre></div>
<p>You should see something an output similar to this. Note that you can see a very slight upwards trend of the value at the point. Additionally, within each year there is seasonality, which means that there is a pattern that repeats within the year.</p>
<div class="figure">
<img src="im_05_03.png" alt="" />
<p class="caption">Chart, scatter chart Description automatically generated</p>
</div>
</div>
<div id="linear-modeling-of-time" class="section level2">
<h2><span class="header-section-number">8.3</span> Linear Modeling of Time</h2>
<p>Lots of interesting analyses can be done to time series by harnessing the <code>linearRegression()</code> <a href="https://developers.google.com/earth-engine/api_docs#eereducerlinearregression">reducer</a>. To Estimate linear trend over time, consider the following linear model, where <em>epsilon</em> is a random error:</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1X_1 + ... + \beta_nX_n + \epsilon \]</span>
This is the model behind the trendline added to the chart you just created. This model is useful for detrending data and reducing variability. For now, the goal is to discover the values of the <em><span class="math inline">\(\beta\)</span></em>’s in each pixel.
To fit this trend model to the Landsat-based NDVI series using ordinary least squares, use the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="time-series.html#cb14-1"></a><span class="co">// List of the independent variable names</span></span>
<span id="cb14-2"><a href="time-series.html#cb14-2"></a><span class="kw">var</span> independents <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span>])<span class="op">;</span></span>
<span id="cb14-3"><a href="time-series.html#cb14-3"></a><span class="co">// Name of the dependent variable.</span></span>
<span id="cb14-4"><a href="time-series.html#cb14-4"></a><span class="kw">var</span> dependent <span class="op">=</span> <span class="va">ee</span>.<span class="at">String</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb14-5"><a href="time-series.html#cb14-5"></a><span class="co">// Compute a linear trend. This will have two bands: &#39;residuals&#39; and </span></span>
<span id="cb14-6"><a href="time-series.html#cb14-6"></a><span class="co">// a 2x1 band called coefficients (columns are for dependent variables).</span></span>
<span id="cb14-7"><a href="time-series.html#cb14-7"></a><span class="kw">var</span> trend <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="va">independents</span>.<span class="at">add</span>(dependent))</span>
<span id="cb14-8"><a href="time-series.html#cb14-8"></a>.<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="va">independents</span>.<span class="at">length</span>()<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb14-9"><a href="time-series.html#cb14-9"></a><span class="co">// Map.addLayer(trend, {}, &#39;trend array image&#39;)</span></span>
<span id="cb14-10"><a href="time-series.html#cb14-10"></a><span class="co">// Flatten the coefficients into a 2-band image</span></span>
<span id="cb14-11"><a href="time-series.html#cb14-11"></a><span class="kw">var</span> coefficients <span class="op">=</span> <span class="va">trend</span>.<span class="at">select</span>(<span class="st">&#39;coefficients&#39;</span>)</span>
<span id="cb14-12"><a href="time-series.html#cb14-12"></a>.<span class="at">arrayProject</span>([<span class="dv">0</span>])</span>
<span id="cb14-13"><a href="time-series.html#cb14-13"></a>.<span class="at">arrayFlatten</span>([independents])<span class="op">;</span></span></code></pre></div>
<p>The coefficients’ image is a two band image in which each pixel contains values for <span class="math display">\[\beta_0\]</span> and <span class="math display">\[\beta_1\]</span>. Use the model to “detrend” the original NDVI time series. By detrend, we mean account for the slope of the chart.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="time-series.html#cb15-1"></a><span class="co">// Compute a de-trended series.</span></span>
<span id="cb15-2"><a href="time-series.html#cb15-2"></a><span class="kw">var</span> detrended <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb15-3"><a href="time-series.html#cb15-3"></a><span class="cf">return</span> <span class="va">image</span>.<span class="at">select</span>(dependent).<span class="at">subtract</span>(</span>
<span id="cb15-4"><a href="time-series.html#cb15-4"></a>       <span class="va">image</span>.<span class="at">select</span>(independents).<span class="at">multiply</span>(coefficients).<span class="at">reduce</span>(<span class="st">&#39;sum&#39;</span>))</span>
<span id="cb15-5"><a href="time-series.html#cb15-5"></a>       .<span class="at">rename</span>(dependent)</span>
<span id="cb15-6"><a href="time-series.html#cb15-6"></a>       .<span class="at">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb15-7"><a href="time-series.html#cb15-7"></a>       <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="time-series.html#cb16-1"></a><span class="co">// Plot the detrended results.</span></span>
<span id="cb16-2"><a href="time-series.html#cb16-2"></a><span class="kw">var</span> detrendedChart <span class="op">=</span> <span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(detrended<span class="op">,</span> roi<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb16-3"><a href="time-series.html#cb16-3"></a>.<span class="at">setOptions</span>(<span class="op">{</span></span>
<span id="cb16-4"><a href="time-series.html#cb16-4"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Detrended Landsat time series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb16-5"><a href="time-series.html#cb16-5"></a>  <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb16-6"><a href="time-series.html#cb16-6"></a>  <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb16-7"><a href="time-series.html#cb16-7"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb16-8"><a href="time-series.html#cb16-8"></a><span class="at">print</span>(detrendedChart)<span class="op">;</span></span></code></pre></div>
</div>
<div id="estimate-seasonality-with-a-harmonic-model" class="section level2">
<h2><span class="header-section-number">8.4</span> Estimate Seasonality with a Harmonic Model</h2>
<!-- Rewrite for simplification: -->
<!-- ----- -->
<p>Consider the following linear model, where *e**t* is a random error, <em>A</em> is amplitude, <em>ω</em> is frequency, and <em>φ</em> is phase:</p>
<p>*p**t* = <em>β</em>0 + <em>β</em>1<em>t + A</em>cos(2π<em>ωt - φ</em>) + *e**t*</p>
<p>= <em>β</em>0 + <em>β</em>1<em>t + β</em>2cos(2π<em>ωt</em>) + <em>β</em>3sin(2π<em>ωt</em>) + *e**t* (2)</p>
<p>Note that <em>β</em>2 = <em>A</em>cos(<em>φ</em>) and <em>β</em>3 = <em>A</em>sin(<em>φ</em>), implying <em>A</em> = (<em>β</em>22 + <em>β</em>32)½ and <em>φ</em> = atan(<em>β</em>3/<em>β</em>2). (See <a href="https://virginiatech.on.worldcat.org/v2/oclc/999821221">Shumway and Stoffer (2017)</a> equations 4.1 - 4.2). To fit this model to the time series, set <em>ω</em>=1 (one cycle per unit time) and use ordinary least squares regression.</p>
<p>The setup for fitting the model is to first add the harmonic variables (the third and fourth terms of equation 2) to the image collection.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="time-series.html#cb17-1"></a><span class="co">// Use these independent variables in the harmonic regression.</span></span>
<span id="cb17-2"><a href="time-series.html#cb17-2"></a><span class="kw">var</span> harmonicIndependents <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span><span class="op">,</span> <span class="st">&#39;cos&#39;</span><span class="op">,</span> <span class="st">&#39;sin&#39;</span>])<span class="op">;</span></span>
<span id="cb17-3"><a href="time-series.html#cb17-3"></a><span class="co">// Add harmonic terms as new image bands.</span></span>
<span id="cb17-4"><a href="time-series.html#cb17-4"></a><span class="kw">var</span> harmonicLandsat <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb17-5"><a href="time-series.html#cb17-5"></a><span class="kw">var</span> timeRadians <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;t&#39;</span>).<span class="at">multiply</span>(<span class="dv">2</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></span>
<span id="cb17-6"><a href="time-series.html#cb17-6"></a><span class="cf">return</span> image</span>
<span id="cb17-7"><a href="time-series.html#cb17-7"></a>.<span class="at">addBands</span>(<span class="va">timeRadians</span>.<span class="at">cos</span>().<span class="at">rename</span>(<span class="st">&#39;cos&#39;</span>))</span>
<span id="cb17-8"><a href="time-series.html#cb17-8"></a>.<span class="at">addBands</span>(<span class="va">timeRadians</span>.<span class="at">sin</span>().<span class="at">rename</span>(<span class="st">&#39;sin&#39;</span>))<span class="op">;</span></span>
<span id="cb17-9"><a href="time-series.html#cb17-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Fit the model as with the linear trend, using the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="time-series.html#cb18-1"></a><span class="kw">var</span> harmonicTrend <span class="op">=</span> harmonicLandsat</span>
<span id="cb18-2"><a href="time-series.html#cb18-2"></a>.<span class="at">select</span>(<span class="va">harmonicIndependents</span>.<span class="at">add</span>(dependent))</span>
<span id="cb18-3"><a href="time-series.html#cb18-3"></a><span class="co">// The output of this reducer is a 4x1 array image.</span></span>
<span id="cb18-4"><a href="time-series.html#cb18-4"></a>.<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="op">{</span></span>
<span id="cb18-5"><a href="time-series.html#cb18-5"></a><span class="dt">numX</span><span class="op">:</span> <span class="va">harmonicIndependents</span>.<span class="at">length</span>()<span class="op">,</span> </span>
<span id="cb18-6"><a href="time-series.html#cb18-6"></a><span class="dt">numY</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb18-7"><a href="time-series.html#cb18-7"></a><span class="op">}</span>))<span class="op">;</span></span></code></pre></div>
<p>Plug the coefficients in to equation 2 in order to get a time series of fitted values:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="time-series.html#cb19-1"></a><span class="co">// Turn the array image into a multi-band image of coefficients.</span></span>
<span id="cb19-2"><a href="time-series.html#cb19-2"></a><span class="kw">var</span> harmonicTrendCoefficients <span class="op">=</span> <span class="va">harmonicTrend</span>.<span class="at">select</span>(<span class="st">&#39;coefficients&#39;</span>) .<span class="at">arrayProject</span>([<span class="dv">0</span>]) .<span class="at">arrayFlatten</span>([harmonicIndependents])<span class="op">;</span></span>
<span id="cb19-3"><a href="time-series.html#cb19-3"></a><span class="co">// Compute fitted values.</span></span>
<span id="cb19-4"><a href="time-series.html#cb19-4"></a><span class="kw">var</span> fittedHarmonic <span class="op">=</span> <span class="va">harmonicLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span> </span>
<span id="cb19-5"><a href="time-series.html#cb19-5"></a><span class="cf">return</span> <span class="va">image</span>.<span class="at">addBands</span>(  </span>
<span id="cb19-6"><a href="time-series.html#cb19-6"></a><span class="va">image</span>.<span class="at">select</span>(harmonicIndependents)   </span>
<span id="cb19-7"><a href="time-series.html#cb19-7"></a>.<span class="at">multiply</span>(harmonicTrendCoefficients)   </span>
<span id="cb19-8"><a href="time-series.html#cb19-8"></a>.<span class="at">reduce</span>(<span class="st">&#39;sum&#39;</span>)   </span>
<span id="cb19-9"><a href="time-series.html#cb19-9"></a>.<span class="at">rename</span>(<span class="st">&#39;fitted&#39;</span>))<span class="op">;}</span>)<span class="op">;</span></span>
<span id="cb19-10"><a href="time-series.html#cb19-10"></a><span class="co">// Plot the fitted model and the original data at the ROI.</span></span>
<span id="cb19-11"><a href="time-series.html#cb19-11"></a><span class="at">print</span>(<span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(<span class="va">fittedHarmonic</span>.<span class="at">select</span>([<span class="st">&#39;fitted&#39;</span><span class="op">,</span><span class="st">&#39;NDVI&#39;</span>])<span class="op">,</span> roi<span class="op">,</span></span>
<span id="cb19-12"><a href="time-series.html#cb19-12"></a>                  <span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">mean</span>()<span class="op">,</span> <span class="dv">30</span>)  </span>
<span id="cb19-13"><a href="time-series.html#cb19-13"></a>.<span class="at">setSeriesNames</span>([<span class="st">&#39;NDVI&#39;</span><span class="op">,</span> <span class="st">&#39;fitted&#39;</span>])  </span>
<span id="cb19-14"><a href="time-series.html#cb19-14"></a>.<span class="at">setOptions</span>(<span class="op">{</span>   </span>
<span id="cb19-15"><a href="time-series.html#cb19-15"></a><span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Harmonic model: original and fitted values&#39;</span><span class="op">,</span>   </span>
<span id="cb19-16"><a href="time-series.html#cb19-16"></a><span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>   </span>
<span id="cb19-17"><a href="time-series.html#cb19-17"></a><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,}</span>))<span class="op">;</span></span></code></pre></div>
<p>You should see something like:</p>
<p><img src="im_05_04.png" width="95%" style="display: block; margin: auto;" /></p>
<p>Although any coefficients can be mapped directly, it is useful and interesting to map the phase and amplitude of the estimated harmonic model. First, compute phase and amplitude from the coefficients, then map the resulting image.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="time-series.html#cb20-1"></a><span class="co">// Compute phase and amplitude.</span></span>
<span id="cb20-2"><a href="time-series.html#cb20-2"></a><span class="kw">var</span> phase <span class="op">=</span> <span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;sin&#39;</span>)  .<span class="at">atan2</span>(<span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb20-3"><a href="time-series.html#cb20-3"></a><span class="co">// Scale to [0, 1] from radians.  </span></span>
<span id="cb20-4"><a href="time-series.html#cb20-4"></a>.<span class="at">unitScale</span>(<span class="op">-</span><span class="va">Math</span>.<span class="at">PI</span><span class="op">,</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></span>
<span id="cb20-5"><a href="time-series.html#cb20-5"></a><span class="kw">var</span> amplitude <span class="op">=</span> <span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;sin&#39;</span>)  .<span class="at">hypot</span>(<span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb20-6"><a href="time-series.html#cb20-6"></a><span class="co">// Add a scale factor for visualization.  </span></span>
<span id="cb20-7"><a href="time-series.html#cb20-7"></a>.<span class="at">multiply</span>(<span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb20-8"><a href="time-series.html#cb20-8"></a><span class="co">// Compute the mean NDVI.</span></span>
<span id="cb20-9"><a href="time-series.html#cb20-9"></a><span class="kw">var</span> meanNdvi<span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>).<span class="at">mean</span>()<span class="op">;</span></span>
<span id="cb20-10"><a href="time-series.html#cb20-10"></a><span class="co">// Use the HSV to RGB transformation to display phase and amplitude.</span></span>
<span id="cb20-11"><a href="time-series.html#cb20-11"></a><span class="kw">var</span> rgb <span class="op">=</span> <span class="va">ee</span>.<span class="va">Image</span>.<span class="at">cat</span>([ phase<span class="op">,</span>   </span>
<span id="cb20-12"><a href="time-series.html#cb20-12"></a>               amplitude<span class="op">,</span> </span>
<span id="cb20-13"><a href="time-series.html#cb20-13"></a>               meanNdvi  </span>
<span id="cb20-14"><a href="time-series.html#cb20-14"></a>]).<span class="at">hsvToRgb</span>()</span>
<span id="cb20-15"><a href="time-series.html#cb20-15"></a><span class="va">Map</span>.<span class="at">addLayer</span>(rgb<span class="op">,</span> <span class="op">{},</span> <span class="st">&#39;phase (hue), amplitude (sat), ndvi (val)&#39;</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="where-to-submit-4" class="section level2 unnumbered">
<h2>Where to submit</h2>
<p>Submit your responses to these questions on <a href="https://www.gradescope.com/courses/293173/assignments/1446622/submissions">Gradescope</a> by 10am on Wednesday, October 06. If needed, the access code for our course is <code>6PEW3W</code>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="nonlinear-regression.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["labs-rsss.pdf"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
