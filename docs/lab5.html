<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 5 Time Series Modeling | Remote Sensing in the Social Sciences</title>
  <meta name="description" content="Lab 5 Time Series Modeling | Remote Sensing in the Social Sciences" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 5 Time Series Modeling | Remote Sensing in the Social Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 5 Time Series Modeling | Remote Sensing in the Social Sciences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="classification.html"/>

<script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html"><i class="fa fa-check"></i>PreLab: Getting Started</a><ul>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="0.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#data-and-methods"><i class="fa fa-check"></i><b>0.1</b> Data and Methods</a></li>
<li class="chapter" data-level="0.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images-and-image-collections"><i class="fa fa-check"></i><b>0.2</b> Images and Image Collections</a><ul>
<li class="chapter" data-level="0.2.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images"><i class="fa fa-check"></i><b>0.2.1</b> Images</a></li>
<li class="chapter" data-level="0.2.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#image-collections"><i class="fa fa-check"></i><b>0.2.2</b> Image Collections</a></li>
<li class="chapter" data-level="0.2.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#sensed-versus-derived-imagery"><i class="fa fa-check"></i><b>0.2.3</b> Sensed versus Derived Imagery</a></li>
</ul></li>
<li class="chapter" data-level="0.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#geometries"><i class="fa fa-check"></i><b>0.3</b> Geometries</a></li>
<li class="chapter" data-level="0.4" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features-and-feature-collections"><i class="fa fa-check"></i><b>0.4</b> Features and Feature Collections</a><ul>
<li class="chapter" data-level="0.4.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features"><i class="fa fa-check"></i><b>0.4.1</b> Features</a></li>
<li class="chapter" data-level="0.4.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#feature-collections"><i class="fa fa-check"></i><b>0.4.2</b> Feature Collections</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#methods-reducers"><i class="fa fa-check"></i><b>0.5</b> Methods: Reducers</a></li>
<li class="chapter" data-level="0.6" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#joins-and-arrays"><i class="fa fa-check"></i><b>0.6</b> Joins and Arrays</a><ul>
<li class="chapter" data-level="0.6.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#join"><i class="fa fa-check"></i><b>0.6.1</b> Join</a></li>
<li class="chapter" data-level="0.6.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#arrays"><i class="fa fa-check"></i><b>0.6.2</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#additional-resources"><i class="fa fa-check"></i><b>0.7</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="lab1.html"><a href="lab1.html"><i class="fa fa-check"></i><b>1</b> Remote Sensing Background</a><ul>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1.1" data-path="lab1.html"><a href="lab1.html#what-is-a-digital-image"><i class="fa fa-check"></i><b>1.1</b> What is a digital image?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="lab1.html"><a href="lab1.html#from-digital-image-to-geospatial-image"><i class="fa fa-check"></i><b>1.1.1</b> From digital image to geospatial image</a></li>
<li class="chapter" data-level="1.1.2" data-path="lab1.html"><a href="lab1.html#visualize-a-digital-image"><i class="fa fa-check"></i><b>1.1.2</b> Visualize a Digital Image</a></li>
<li class="chapter" data-level="1.1.3" data-path="lab1.html"><a href="lab1.html#digital-image-visualization-and-stretching"><i class="fa fa-check"></i><b>1.1.3</b> Digital Image Visualization and Stretching</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="lab1.html"><a href="lab1.html#spatial-resolution"><i class="fa fa-check"></i><b>1.2</b> Spatial Resolution</a><ul>
<li class="chapter" data-level="1.2.1" data-path="lab1.html"><a href="lab1.html#modis"><i class="fa fa-check"></i><b>1.2.1</b> MODIS</a></li>
<li class="chapter" data-level="1.2.2" data-path="lab1.html"><a href="lab1.html#multispectral-scanners"><i class="fa fa-check"></i><b>1.2.2</b> Multispectral Scanners</a></li>
<li class="chapter" data-level="1.2.3" data-path="lab1.html"><a href="lab1.html#thematic-mapper-tm"><i class="fa fa-check"></i><b>1.2.3</b> Thematic Mapper (TM)</a></li>
<li class="chapter" data-level="1.2.4" data-path="lab1.html"><a href="lab1.html#national-agriculture-imagery-program-naip"><i class="fa fa-check"></i><b>1.2.4</b> National Agriculture Imagery Program (NAIP)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="lab1.html"><a href="lab1.html#spectral-resolution"><i class="fa fa-check"></i><b>1.3</b> Spectral Resolution</a></li>
<li class="chapter" data-level="1.4" data-path="lab1.html"><a href="lab1.html#temporal-resolution"><i class="fa fa-check"></i><b>1.4</b> Temporal Resolution</a><ul>
<li class="chapter" data-level="1.4.1" data-path="lab1.html"><a href="lab1.html#modis-1"><i class="fa fa-check"></i><b>1.4.1</b> MODIS</a></li>
<li class="chapter" data-level="1.4.2" data-path="lab1.html"><a href="lab1.html#landsat"><i class="fa fa-check"></i><b>1.4.2</b> Landsat</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="lab1.html"><a href="lab1.html#radiometric-resolution"><i class="fa fa-check"></i><b>1.5</b> Radiometric Resolution</a></li>
<li class="chapter" data-level="1.6" data-path="lab1.html"><a href="lab1.html#resampling-and-reprojection"><i class="fa fa-check"></i><b>1.6</b> Resampling and ReProjection</a></li>
<li class="chapter" data-level="1.7" data-path="lab1.html"><a href="lab1.html#additional-exercises"><i class="fa fa-check"></i><b>1.7</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#where-to-submit"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab2.html"><a href="lab2.html"><i class="fa fa-check"></i><b>2</b> Digital Imagery &amp; Image Processing</a><ul>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#overview-2"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="2.1" data-path="lab2.html"><a href="lab2.html#searching-for-imagery-exercise-1"><i class="fa fa-check"></i><b>2.1</b> Searching for Imagery (Exercise 1)</a></li>
<li class="chapter" data-level="2.2" data-path="lab2.html"><a href="lab2.html#visualizing-landsat-imagery"><i class="fa fa-check"></i><b>2.2</b> Visualizing Landsat Imagery</a></li>
<li class="chapter" data-level="2.3" data-path="lab2.html"><a href="lab2.html#plot-at-sensor-radiance"><i class="fa fa-check"></i><b>2.3</b> Plot at-Sensor Radiance</a></li>
<li class="chapter" data-level="2.4" data-path="lab2.html"><a href="lab2.html#plot-top-of-atmosphere-toa-reflectance"><i class="fa fa-check"></i><b>2.4</b> Plot Top-of-Atmosphere (TOA) Reflectance</a></li>
<li class="chapter" data-level="2.5" data-path="lab2.html"><a href="lab2.html#plot-surface-reflectance"><i class="fa fa-check"></i><b>2.5</b> Plot Surface Reflectance</a></li>
<li class="chapter" data-level="2.6" data-path="lab2.html"><a href="lab2.html#additional-exercises-1"><i class="fa fa-check"></i><b>2.6</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#where-to-submit-1"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html"><i class="fa fa-check"></i><b>3</b> Spectral Indices &amp; Transformations</a><ul>
<li class="chapter" data-level="" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#overview-3"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="3.1" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#spectral-indices"><i class="fa fa-check"></i><b>3.1</b> Spectral Indices</a><ul>
<li class="chapter" data-level="3.1.1" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#important-indices"><i class="fa fa-check"></i><b>3.1.1</b> Important Indices</a></li>
<li class="chapter" data-level="3.1.2" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#linear-transformations"><i class="fa fa-check"></i><b>3.1.2</b> Linear Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#spectral-transformation"><i class="fa fa-check"></i><b>3.2</b> Spectral Transformation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#linear-filtering"><i class="fa fa-check"></i><b>3.2.1</b> Linear Filtering</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#additional-exercises-2"><i class="fa fa-check"></i><b>3.3</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="spectral-indices-transformations.html"><a href="spectral-indices-transformations.html#where-to-submit-2"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>4</b> Classification</a><ul>
<li class="chapter" data-level="" data-path="classification.html"><a href="classification.html#overview-4"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="4.1" data-path="classification.html"><a href="classification.html#introduction-to-classification"><i class="fa fa-check"></i><b>4.1</b> Introduction to Classification</a></li>
<li class="chapter" data-level="4.2" data-path="classification.html"><a href="classification.html#unsupervised-classification"><i class="fa fa-check"></i><b>4.2</b> Unsupervised Classification</a></li>
<li class="chapter" data-level="4.3" data-path="classification.html"><a href="classification.html#supervised-classification"><i class="fa fa-check"></i><b>4.3</b> Supervised Classification</a></li>
<li class="chapter" data-level="4.4" data-path="classification.html"><a href="classification.html#accuracy-assessment"><i class="fa fa-check"></i><b>4.4</b> Accuracy Assessment</a></li>
<li class="chapter" data-level="4.5" data-path="classification.html"><a href="classification.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>4.5</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="4.6" data-path="classification.html"><a href="classification.html#assignment"><i class="fa fa-check"></i><b>4.6</b> Assignment</a></li>
<li class="chapter" data-level="" data-path="classification.html"><a href="classification.html#where-to-submit-3"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab5.html"><a href="lab5.html"><i class="fa fa-check"></i><b>5</b> Time Series Modeling</a><ul>
<li class="chapter" data-level="" data-path="lab5.html"><a href="lab5.html#overview-5"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="5.1" data-path="lab5.html"><a href="lab5.html#background"><i class="fa fa-check"></i><b>5.1</b> Background</a><ul>
<li class="chapter" data-level="5.1.1" data-path="lab5.html"><a href="lab5.html#limitations-in-remote-sensing-time-series"><i class="fa fa-check"></i><b>5.1.1</b> Limitations in Remote Sensing Time Series</a></li>
<li class="chapter" data-level="5.1.2" data-path="lab5.html"><a href="lab5.html#multi-temporal-data-in-earth-engine"><i class="fa fa-check"></i><b>5.1.2</b> Multi-Temporal Data in Earth Engine</a></li>
<li class="chapter" data-level="5.1.3" data-path="lab5.html"><a href="lab5.html#data-preparation-and-preprocessing"><i class="fa fa-check"></i><b>5.1.3</b> Data Preparation and Preprocessing</a></li>
<li class="chapter" data-level="5.1.4" data-path="lab5.html"><a href="lab5.html#linear-modeling-of-time"><i class="fa fa-check"></i><b>5.1.4</b> Linear Modeling of Time</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="lab5.html"><a href="lab5.html#estimate-seasonality-with-a-harmonic-model"><i class="fa fa-check"></i><b>5.2</b> Estimate Seasonality with a Harmonic Model</a></li>
<li class="chapter" data-level="5.3" data-path="lab5.html"><a href="lab5.html#additional-exercises-3"><i class="fa fa-check"></i><b>5.3</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab5.html"><a href="lab5.html#where-to-submit-4"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Remote Sensing in the Social Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab5" class="section level1">
<h1><span class="header-section-number">Lab 5</span> Time Series Modeling</h1>
<div id="overview-5" class="section level2 unnumbered">
<h2>Overview</h2>
<p>The purpose of this lab is to establish a foundation for time series analysis on remotely sensed data. You will be introduced to the fundamentals of time series modeling, including decomposition, autocorrelation and modeling historical changes. At the completion of this lab, you will be able to build an explanatory model for temporal data which can be used in many different avenues of research.</p>
</div>
<div id="background" class="section level2">
<h2><span class="header-section-number">5.1</span> Background</h2>
<p>One of the paradigm-changing features of Earth Engine is the ability to access decades of imagery without the previous limitation of needing to download, organize, store and process this information. For instance, within the Landsat image collection we can access imagery back to 1972, allowing us to look at an area to visualize and quantify how much it’s changed over time. With Earth Engine, Google maintains the data and offers it’s compute power for processing - users can access tens or hundreds of time-sequenced images and quantify change across decades.</p>
<p>To explain the concepts of time series modeling, let’s begin with a dataset that illustrates what we are trying to do. The line chart below references electricity production over thirty years, with one distinct data point per month. What can we observe?</p>
<ol style="list-style-type: decimal">
<li><p>Production tends to increase each year - In this case, it appears to level out after 2010, but there is a general trend upwards.</p></li>
<li><p>Within each yearly cycle, we see that there is a sharp peak in June and July, and a trough in October and December. An annual, 12-month cycle is specifically referred to as ‘seasonality’, although there can be other cyclical time periods (ex., a housing market in a specific area may see a recurring pattern in house prices that occurs roughtly every 7 years)</p></li>
<li><p>Finally, the magnitude of the difference between each yearly peak and trough increases over time as well.</p></li>
</ol>
<div class="figure">
<img src="im/im_06_01.png" alt="" />
<p class="caption">im_06_07</p>
</div>
<p>With these observations, we can address each of the components individually and perhaps build an explanatory model. The time series decomposition below (generated in R) breaks up the data into separate components.</p>
<ol style="list-style-type: decimal">
<li>The ‘observed’ line chart is the data in original form.</li>
<li>The next chart is a trendline built using a window function (each data point is plotted as the average of the previous 12 data points). You can see the general trend of the data and determine whether a linear fit is appropriate.</li>
<li>The seasonal chart seeks to identify cyclical patterns in the data - in this case, patterns that repeat every 12 months. It subtracts the trend from the observed points and averages the data for each time period (month).<br />
</li>
<li>Finally, the ‘random’ line chart is the residual amount remaining when you remove the trend and seasonality from the data.</li>
</ol>
<div class="figure">
<img src="im/im_06_02.png" alt="" />
<p class="caption">im_06_06</p>
</div>
<div id="limitations-in-remote-sensing-time-series" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Limitations in Remote Sensing Time Series</h3>
<p>Time Series modeling aims to build an an explanatory model of the data without overfitting the problem set - to use as simple a model as possible while accounting for as much of the data as possible. The previous example was used to illustrate the concepts of breaking down time series data into component parts, but remote sensing data has additional limitations that make this more challenging. Note that in the previous example used there was a well-formed data point for every single month - nothing was missing or obviously erroneous. It is almost inevitable that you will not get this same level of precision from remote sensing data. For instance, Landsat has 16-day temporal resolution - but depending on the area, removing cloudy pixels will remove a significant portion. For instance, in a test area in the Galapagos Islands, over 85% of the data was removed due to cloud masking or atmospheric conditions. Issues such as the Landsat 7 Scan Line Corrector malfunction might prevent a cohesive time series dataset depending on your time period of research. Also, while the time series example we used involved measured values on the same scale throughout the time series (ie, a gigawatt is the same unit of measurement throughout the entire time series), with remote sensing we often run into situations where the magnitude of measurement changes. If we are researching winter crop yield and an image is collected right after a heavy snowfall, how do we compare this value? Do we keep this data or remove it? Additionally, atmospheric conditions can skew the visual results, where the hue of the vegetation changes drastically from image to image due to atmospheric conditions (fog, ground moisture, cloud cover).</p>
<p>For your project, you have to understand the characteristics of both your data and what you are trying to measure. Building a time series model to understand cyclical changes in vegetation can provide useful information in understanding crop yield - but if you do not account for issues in the data, you can end up building a faulty time series model that leads to erroneous results. Many time series modeling tools, such as ARIMA modeling, are not directly applicable in certain settings due to missing data, non-standard collection periods and varying intensity of due to atmospheric conditions. In this lab, we will focus on understanding on linear trends and harmonic modeling.</p>
</div>
<div id="multi-temporal-data-in-earth-engine" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Multi-Temporal Data in Earth Engine</h3>
<p>Time series data in Earth Engine are represented as a series of images called ‘Image Collections’. As a result of the complicating factors in remote sensing discussed earlier, analyzing time series in Earth Engine is unlike time series modeling in traditional methods. From a programming sense, we will join data together to define temporal relationships between collection items and build functions to reduce this tim.</p>
<p>First, some very basic mathematical notation for time series. A time series is an array of the value being measured, sorted chronologically: { <span class="math inline">\(\textbf{p}_{t} = t_{0} + t_{1}... t_{N}\)</span> }, where each <em>t</em> is the given value in the series.</p>
</div>
<div id="data-preparation-and-preprocessing" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Data Preparation and Preprocessing</h3>
<p>The first step in analysis of time series data is to import data of interest and plot the data at an interesting location. In this case, the region of interest is in a deciduous forest near Blacksburg, VA.</p>
<p>We begin by loading in the Landsat 8 Collection and provide a point at the region of interest. Additionally, we will create a time field.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="lab5.html#cb1-1"></a><span class="kw">var</span> landsat_8_sr <span class="op">=</span> <span class="va">ee</span>.<span class="at">ImageCollection</span>(<span class="st">&quot;LANDSAT/LC08/C01/T1_SR&quot;</span>)</span>
<span id="cb1-2"><a href="lab5.html#cb1-2"></a><span class="kw">var</span> roi <span class="op">=</span> <span class="va">ee</span>.<span class="va">Geometry</span>.<span class="at">Point</span>([<span class="op">-</span><span class="fl">80.49882800809357</span><span class="op">,</span> <span class="fl">37.2544486695189</span>])<span class="op">;</span></span>
<span id="cb1-3"><a href="lab5.html#cb1-3"></a><span class="co">// This field contains UNIX time in milliseconds.</span></span>
<span id="cb1-4"><a href="lab5.html#cb1-4"></a><span class="kw">var</span> timeField <span class="op">=</span> <span class="st">&#39;system:time_start&#39;</span><span class="op">;</span></span></code></pre></div>
<p>The function <code>maskL8sr</code> is a cloud masking function that uses the Quality Assurance attribute of Landsat 8 to mask out any pixels that that are obscured by cloud. Note that this function is Landsat 8 specific, using other platforms will require a different setup.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="lab5.html#cb2-1"></a><span class="co">// Function to cloud mask from the pixel_qa band of Landsat 8 SR data.</span></span>
<span id="cb2-2"><a href="lab5.html#cb2-2"></a><span class="kw">function</span> <span class="at">maskL8sr</span>(image) <span class="op">{</span></span>
<span id="cb2-3"><a href="lab5.html#cb2-3"></a>  <span class="co">// Bits 3 and 5 are cloud shadow and cloud, respectively.</span></span>
<span id="cb2-4"><a href="lab5.html#cb2-4"></a>  <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb2-5"><a href="lab5.html#cb2-5"></a>  <span class="kw">var</span> cloudsBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb2-6"><a href="lab5.html#cb2-6"></a>  <span class="co">// Get the pixel QA band.</span></span>
<span id="cb2-7"><a href="lab5.html#cb2-7"></a>  <span class="kw">var</span> qa <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb2-8"><a href="lab5.html#cb2-8"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb2-9"><a href="lab5.html#cb2-9"></a>  <span class="kw">var</span> mask <span class="op">=</span> <span class="va">qa</span>.<span class="at">bitwiseAnd</span>(cloudShadowBitMask).<span class="at">eq</span>(<span class="dv">0</span>)</span>
<span id="cb2-10"><a href="lab5.html#cb2-10"></a>  .<span class="at">and</span>(<span class="va">qa</span>.<span class="at">bitwiseAnd</span>(cloudsBitMask).<span class="at">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb2-11"><a href="lab5.html#cb2-11"></a>  <span class="co">// Return the masked image, scaled to reflectance, without the QA bands.</span></span>
<span id="cb2-12"><a href="lab5.html#cb2-12"></a>  <span class="cf">return</span> <span class="va">image</span>.<span class="at">updateMask</span>(mask).<span class="at">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb2-13"><a href="lab5.html#cb2-13"></a>  .<span class="at">select</span>(<span class="st">&#39;B[0-9]*&#39;</span>)</span>
<span id="cb2-14"><a href="lab5.html#cb2-14"></a>  .<span class="at">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb2-15"><a href="lab5.html#cb2-15"></a><span class="op">}</span></span></code></pre></div>
<p>We can use one of the indices that we built in an earlier lab to measure vegetation health. Normalized Difference Vegetation Index (NDVI) is a well-known metric for quantifying vegetation health - for this region of interest, we expect there to be a strong seasonality, and perhaps a gradual linear trend over time. In the code block below, we create a function called <code>addVariables</code> that extracts the date of each image, calculates NDVI and adds it to an array. We can then use <code>.map()</code> to apply the two functions we built to build a time series model of our data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="lab5.html#cb3-1"></a><span class="co">// Use this function to add variables for NDVI, time and a constant</span></span>
<span id="cb3-2"><a href="lab5.html#cb3-2"></a><span class="co">// to Landsat 8 imagery.</span></span>
<span id="cb3-3"><a href="lab5.html#cb3-3"></a><span class="kw">var</span> addVariables <span class="op">=</span> <span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb3-4"><a href="lab5.html#cb3-4"></a>  <span class="co">// Compute time in fractional years since the epoch.</span></span>
<span id="cb3-5"><a href="lab5.html#cb3-5"></a>  <span class="kw">var</span> date <span class="op">=</span> <span class="va">ee</span>.<span class="at">Date</span>(<span class="va">image</span>.<span class="at">get</span>(timeField))<span class="op">;</span></span>
<span id="cb3-6"><a href="lab5.html#cb3-6"></a>  <span class="kw">var</span> years <span class="op">=</span> <span class="va">date</span>.<span class="at">difference</span>(<span class="va">ee</span>.<span class="at">Date</span>(<span class="st">&#39;1970-01-01&#39;</span>)<span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">;</span></span>
<span id="cb3-7"><a href="lab5.html#cb3-7"></a>  <span class="co">// Return the image with the added bands.</span></span>
<span id="cb3-8"><a href="lab5.html#cb3-8"></a>  <span class="cf">return</span> image</span>
<span id="cb3-9"><a href="lab5.html#cb3-9"></a>  <span class="co">// Add an NDVI band.</span></span>
<span id="cb3-10"><a href="lab5.html#cb3-10"></a>  .<span class="at">addBands</span>(<span class="va">image</span>.<span class="at">normalizedDifference</span>([<span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>]).<span class="at">rename</span>(<span class="st">&#39;NDVI&#39;</span>))</span>
<span id="cb3-11"><a href="lab5.html#cb3-11"></a>  <span class="co">// Add a time band.</span></span>
<span id="cb3-12"><a href="lab5.html#cb3-12"></a>  .<span class="at">addBands</span>(<span class="va">ee</span>.<span class="at">Image</span>(years).<span class="at">rename</span>(<span class="st">&#39;t&#39;</span>))</span>
<span id="cb3-13"><a href="lab5.html#cb3-13"></a>  .<span class="at">float</span>()</span>
<span id="cb3-14"><a href="lab5.html#cb3-14"></a>  <span class="co">// Add a constant band.</span></span>
<span id="cb3-15"><a href="lab5.html#cb3-15"></a>  .<span class="at">addBands</span>(<span class="va">ee</span>.<span class="va">Image</span>.<span class="at">constant</span>(<span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb3-16"><a href="lab5.html#cb3-16"></a><span class="op">};</span></span>
<span id="cb3-17"><a href="lab5.html#cb3-17"></a><span class="co">// Remove clouds, add variables and filter to the area of interest.</span></span>
<span id="cb3-18"><a href="lab5.html#cb3-18"></a><span class="kw">var</span> filteredLandsat <span class="op">=</span> landsat_8_sr</span>
<span id="cb3-19"><a href="lab5.html#cb3-19"></a>.<span class="at">filterBounds</span>(roi)</span>
<span id="cb3-20"><a href="lab5.html#cb3-20"></a>.<span class="at">map</span>(maskL8sr)</span>
<span id="cb3-21"><a href="lab5.html#cb3-21"></a>.<span class="at">map</span>(addVariables)<span class="op">;</span></span></code></pre></div>
<p>To visualize the data, we will export a chart at the location of interest. We will add a linear trend line for reference.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="lab5.html#cb4-1"></a><span class="co">// Plot a time series of NDVI at a single location.</span></span>
<span id="cb4-2"><a href="lab5.html#cb4-2"></a><span class="kw">var</span> l8Chart <span class="op">=</span> <span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(<span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">,</span> roi)</span>
<span id="cb4-3"><a href="lab5.html#cb4-3"></a>  .<span class="at">setChartType</span>(<span class="st">&#39;ScatterChart&#39;</span>)</span>
<span id="cb4-4"><a href="lab5.html#cb4-4"></a>  .<span class="at">setOptions</span>(<span class="op">{</span></span>
<span id="cb4-5"><a href="lab5.html#cb4-5"></a>   <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Landsat 8 NDVI Time Series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb4-6"><a href="lab5.html#cb4-6"></a>   <span class="dt">trendlines</span><span class="op">:</span> <span class="op">{</span><span class="dv">0</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="lab5.html#cb4-7"></a>                <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span></span>
<span id="cb4-8"><a href="lab5.html#cb4-8"></a>   <span class="op">}},</span></span>
<span id="cb4-9"><a href="lab5.html#cb4-9"></a>   <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb4-10"><a href="lab5.html#cb4-10"></a>   <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb4-11"><a href="lab5.html#cb4-11"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb4-12"><a href="lab5.html#cb4-12"></a><span class="at">print</span>(l8Chart)<span class="op">;</span></span></code></pre></div>
<p>You can click on the ‘export’ button next to the chart to view an iteractive chart. Scroll over some of the data points and look at the relationships between the data. A line connecting two dots means that they are sequential data points, and note that there are relatively few of them. We can see that there are relatively large jumps in the data, with an upward climb somewhere between March and late April, and a descent in late August. Each year is slightly different, but we can surmise that this is due to seasonal rains in the spring and leaves dying off in the fall. Finally, the general trend is downward, although the February 2021 datapoint might have significant leverage on the trend.</p>
<div class="figure">
<img src="im/im_06_03.png" alt="" />
<p class="caption">im_06_03</p>
</div>
</div>
<div id="linear-modeling-of-time" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Linear Modeling of Time</h3>
<p>Lots of interesting analyses can be done to time series by harnessing the <code>linearRegression()</code> <a href="https://developers.google.com/earth-engine/api_docs#eereducerlinearregression">reducer</a>. To estimate linear trends over time, consider the following linear model, where <span class="math inline">\(\epsilon_t\)</span> is a random error:</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1X_1 + ... + \beta_nX_n + \epsilon_t \]</span></p>
<p>This is the model behind the trendline added to the chart you just created. We can use this model to detrend our data (explain the upward or downward movement of the data by subtracting observed values from the fitted model values). For now, the goal is to discover the values of the beta coefficients.</p>
<p>To fit this trend model to the Landsat-based NDVI series using Ordinary Least Squares (<a href="https://statisticsbyjim.com/glossary/ordinary-least-squares/">OLS</a>), use the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="lab5.html#cb5-1"></a><span class="co">// List of the independent variable names</span></span>
<span id="cb5-2"><a href="lab5.html#cb5-2"></a><span class="kw">var</span> independents <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span>])<span class="op">;</span></span>
<span id="cb5-3"><a href="lab5.html#cb5-3"></a><span class="co">// Name of the dependent variable.</span></span>
<span id="cb5-4"><a href="lab5.html#cb5-4"></a><span class="kw">var</span> dependent <span class="op">=</span> <span class="va">ee</span>.<span class="at">String</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb5-5"><a href="lab5.html#cb5-5"></a><span class="co">// Compute a linear trend. This will have two bands: &#39;residuals&#39; and </span></span>
<span id="cb5-6"><a href="lab5.html#cb5-6"></a><span class="co">// a 2x1 band called coefficients (columns are for dependent variables).</span></span>
<span id="cb5-7"><a href="lab5.html#cb5-7"></a><span class="kw">var</span> trend <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="va">independents</span>.<span class="at">add</span>(dependent))</span>
<span id="cb5-8"><a href="lab5.html#cb5-8"></a>        .<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="va">independents</span>.<span class="at">length</span>()<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb5-9"><a href="lab5.html#cb5-9"></a><span class="va">Map</span>.<span class="at">addLayer</span>(trend<span class="op">,</span> <span class="op">{},</span> <span class="st">&#39;Trend Array Image&#39;</span>)</span>
<span id="cb5-10"><a href="lab5.html#cb5-10"></a><span class="co">// Flatten the coefficients into a 2-band image</span></span>
<span id="cb5-11"><a href="lab5.html#cb5-11"></a><span class="kw">var</span> coefficients <span class="op">=</span> <span class="va">trend</span>.<span class="at">select</span>(<span class="st">&#39;coefficients&#39;</span>)</span>
<span id="cb5-12"><a href="lab5.html#cb5-12"></a>    .<span class="at">arrayProject</span>([<span class="dv">0</span>])</span>
<span id="cb5-13"><a href="lab5.html#cb5-13"></a>    .<span class="at">arrayFlatten</span>([independents])<span class="op">;</span></span></code></pre></div>
<p>The image added to the map is a two band image in which each pixel contains values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. Click around the map with inspector, and look at some of the values. We can see that most pixels around our region of interest have a negative trend - although darker values indicate a shallow negative trend, while bright red pixels indicate a steeper descent.</p>
<p>Use the model to “detrend” the original NDVI time series. By detrend, we mean account for the slope of the chart and remove it from the original data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="lab5.html#cb6-1"></a><span class="co">// Compute a de-trended series.</span></span>
<span id="cb6-2"><a href="lab5.html#cb6-2"></a><span class="kw">var</span> detrended <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb6-3"><a href="lab5.html#cb6-3"></a><span class="cf">return</span> <span class="va">image</span>.<span class="at">select</span>(dependent).<span class="at">subtract</span>(</span>
<span id="cb6-4"><a href="lab5.html#cb6-4"></a>       <span class="va">image</span>.<span class="at">select</span>(independents).<span class="at">multiply</span>(coefficients).<span class="at">reduce</span>(<span class="st">&#39;sum&#39;</span>))</span>
<span id="cb6-5"><a href="lab5.html#cb6-5"></a>       .<span class="at">rename</span>(dependent)</span>
<span id="cb6-6"><a href="lab5.html#cb6-6"></a>       .<span class="at">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb6-7"><a href="lab5.html#cb6-7"></a>       <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Plot the detrended results</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="lab5.html#cb7-1"></a><span class="kw">var</span> detrendedChart <span class="op">=</span> <span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(detrended<span class="op">,</span> roi<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb7-2"><a href="lab5.html#cb7-2"></a>.<span class="at">setOptions</span>(<span class="op">{</span></span>
<span id="cb7-3"><a href="lab5.html#cb7-3"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Detrended Landsat Time Series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb7-4"><a href="lab5.html#cb7-4"></a>  <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-5"><a href="lab5.html#cb7-5"></a>  <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb7-6"><a href="lab5.html#cb7-6"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb7-7"><a href="lab5.html#cb7-7"></a><span class="at">print</span>(detrendedChart)<span class="op">;</span></span></code></pre></div>
<p>Compared to our earlier graph, the data looks similar - but now, the slight downward slope is accounted for with our linear model. Each fitted data point (data point on the linear model) is subtracted from each of the observed data points. Additionally, the Y-axis is now centered at 0, and the scale ranges from 0 to +/- 0.45 This allows us to focus on cyclical patterns in the data with long-term trends in the data removed.</p>
<div class="figure">
<img src="im/im_06_04.png" alt="" />
<p class="caption">im_06_09</p>
</div>
</div>
</div>
<div id="estimate-seasonality-with-a-harmonic-model" class="section level2">
<h2><span class="header-section-number">5.2</span> Estimate Seasonality with a Harmonic Model</h2>
<p>Consider the following linear model, where <span class="math inline">\(e_t\)</span> is random error, <span class="math inline">\(A\)</span> is amplitude, <span class="math inline">\(\omega\)</span> is frequency, and <span class="math inline">\(\phi\)</span> is phase:</p>
<p><span class="math display">\[
p_t = \beta_0 + \beta_1t + Acos(2\pi\omega t - \phi) + e_t
\]</span></p>
<p>We can decompose our function into separate cosine and sine elements.</p>
<p><span class="math display">\[
p_t = \beta_0 + \beta_1t + \beta_2cos(2\pi\omega t) + \beta_3sin(2\pi\omega t) + e_t
\]</span></p>
<p>Note that <span class="math inline">\(\beta_2 = Acos(\phi)\)</span> and <span class="math inline">\(\beta_3 = Asin(\phi)\)</span>, implying <span class="math inline">\(A = (\beta_2^2 + \beta_3^2)^½\)</span> and <span class="math inline">\(\phi = atan(\frac{\beta_3}{\beta_2})\)</span>).</p>
<p>If the math here does not make sense, basically we are breaking up more complex curves into a set of simplified cosine waves and an additive term. Mark Jakubauskas has an informative paper that breaks down the process in this <a href="https://www.isprs.org/proceedings/xxxiii/congress/part4/384_xxxiii-part4.pdf">paper</a>. Building a harmonic model is used in many remote sensing applications because of its flexibility for accounting for cyclicality with simple</p>
<p>To fit this model to the time series, set <span class="math inline">\(\omega\)</span>=1 (one cycle per unit time) and use ordinary least squares regression.</p>
<p>The setup for fitting the model is to first add the harmonic variables (the third and fourth terms of equation 2) to the image collection.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="lab5.html#cb8-1"></a><span class="co">// Use these independent variables in the harmonic regression.</span></span>
<span id="cb8-2"><a href="lab5.html#cb8-2"></a><span class="kw">var</span> harmonicIndependents <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span><span class="op">,</span> <span class="st">&#39;cos&#39;</span><span class="op">,</span> <span class="st">&#39;sin&#39;</span>])<span class="op">;</span></span>
<span id="cb8-3"><a href="lab5.html#cb8-3"></a><span class="co">// Add harmonic terms as new image bands.</span></span>
<span id="cb8-4"><a href="lab5.html#cb8-4"></a><span class="kw">var</span> harmonicLandsat <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb8-5"><a href="lab5.html#cb8-5"></a>  <span class="kw">var</span> timeRadians <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;t&#39;</span>).<span class="at">multiply</span>(<span class="dv">2</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></span>
<span id="cb8-6"><a href="lab5.html#cb8-6"></a>    <span class="cf">return</span> image</span>
<span id="cb8-7"><a href="lab5.html#cb8-7"></a>      .<span class="at">addBands</span>(<span class="va">timeRadians</span>.<span class="at">cos</span>().<span class="at">rename</span>(<span class="st">&#39;cos&#39;</span>))</span>
<span id="cb8-8"><a href="lab5.html#cb8-8"></a>      .<span class="at">addBands</span>(<span class="va">timeRadians</span>.<span class="at">sin</span>().<span class="at">rename</span>(<span class="st">&#39;sin&#39;</span>))<span class="op">;</span></span>
<span id="cb8-9"><a href="lab5.html#cb8-9"></a>  <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Fit the model as with the linear trend, using the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="lab5.html#cb9-1"></a><span class="kw">var</span> harmonicTrend <span class="op">=</span> harmonicLandsat</span>
<span id="cb9-2"><a href="lab5.html#cb9-2"></a>  .<span class="at">select</span>(<span class="va">harmonicIndependents</span>.<span class="at">add</span>(dependent))</span>
<span id="cb9-3"><a href="lab5.html#cb9-3"></a>  <span class="co">// The output of this reducer is a 4x1 array image.</span></span>
<span id="cb9-4"><a href="lab5.html#cb9-4"></a>  .<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="op">{</span></span>
<span id="cb9-5"><a href="lab5.html#cb9-5"></a>  <span class="dt">numX</span><span class="op">:</span> <span class="va">harmonicIndependents</span>.<span class="at">length</span>()<span class="op">,</span> </span>
<span id="cb9-6"><a href="lab5.html#cb9-6"></a>  <span class="dt">numY</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb9-7"><a href="lab5.html#cb9-7"></a>  <span class="op">}</span>))<span class="op">;</span></span></code></pre></div>
<p>Plug the coefficients in to equation 2 in order to get a time series of fitted values:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="lab5.html#cb10-1"></a><span class="co">// Turn the array image into a multi-band image of coefficients.</span></span>
<span id="cb10-2"><a href="lab5.html#cb10-2"></a><span class="kw">var</span> harmonicTrendCoefficients <span class="op">=</span> <span class="va">harmonicTrend</span>.<span class="at">select</span>(<span class="st">&#39;coefficients&#39;</span>) </span>
<span id="cb10-3"><a href="lab5.html#cb10-3"></a>        .<span class="at">arrayProject</span>([<span class="dv">0</span>])              </span>
<span id="cb10-4"><a href="lab5.html#cb10-4"></a>        .<span class="at">arrayFlatten</span>([harmonicIndependents])<span class="op">;</span></span>
<span id="cb10-5"><a href="lab5.html#cb10-5"></a><span class="co">// Compute fitted values.</span></span>
<span id="cb10-6"><a href="lab5.html#cb10-6"></a><span class="kw">var</span> fittedHarmonic <span class="op">=</span> <span class="va">harmonicLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span> </span>
<span id="cb10-7"><a href="lab5.html#cb10-7"></a>  <span class="cf">return</span> <span class="va">image</span>.<span class="at">addBands</span>(  </span>
<span id="cb10-8"><a href="lab5.html#cb10-8"></a>  <span class="va">image</span>.<span class="at">select</span>(harmonicIndependents)   </span>
<span id="cb10-9"><a href="lab5.html#cb10-9"></a>  .<span class="at">multiply</span>(harmonicTrendCoefficients)   </span>
<span id="cb10-10"><a href="lab5.html#cb10-10"></a>  .<span class="at">reduce</span>(<span class="st">&#39;sum&#39;</span>)   </span>
<span id="cb10-11"><a href="lab5.html#cb10-11"></a>  .<span class="at">rename</span>(<span class="st">&#39;fitted&#39;</span>))<span class="op">;</span></span>
<span id="cb10-12"><a href="lab5.html#cb10-12"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb10-13"><a href="lab5.html#cb10-13"></a><span class="co">// Plot the fitted model and the original data at the ROI.</span></span>
<span id="cb10-14"><a href="lab5.html#cb10-14"></a><span class="at">print</span>(<span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(<span class="va">fittedHarmonic</span>.<span class="at">select</span>([<span class="st">&#39;fitted&#39;</span><span class="op">,</span><span class="st">&#39;NDVI&#39;</span>])<span class="op">,</span> roi<span class="op">,</span></span>
<span id="cb10-15"><a href="lab5.html#cb10-15"></a>                  <span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">mean</span>()<span class="op">,</span> <span class="dv">30</span>)  </span>
<span id="cb10-16"><a href="lab5.html#cb10-16"></a>  .<span class="at">setSeriesNames</span>([<span class="st">&#39;NDVI&#39;</span><span class="op">,</span> <span class="st">&#39;fitted&#39;</span>])  </span>
<span id="cb10-17"><a href="lab5.html#cb10-17"></a>  .<span class="at">setOptions</span>(<span class="op">{</span>   </span>
<span id="cb10-18"><a href="lab5.html#cb10-18"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Harmonic Model: Original and Fitted Values&#39;</span><span class="op">,</span>   </span>
<span id="cb10-19"><a href="lab5.html#cb10-19"></a>  <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>   </span>
<span id="cb10-20"><a href="lab5.html#cb10-20"></a>  <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,}</span>))<span class="op">;</span></span></code></pre></div>
<p>The harmonic overlay (red data points) does an adequate job of modeling the data - There is a datapoint in Feb 2021 that is significantly less, but this appears to be an outlier. Additionally, the model misses a significant dip in July 2015, although this might be due to the climate conditions that were irregular - other years did not have the same dip.</p>
<div class="figure">
<img src="im/im_06_05.png" alt="" />
<p class="caption">im_06_10</p>
</div>
<hr />
<p><i class="fa fa-file"></i> <strong>Upload the resulting graphic and interpret it. </strong></p>
<hr />
<p>Although any coefficients can be mapped directly, it is often useful and interesting to map the phase and amplitude of the estimated harmonic model. First, compute phase and amplitude from the coefficients, then incorporate this information into each pixel. Use inspector to look at the pixels and note their phase and amplitude.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="lab5.html#cb11-1"></a><span class="co">// Compute phase and amplitude.</span></span>
<span id="cb11-2"><a href="lab5.html#cb11-2"></a><span class="kw">var</span> phase <span class="op">=</span> <span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;sin&#39;</span>)</span>
<span id="cb11-3"><a href="lab5.html#cb11-3"></a>        .<span class="at">atan2</span>(<span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb11-4"><a href="lab5.html#cb11-4"></a>        <span class="co">// Scale to [0, 1] from radians.  </span></span>
<span id="cb11-5"><a href="lab5.html#cb11-5"></a>  .<span class="at">unitScale</span>(<span class="op">-</span><span class="va">Math</span>.<span class="at">PI</span><span class="op">,</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></span>
<span id="cb11-6"><a href="lab5.html#cb11-6"></a><span class="kw">var</span> amplitude <span class="op">=</span> <span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;sin&#39;</span>)</span>
<span id="cb11-7"><a href="lab5.html#cb11-7"></a>        .<span class="at">hypot</span>(<span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb11-8"><a href="lab5.html#cb11-8"></a>        <span class="co">// Add a scale factor for visualization.  </span></span>
<span id="cb11-9"><a href="lab5.html#cb11-9"></a>  .<span class="at">multiply</span>(<span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb11-10"><a href="lab5.html#cb11-10"></a><span class="co">// Compute the mean NDVI.</span></span>
<span id="cb11-11"><a href="lab5.html#cb11-11"></a><span class="kw">var</span> meanNdvi <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>).<span class="at">mean</span>()<span class="op">;</span></span>
<span id="cb11-12"><a href="lab5.html#cb11-12"></a><span class="co">// Use the HSV to RGB transformation to display phase and amplitude.</span></span>
<span id="cb11-13"><a href="lab5.html#cb11-13"></a><span class="kw">var</span> rgb <span class="op">=</span> <span class="va">ee</span>.<span class="va">Image</span>.<span class="at">cat</span>([</span>
<span id="cb11-14"><a href="lab5.html#cb11-14"></a>                        phase<span class="op">,</span></span>
<span id="cb11-15"><a href="lab5.html#cb11-15"></a>                        amplitude<span class="op">,</span> </span>
<span id="cb11-16"><a href="lab5.html#cb11-16"></a>                        meanNdvi</span>
<span id="cb11-17"><a href="lab5.html#cb11-17"></a>        ]).<span class="at">hsvToRgb</span>()</span>
<span id="cb11-18"><a href="lab5.html#cb11-18"></a><span class="va">Map</span>.<span class="at">addLayer</span>(rgb<span class="op">,</span> <span class="op">{},</span> <span class="st">&#39;phase (hue), amplitude (sat), ndvi (val)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<hr />
<p><i class="fa fa-file"></i> <strong>Upload the resulting map layer and describe its salient features.</strong></p>
<hr />
<p>A time series can be decomposed as the sum of sinusoids at different frequencies. The harmonic model presented here can be easily extended by adding bands that represent higher frequencies and the corresponding <code>sin()</code> band for a harmonic component to account for two cycles per year.</p>
<p>You can look at this <a href="https://code.earthengine.google.com/2669122497313113fc4bb81bc8352828">example</a> of using multiple sinusoids to build a more complex harmonic model. Note that each year there is a high peak in June and a secondary peak in January - this harmonic model consisting of two sinusoids is able to account for that. However, the error values in this case are high and the fit is quite inexact. In your research, this harmonic model might not be appropriate due to overfitting - in other words, this model might be providing a false sense of comfort in it’s explanatory ability.</p>
<div class="figure">
<img src="im/im_06_06.png" alt="" />
<p class="caption">im_06_11</p>
</div>
</div>
<div id="additional-exercises-3" class="section level2">
<h2><span class="header-section-number">5.3</span> Additional Exercises</h2>
<p><i class="fa fa-file"></i> <strong>Look in google scholar to identify 2-3 publications that have used a harmonic regression in a time series analysis of remotely sensed data in particular. Provide citations for the articles, and then describe for what purposes was the technique used and what was the justification provided for its use.</strong></p>
</div>
<div id="where-to-submit-4" class="section level2 unnumbered">
<h2>Where to submit</h2>
<p>Submit your responses to these questions on <a href="https://www.gradescope.com/courses/293173/assignments/1446622/submissions">Gradescope</a> by 10am on Wednesday, October 06. If needed, the access code for our course is <code>6PEW3W</code>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="classification.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["labs-rsss.pdf"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
