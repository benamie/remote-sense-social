<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 5 Regression and Time Series | Remote Sensing in the Social Sciences</title>
  <meta name="description" content="Lab 5 Regression and Time Series | Remote Sensing in the Social Sciences" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 5 Regression and Time Series | Remote Sensing in the Social Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 5 Regression and Time Series | Remote Sensing in the Social Sciences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lab4.html"/>

<script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html"><i class="fa fa-check"></i>PreLab: Getting Started</a><ul>
<li class="chapter" data-level="" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="0.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#data-and-methods"><i class="fa fa-check"></i><b>0.1</b> Data and Methods</a></li>
<li class="chapter" data-level="0.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images-and-image-collections"><i class="fa fa-check"></i><b>0.2</b> Images and Image Collections</a><ul>
<li class="chapter" data-level="0.2.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#images"><i class="fa fa-check"></i><b>0.2.1</b> Images</a></li>
<li class="chapter" data-level="0.2.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#image-collections"><i class="fa fa-check"></i><b>0.2.2</b> Image Collections</a></li>
<li class="chapter" data-level="0.2.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#sensed-versus-derived-imagery"><i class="fa fa-check"></i><b>0.2.3</b> Sensed versus Derived Imagery</a></li>
</ul></li>
<li class="chapter" data-level="0.3" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#geometries"><i class="fa fa-check"></i><b>0.3</b> Geometries</a></li>
<li class="chapter" data-level="0.4" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features-and-feature-collections"><i class="fa fa-check"></i><b>0.4</b> Features and Feature Collections</a><ul>
<li class="chapter" data-level="0.4.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#features"><i class="fa fa-check"></i><b>0.4.1</b> Features</a></li>
<li class="chapter" data-level="0.4.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#feature-collections"><i class="fa fa-check"></i><b>0.4.2</b> Feature Collections</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#methods-reducers"><i class="fa fa-check"></i><b>0.5</b> Methods: Reducers</a></li>
<li class="chapter" data-level="0.6" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#joins-and-arrays"><i class="fa fa-check"></i><b>0.6</b> Joins and Arrays</a><ul>
<li class="chapter" data-level="0.6.1" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#join"><i class="fa fa-check"></i><b>0.6.1</b> Join</a></li>
<li class="chapter" data-level="0.6.2" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#arrays"><i class="fa fa-check"></i><b>0.6.2</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="prelab-getting-started.html"><a href="prelab-getting-started.html#additional-resources"><i class="fa fa-check"></i><b>0.7</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="lab1.html"><a href="lab1.html"><i class="fa fa-check"></i><b>1</b> Remote Sensing Background</a><ul>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1.1" data-path="lab1.html"><a href="lab1.html#what-is-a-digital-image"><i class="fa fa-check"></i><b>1.1</b> What is a digital image?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="lab1.html"><a href="lab1.html#from-digital-image-to-geospatial-image"><i class="fa fa-check"></i><b>1.1.1</b> From digital image to geospatial image</a></li>
<li class="chapter" data-level="1.1.2" data-path="lab1.html"><a href="lab1.html#visualize-a-digital-image"><i class="fa fa-check"></i><b>1.1.2</b> Visualize a Digital Image</a></li>
<li class="chapter" data-level="1.1.3" data-path="lab1.html"><a href="lab1.html#digital-image-visualization-and-stretching"><i class="fa fa-check"></i><b>1.1.3</b> Digital Image Visualization and Stretching</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="lab1.html"><a href="lab1.html#spatial-resolution"><i class="fa fa-check"></i><b>1.2</b> Spatial Resolution</a><ul>
<li class="chapter" data-level="1.2.1" data-path="lab1.html"><a href="lab1.html#modis"><i class="fa fa-check"></i><b>1.2.1</b> MODIS</a></li>
<li class="chapter" data-level="1.2.2" data-path="lab1.html"><a href="lab1.html#multispectral-scanners"><i class="fa fa-check"></i><b>1.2.2</b> Multispectral Scanners</a></li>
<li class="chapter" data-level="1.2.3" data-path="lab1.html"><a href="lab1.html#thematic-mapper-tm"><i class="fa fa-check"></i><b>1.2.3</b> Thematic Mapper (TM)</a></li>
<li class="chapter" data-level="1.2.4" data-path="lab1.html"><a href="lab1.html#national-agriculture-imagery-program-naip"><i class="fa fa-check"></i><b>1.2.4</b> National Agriculture Imagery Program (NAIP)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="lab1.html"><a href="lab1.html#spectral-resolution"><i class="fa fa-check"></i><b>1.3</b> Spectral Resolution</a></li>
<li class="chapter" data-level="1.4" data-path="lab1.html"><a href="lab1.html#temporal-resolution"><i class="fa fa-check"></i><b>1.4</b> Temporal Resolution</a><ul>
<li class="chapter" data-level="1.4.1" data-path="lab1.html"><a href="lab1.html#modis-1"><i class="fa fa-check"></i><b>1.4.1</b> MODIS</a></li>
<li class="chapter" data-level="1.4.2" data-path="lab1.html"><a href="lab1.html#landsat"><i class="fa fa-check"></i><b>1.4.2</b> Landsat</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="lab1.html"><a href="lab1.html#radiometric-resolution"><i class="fa fa-check"></i><b>1.5</b> Radiometric Resolution</a></li>
<li class="chapter" data-level="1.6" data-path="lab1.html"><a href="lab1.html#resampling-and-reprojection"><i class="fa fa-check"></i><b>1.6</b> Resampling and ReProjection</a></li>
<li class="chapter" data-level="1.7" data-path="lab1.html"><a href="lab1.html#additional-exercises"><i class="fa fa-check"></i><b>1.7</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab1.html"><a href="lab1.html#where-to-submit"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab2.html"><a href="lab2.html"><i class="fa fa-check"></i><b>2</b> Digital Imagery &amp; Image Processing</a><ul>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#overview-2"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="2.1" data-path="lab2.html"><a href="lab2.html#searching-for-imagery-exercise-1"><i class="fa fa-check"></i><b>2.1</b> Searching for Imagery (Exercise 1)</a></li>
<li class="chapter" data-level="2.2" data-path="lab2.html"><a href="lab2.html#visualizing-landsat-imagery"><i class="fa fa-check"></i><b>2.2</b> Visualizing Landsat Imagery</a></li>
<li class="chapter" data-level="2.3" data-path="lab2.html"><a href="lab2.html#plot-at-sensor-radiance"><i class="fa fa-check"></i><b>2.3</b> Plot at-Sensor Radiance</a></li>
<li class="chapter" data-level="2.4" data-path="lab2.html"><a href="lab2.html#plot-top-of-atmosphere-toa-reflectance"><i class="fa fa-check"></i><b>2.4</b> Plot Top-of-Atmosphere (TOA) Reflectance</a></li>
<li class="chapter" data-level="2.5" data-path="lab2.html"><a href="lab2.html#plot-surface-reflectance"><i class="fa fa-check"></i><b>2.5</b> Plot Surface Reflectance</a></li>
<li class="chapter" data-level="2.6" data-path="lab2.html"><a href="lab2.html#additional-exercises-1"><i class="fa fa-check"></i><b>2.6</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab2.html"><a href="lab2.html#where-to-submit-1"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab3.html"><a href="lab3.html"><i class="fa fa-check"></i><b>3</b> Spectral Indices &amp; Transformations</a><ul>
<li class="chapter" data-level="" data-path="lab3.html"><a href="lab3.html#overview-3"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="3.1" data-path="lab3.html"><a href="lab3.html#spectral-indices"><i class="fa fa-check"></i><b>3.1</b> Spectral Indices</a><ul>
<li class="chapter" data-level="3.1.1" data-path="lab3.html"><a href="lab3.html#important-indices"><i class="fa fa-check"></i><b>3.1.1</b> Important Indices</a></li>
<li class="chapter" data-level="3.1.2" data-path="lab3.html"><a href="lab3.html#linear-transformations"><i class="fa fa-check"></i><b>3.1.2</b> Linear Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="lab3.html"><a href="lab3.html#spectral-transformation"><i class="fa fa-check"></i><b>3.2</b> Spectral Transformation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="lab3.html"><a href="lab3.html#linear-filtering"><i class="fa fa-check"></i><b>3.2.1</b> Linear Filtering</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="lab3.html"><a href="lab3.html#additional-exercises-2"><i class="fa fa-check"></i><b>3.3</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab3.html"><a href="lab3.html#where-to-submit-2"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab4.html"><a href="lab4.html"><i class="fa fa-check"></i><b>4</b> Classification</a><ul>
<li class="chapter" data-level="" data-path="lab4.html"><a href="lab4.html#overview-4"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="4.1" data-path="lab4.html"><a href="lab4.html#unsupervised-classification"><i class="fa fa-check"></i><b>4.1</b> Unsupervised Classification</a></li>
<li class="chapter" data-level="4.2" data-path="lab4.html"><a href="lab4.html#supervised-classification"><i class="fa fa-check"></i><b>4.2</b> Supervised Classification</a></li>
<li class="chapter" data-level="4.3" data-path="lab4.html"><a href="lab4.html#accuracy-assessment"><i class="fa fa-check"></i><b>4.3</b> Accuracy Assessment</a></li>
<li class="chapter" data-level="4.4" data-path="lab4.html"><a href="lab4.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>4.4</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="4.5" data-path="lab4.html"><a href="lab4.html#additional-exercises-3"><i class="fa fa-check"></i><b>4.5</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab4.html"><a href="lab4.html#where-to-submit-3"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab5.html"><a href="lab5.html"><i class="fa fa-check"></i><b>5</b> Regression and Time Series</a><ul>
<li class="chapter" data-level="" data-path="lab5.html"><a href="lab5.html#overview-5"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="5.1" data-path="lab5.html"><a href="lab5.html#regression"><i class="fa fa-check"></i><b>5.1</b> Regression</a><ul>
<li class="chapter" data-level="5.1.1" data-path="lab5.html"><a href="lab5.html#ordinary-least-squares-ols"><i class="fa fa-check"></i><b>5.1.1</b> Ordinary Least Squares (OLS)</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="lab5.html"><a href="lab5.html#nonlinear-regression"><i class="fa fa-check"></i><b>5.2</b> Nonlinear Regression</a></li>
<li class="chapter" data-level="5.3" data-path="lab5.html"><a href="lab5.html#time-series"><i class="fa fa-check"></i><b>5.3</b> Time Series</a><ul>
<li class="chapter" data-level="5.3.1" data-path="lab5.html"><a href="lab5.html#multi-temporal-data-in-earth-engine"><i class="fa fa-check"></i><b>5.3.1</b> Multi-Temporal Data in Earth Engine</a></li>
<li class="chapter" data-level="5.3.2" data-path="lab5.html"><a href="lab5.html#data-preparation-and-preprocessing"><i class="fa fa-check"></i><b>5.3.2</b> Data Preparation and Preprocessing</a></li>
<li class="chapter" data-level="5.3.3" data-path="lab5.html"><a href="lab5.html#linear-modeling-of-time"><i class="fa fa-check"></i><b>5.3.3</b> Linear Modeling of Time</a></li>
<li class="chapter" data-level="5.3.4" data-path="lab5.html"><a href="lab5.html#estimate-seasonality-with-a-harmonic-model"><i class="fa fa-check"></i><b>5.3.4</b> Estimate Seasonality with a Harmonic Model</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="lab5.html"><a href="lab5.html#additional-exercises-4"><i class="fa fa-check"></i><b>5.4</b> Additional Exercises</a></li>
<li class="chapter" data-level="" data-path="lab5.html"><a href="lab5.html#where-to-submit-4"><i class="fa fa-check"></i>Where to submit</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Remote Sensing in the Social Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab5" class="section level1">
<h1><span class="header-section-number">Lab 5</span> Regression and Time Series</h1>
<div id="overview-5" class="section level2 unnumbered">
<h2>Overview</h2>
<p>Classifying imagery is an essential part of Remote Sensing research. In the previous lab, we began working with classification and regression, and we will continue on this same path for the first half of this lab. We will begin to explore Random Forest models more in depth, which were briefly introduced in the previous lab. Ultimately, the purpose of classification in this context is to use known characteristics of a subset of the image to make a best-estimate classification of the rest of the image.</p>
<p>We will then move to time series analysis, and part of the lab will allow you to establish a foundation for analyzing time series of remotely sensed data, usually in the form of a temporally ordered stack of images. By completion, you should be able to start to perform analysis of multi-temporal data for evaluating trends and seasonality. By completion, you should be able to perform analysis of multi-temporal data for evaluating trends and seasonality.</p>
</div>
<div id="regression" class="section level2">
<h2><span class="header-section-number">5.1</span> Regression</h2>
<p>In the present context, regression means predicting a numeric variable instead of a class label. No lab on regression would be complete without the requisite introduction to least squares regression.</p>
<div id="ordinary-least-squares-ols" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Ordinary Least Squares (OLS)</h3>
<p><a href="https://en.wikipedia.org/wiki/Ordinary_least_squares">Ordinary regression</a> is when <em>G</em> is a linear function of the form <em>G</em>(<strong>p</strong>) = <strong>βp</strong> where <strong>β</strong> is a vector of coefficients. Once <em>G</em> is trained by some training set <strong>T</strong>, we can estimate the the value for some unknown <strong>p</strong> by multiplying it with <strong>β</strong>.</p>
<p>Suppose the goal is to estimate percent tree cover in each Landsat pixel.</p>
<p>Import data to use known values for <em>g</em>. Search ‘vegetation continuous fields’ to import ‘MOD44B.006’ as the variable <code>mod44b</code> and extract the most recent image.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="lab5.html#cb1-1"></a><span class="kw">var</span> tree <span class="op">=</span> <span class="va">ee</span>.<span class="at">Image</span>(<span class="va">mod44b</span>.<span class="at">sort</span>(<span class="st">&#39;system:time_start&#39;</span><span class="op">,</span> <span class="kw">false</span>).<span class="at">first</span>())<span class="op">;</span></span></code></pre></div>
<p>Since water is coded as 200 in this image, replace the 200’s with 0’s and display the result. Documentation for the <code>.where</code> clause is at this <a href="https://developers.google.com/earth-engine/apidocs/ee-image-where?hl=en">link</a>. Scroll in and note that when you click on a water area it will say ‘masked’, where as an area on land will provide a numerical value listed as ‘Percent_Tree_Cover’.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="lab5.html#cb2-1"></a><span class="kw">var</span> percentTree <span class="op">=</span> <span class="va">tree</span>.<span class="at">select</span>(<span class="st">&#39;Percent_Tree_Cover&#39;</span>)</span>
<span id="cb2-2"><a href="lab5.html#cb2-2"></a>.<span class="at">where</span>(<span class="va">tree</span>.<span class="at">select</span>(<span class="st">&#39;Percent_Tree_Cover&#39;</span>).<span class="at">eq</span>(<span class="dv">200</span>)<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-3"><a href="lab5.html#cb2-3"></a><span class="kw">var</span> visualization <span class="op">=</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="lab5.html#cb2-4"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;Percent_Tree_Cover&#39;</span>]<span class="op">,</span></span>
<span id="cb2-5"><a href="lab5.html#cb2-5"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb2-6"><a href="lab5.html#cb2-6"></a>  <span class="dt">max</span><span class="op">:</span> <span class="fl">100.0</span><span class="op">,</span></span>
<span id="cb2-7"><a href="lab5.html#cb2-7"></a>  <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;bbe029&#39;</span><span class="op">,</span> <span class="st">&#39;0a9501&#39;</span><span class="op">,</span> <span class="st">&#39;074b03&#39;</span>]</span>
<span id="cb2-8"><a href="lab5.html#cb2-8"></a><span class="op">};</span></span>
<span id="cb2-9"><a href="lab5.html#cb2-9"></a><span class="va">Map</span>.<span class="at">addLayer</span>(percentTree<span class="op">,</span> visualization<span class="op">,</span> <span class="st">&#39;percent tree cover&#39;</span>)<span class="op">;</span> </span></code></pre></div>
<p>Each pixel represents percent tree cover (as an integer value) at 250 meter resolution in 2010. Import data to use as predictor variables (<strong>p</strong>). Search ‘landsat 5 raw’ and import ‘USGS Landsat 5 TM Collection 1 Tier 1 Raw Scenes’. Name the import <code>landsat5_raw</code>. Filter by time and the <a href="https://www.usgs.gov/faqs/what-worldwide-reference-system-wrs?qt-news_science_products=0#qt-news_science_products">WRS-2</a> path and row to get only scenes over the San Francisco bay area in 2010.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="lab5.html#cb3-1"></a><span class="kw">var</span> landsat5_filtered <span class="op">=</span> <span class="va">landsat5_raw</span>.<span class="at">filterDate</span>(<span class="st">&#39;2010-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2010-12-31&#39;</span>)</span>
<span id="cb3-2"><a href="lab5.html#cb3-2"></a>.<span class="at">filterMetadata</span>(<span class="st">&#39;WRS_PATH&#39;</span><span class="op">,</span> <span class="st">&#39;equals&#39;</span><span class="op">,</span> <span class="dv">44</span>)</span>
<span id="cb3-3"><a href="lab5.html#cb3-3"></a>.<span class="at">filterMetadata</span>(<span class="st">&#39;WRS_ROW&#39;</span><span class="op">,</span> <span class="st">&#39;equals&#39;</span><span class="op">,</span> <span class="dv">34</span>)<span class="op">;</span></span></code></pre></div>
<p>Use an Earth Engine algorithm to get a cloud-free composite of Landsat imagery in 2010. Note that this will provide landsat imagery over the area of San Francisco - if you use the inspector to click anywhere else, the values are ‘masked’.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="lab5.html#cb4-1"></a><span class="kw">var</span> landsat <span class="op">=</span> <span class="va">ee</span>.<span class="va">Algorithms</span>.<span class="va">Landsat</span>.<span class="at">simpleComposite</span>(<span class="op">{</span></span>
<span id="cb4-2"><a href="lab5.html#cb4-2"></a>  <span class="dt">collection</span><span class="op">:</span> l5filtered<span class="op">,</span></span>
<span id="cb4-3"><a href="lab5.html#cb4-3"></a>  <span class="dt">asFloat</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb4-4"><a href="lab5.html#cb4-4"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="lab5.html#cb4-5"></a><span class="va">Map</span>.<span class="at">setCenter</span>(<span class="op">-</span><span class="fl">121.9</span><span class="op">,</span> <span class="fl">37.7</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb4-6"><a href="lab5.html#cb4-6"></a><span class="va">Map</span>.<span class="at">addLayer</span>(landsat<span class="op">,</span> <span class="op">{</span><span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">},</span> <span class="st">&#39;composite&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Specify the bands of the Landsat composite to be used as predictors (i.e. the elements of <strong>p</strong>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="lab5.html#cb5-1"></a><span class="kw">var</span> predictionBands <span class="op">=</span> [<span class="st">&#39;B1&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;B6&#39;</span><span class="op">,</span> <span class="st">&#39;B7&#39;</span>]<span class="op">;</span></span></code></pre></div>
<p>Now that all the input data is ready, we can build the shell of our linear regression equation. It’s customary to include a constant term in linear regression to make it the <a href="https://en.wikipedia.org/wiki/Gauss–Markov_theorem">best linear unbiased estimator</a>. Stack a constant, the predictor variables and the ‘Percent Tree Cover’ Image as the variable <code>trainingImage</code>, representing known <em>g</em>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="lab5.html#cb6-1"></a><span class="kw">var</span> trainingImage <span class="op">=</span> <span class="va">ee</span>.<span class="at">Image</span>(<span class="dv">1</span>)</span>
<span id="cb6-2"><a href="lab5.html#cb6-2"></a>  .<span class="at">addBands</span>(<span class="va">landsat</span>.<span class="at">select</span>(predictionBands))</span>
<span id="cb6-3"><a href="lab5.html#cb6-3"></a>  .<span class="at">addBands</span>(percentTree)<span class="op">;</span></span></code></pre></div>
<p>If you print <code>trainingImage</code> to the console, you will see that the format of the data that we have follows the typical equation for linear regression.</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1X_1 + ... + \beta_nX_n + \epsilon \]</span>
<img src="im_05_01.png" width="95%" style="display: block; margin: auto;" />
Sample 1000 pixels out of <code>trainingImage</code>, to get a table of Feature Collections, each containing a value for each band (1-7), a value for the ‘Percent Tree Cover’, and a constant (value of 1).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="lab5.html#cb7-1"></a><span class="kw">var</span> training <span class="op">=</span> <span class="va">trainingImage</span>.<span class="at">sample</span>(<span class="op">{</span></span>
<span id="cb7-2"><a href="lab5.html#cb7-2"></a> <span class="dt">region</span><span class="op">:</span> <span class="va">landsat5_filtered</span>.<span class="at">first</span>().<span class="at">geometry</span>()<span class="op">,</span> </span>
<span id="cb7-3"><a href="lab5.html#cb7-3"></a> <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> </span>
<span id="cb7-4"><a href="lab5.html#cb7-4"></a> <span class="dt">numPixels</span><span class="op">:</span> <span class="dv">1000</span></span>
<span id="cb7-5"><a href="lab5.html#cb7-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Inspect the first element of <code>training</code> to make sure it has all of the expected data.</p>
<hr />
<p><i class="fa fa-file"></i> <strong>What do you expect to see when you inspect the first element of training, and how does that compare with what you ultimately end up seeing?</strong></p>
<hr />
<p>The next step is to train <em>G</em>. Make a list of the variable names, predictors followed by <em>g</em>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="lab5.html#cb8-1"></a><span class="kw">var</span> trainingList <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>(predictionBands)</span>
<span id="cb8-2"><a href="lab5.html#cb8-2"></a>  .<span class="at">insert</span>(<span class="dv">0</span><span class="op">,</span> <span class="st">&#39;constant&#39;</span>)</span>
<span id="cb8-3"><a href="lab5.html#cb8-3"></a>  .<span class="at">add</span>(<span class="st">&#39;Percent_Tree_Cover&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>In Earth Engine, <a href="https://developers.google.com/earth-engine/reducers_regression">linear regression is implemented as a Reducer</a>. This means that training <em>G</em> is a reduction of the <strong>T</strong> table, performed using the list of variables as an input. The argument (8) tells the reducer how many of the input variables are predictors - note that we have 1 as a constant.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="lab5.html#cb9-1"></a><span class="kw">var</span> regression <span class="op">=</span> <span class="va">training</span>.<span class="at">reduceColumns</span>(<span class="op">{</span> </span>
<span id="cb9-2"><a href="lab5.html#cb9-2"></a>    <span class="dt">reducer</span><span class="op">:</span> <span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="dv">8</span>)<span class="op">,</span>  </span>
<span id="cb9-3"><a href="lab5.html#cb9-3"></a>    <span class="dt">selectors</span><span class="op">:</span> trainingList</span>
<span id="cb9-4"><a href="lab5.html#cb9-4"></a>  <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Print <code>regression</code> - we now have a coefficient for each of the predictor variables (in the order specified by the inputs list), along with a value for residuals (the difference between the observed and predicted values).</p>
<p><img src="im_05_02.png" width="50%" style="display: block; margin: auto;" />
<!-- ![Object Zoom](./im_05_02.png) -->
To use the coefficients to make a prediction in every pixel, first turn the output coefficients into an image, then perform the multiplication and addition that implements <span class="math inline">\(\beta_p\)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="lab5.html#cb10-1"></a><span class="kw">var</span> coefficients <span class="op">=</span> <span class="va">ee</span>.<span class="at">Array</span>(<span class="va">regression</span>.<span class="at">get</span>(<span class="st">&#39;coefficients&#39;</span>))</span>
<span id="cb10-2"><a href="lab5.html#cb10-2"></a>        .<span class="at">project</span>([<span class="dv">0</span>])  </span>
<span id="cb10-3"><a href="lab5.html#cb10-3"></a>        .<span class="at">toList</span>()<span class="op">;</span></span>
<span id="cb10-4"><a href="lab5.html#cb10-4"></a><span class="kw">var</span> predictedTreeCover <span class="op">=</span> <span class="va">ee</span>.<span class="at">Image</span>(<span class="dv">1</span>)</span>
<span id="cb10-5"><a href="lab5.html#cb10-5"></a>        .<span class="at">addBands</span>(<span class="va">landsat</span>.<span class="at">select</span>(predictionBands))              </span>
<span id="cb10-6"><a href="lab5.html#cb10-6"></a>        .<span class="at">multiply</span>(<span class="va">ee</span>.<span class="va">Image</span>.<span class="at">constant</span>(coefficients))              </span>
<span id="cb10-7"><a href="lab5.html#cb10-7"></a>        .<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">sum</span>())   </span>
<span id="cb10-8"><a href="lab5.html#cb10-8"></a>        .<span class="at">rename</span>(<span class="st">&#39;predictedTreeCover&#39;</span>)<span class="op">;</span></span>
<span id="cb10-9"><a href="lab5.html#cb10-9"></a><span class="va">Map</span>.<span class="at">addLayer</span>(predictedTreeCover<span class="op">,</span>  </span>
<span id="cb10-10"><a href="lab5.html#cb10-10"></a>             <span class="op">{</span><span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> </span>
<span id="cb10-11"><a href="lab5.html#cb10-11"></a>              <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;bbe029&#39;</span><span class="op">,</span> <span class="st">&#39;0a9501&#39;</span><span class="op">,</span> <span class="st">&#39;074b03&#39;</span>]<span class="op">},</span> </span>
<span id="cb10-12"><a href="lab5.html#cb10-12"></a>             <span class="st">&#39;prediction&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Carefully inspect this result by using the inspector on the prediction layer and comparing it to the satellite imagery basemap. Is it satisfactory?</p>
<p>If not, it might be worth testing some other regression functions, adding more predictor variables, collecting more training data, or all of the above. In remote sensing research, this is not a one-step process - to find value in these models, you will need to continuously improve, iterate and retest your assumptions.</p>
<hr />
<p><i class="fa fa-file"></i> <strong>Upload your predicted layer and your satellite imagery basemap. Discuss the salient features of the predicted output and which steps you may want to take in order to improve the results.</strong></p>
<hr />
</div>
</div>
<div id="nonlinear-regression" class="section level2">
<h2><span class="header-section-number">5.2</span> Nonlinear Regression</h2>
<p>If ordinary linear regression is not satisfactory, Earth Engine contains other functions that can make predictions of a continuous variable. Unlike linear regression, other regression functions are implemented by the classifier library.</p>
<p>For example, a Classification and Regression Tree (CART, see <a href="https://books.google.com/books/about/Classification_and_Regression_Trees.html?id=JwQx-WOmSyQC">Brieman et al. 1984</a>) is a machine learning algorithm that can learn non-linear patterns in your data. Reusing the <strong>T</strong> table (without the constant term), train a CART as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="lab5.html#cb11-1"></a><span class="kw">var</span> cartRegression <span class="op">=</span> <span class="va">ee</span>.<span class="va">Classifier</span>.<span class="at">smileCart</span>()</span>
<span id="cb11-2"><a href="lab5.html#cb11-2"></a>  .<span class="at">setOutputMode</span>(<span class="st">&#39;REGRESSION&#39;</span>)</span>
<span id="cb11-3"><a href="lab5.html#cb11-3"></a>  .<span class="at">train</span>(<span class="op">{</span></span>
<span id="cb11-4"><a href="lab5.html#cb11-4"></a>   <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span> </span>
<span id="cb11-5"><a href="lab5.html#cb11-5"></a>   <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;Percent_Tree_Cover&#39;</span><span class="op">,</span> </span>
<span id="cb11-6"><a href="lab5.html#cb11-6"></a>   <span class="dt">inputProperties</span><span class="op">:</span> predictionBands</span>
<span id="cb11-7"><a href="lab5.html#cb11-7"></a>  <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Make predictions over the input imagery:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="lab5.html#cb12-1"></a><span class="kw">var</span> cartRegressionImage <span class="op">=</span> <span class="va">landsat</span>.<span class="at">select</span>(predictionBands)</span>
<span id="cb12-2"><a href="lab5.html#cb12-2"></a>  .<span class="at">classify</span>(cartRegression<span class="op">,</span> <span class="st">&#39;cartRegression&#39;</span>)<span class="op">;</span></span>
<span id="cb12-3"><a href="lab5.html#cb12-3"></a><span class="va">Map</span>.<span class="at">addLayer</span>(cartRegressionImage<span class="op">,</span> <span class="op">{</span><span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">100</span><span class="op">},</span> <span class="st">&#39;CART regression&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Use the ‘inspector’ to compare the linear regression to the CART regression.</p>
<hr />
<p><i class="fa fa-file"></i> <strong>What do you observe when comparing the linear regression to the CART regression? Are the prediction values similar? If the output for both are similar, does the value seem to match the background imagery?</strong></p>
<hr />
<p>Although CART can work in both classification and regression mode, not all classifiers are as easily adaptable.</p>
</div>
<div id="time-series" class="section level2">
<h2><span class="header-section-number">5.3</span> Time Series</h2>
<p>One of the paradigm-changing features of Earth Engine is the ability to access decades of imagery without the previous limitation of needing to download, organize, store and process. Because these files can be prohibitively large, this limited most projects to viewing two or three images from different periods. With Earth Engine, users can access tens or hundreds of thousands of images to understand the context of change across decades.</p>
<!-- The purpose of this lab is to establish a foundation for time series analysis of remotely sensed data, usually in the form of a temporally ordered stack of images. You will be introduced to concepts of smoothing, interpolation, linear modeling and phenology. At the completion of the lab, you will be able to perform analysis of multi-temporal data for determining trend and seasonality on a per-pixel basis. -->
<div id="multi-temporal-data-in-earth-engine" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Multi-Temporal Data in Earth Engine</h3>
<p>Time series in Earth Engine are represented as image collections. This can make time series analysis complicated because</p>
<ul>
<li>There is a different time series in each pixel</li>
<li>The size (length) of the time series varies across pixels</li>
<li>Missing data may occur in any pixel at any time (e.g. due to cloud masking, hardware errors)</li>
</ul>
<p>As a result of these complicating factors, analyzing time series in Earth Engine is unlike traditional methods. Specifically, use joins to define temporal relationships between collection items. As you will soon discover, it’s possible to perform many traditional time series methods by mapping functions over joined collections.</p>
<p>First, some very basic notation. A scalar pixel at time <em>t</em> is given by <span class="math inline">\(p_{t}\)</span> and a pixel vector by <span class="math inline">\(\textbf{p}_t\)</span>. An estimate is a variable with a hat on: (e.g. the estimated pixel value at time is <span class="math inline">\(\hat{p}_{t}\)</span>). A time series is just a collection of <em>N</em> pixels, sorted chronologically: { <span class="math inline">\(\textbf{p}_{t} = t_{0} + t_{1}... t_{N}\)</span> }, where each <em>t</em> is the given value of each pixel in the series (where <span class="math inline">\(t\)</span> might be in any units, <span class="math inline">\(t_0\)</span> is the smallest and <span class="math inline">\(t_N\)</span> is the largest such <span class="math inline">\(t\)</span> in the series.)</p>
</div>
<div id="data-preparation-and-preprocessing" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Data Preparation and Preprocessing</h3>
<p>The first step in analysis of time series data is to import data of interest and plot it at an interesting location.</p>
<ol style="list-style-type: decimal">
<li><p>Load a Landsat Time Series</p>
<ol style="list-style-type: lower-alpha">
<li>We will begin by importing Landsat 8 Surface Reflectance, Tier 1 (this data is currently deprecated, but works for this lab), name it <code>landsat_8_sr</code> .</li>
<li>Make a single point geometry with the drawing tools and position the point in a location of interest. (How about an annual grassland or a deciduous forest, which change characteristics seasonally?). Name the import <code>roi</code>.</li>
</ol></li>
<li><p>Preprocess the Landsat imagery by filtering it to the location of interest, masking clouds, and adding the variables in the model:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="lab5.html#cb13-1"></a><span class="kw">var</span> landsat_8_sr <span class="op">=</span> <span class="va">ee</span>.<span class="at">ImageCollection</span>(<span class="st">&quot;LANDSAT/LC08/C01/T1_SR&quot;</span>)</span>
<span id="cb13-2"><a href="lab5.html#cb13-2"></a><span class="co">// This field contains UNIX time in milliseconds.</span></span>
<span id="cb13-3"><a href="lab5.html#cb13-3"></a><span class="kw">var</span> timeField <span class="op">=</span> <span class="st">&#39;system:time_start&#39;</span><span class="op">;</span></span>
<span id="cb13-4"><a href="lab5.html#cb13-4"></a><span class="co">// Function to cloud mask from the pixel_qa band of Landsat 8 SR data.</span></span>
<span id="cb13-5"><a href="lab5.html#cb13-5"></a><span class="kw">function</span> <span class="at">maskL8sr</span>(image) <span class="op">{</span></span>
<span id="cb13-6"><a href="lab5.html#cb13-6"></a>  <span class="co">// Bits 3 and 5 are cloud shadow and cloud, respectively.</span></span>
<span id="cb13-7"><a href="lab5.html#cb13-7"></a>  <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb13-8"><a href="lab5.html#cb13-8"></a>  <span class="kw">var</span> cloudsBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb13-9"><a href="lab5.html#cb13-9"></a>  <span class="co">// Get the pixel QA band.</span></span>
<span id="cb13-10"><a href="lab5.html#cb13-10"></a>  <span class="kw">var</span> qa <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb13-11"><a href="lab5.html#cb13-11"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb13-12"><a href="lab5.html#cb13-12"></a>  <span class="kw">var</span> mask <span class="op">=</span> <span class="va">qa</span>.<span class="at">bitwiseAnd</span>(cloudShadowBitMask).<span class="at">eq</span>(<span class="dv">0</span>)</span>
<span id="cb13-13"><a href="lab5.html#cb13-13"></a>  .<span class="at">and</span>(<span class="va">qa</span>.<span class="at">bitwiseAnd</span>(cloudsBitMask).<span class="at">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb13-14"><a href="lab5.html#cb13-14"></a>  <span class="co">// Return the masked image, scaled to reflectance, without the QA bands.</span></span>
<span id="cb13-15"><a href="lab5.html#cb13-15"></a>  <span class="cf">return</span> <span class="va">image</span>.<span class="at">updateMask</span>(mask).<span class="at">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb13-16"><a href="lab5.html#cb13-16"></a>  .<span class="at">select</span>(<span class="st">&#39;B[0-9]*&#39;</span>)</span>
<span id="cb13-17"><a href="lab5.html#cb13-17"></a>  .<span class="at">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])<span class="op">;</span></span>
<span id="cb13-18"><a href="lab5.html#cb13-18"></a><span class="op">}</span></span>
<span id="cb13-19"><a href="lab5.html#cb13-19"></a><span class="co">// Use this function to add variables for NDVI, time and a constant</span></span>
<span id="cb13-20"><a href="lab5.html#cb13-20"></a><span class="co">// to Landsat 8 imagery.</span></span>
<span id="cb13-21"><a href="lab5.html#cb13-21"></a><span class="kw">var</span> addVariables <span class="op">=</span> <span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb13-22"><a href="lab5.html#cb13-22"></a>  <span class="co">// Compute time in fractional years since the epoch.</span></span>
<span id="cb13-23"><a href="lab5.html#cb13-23"></a>  <span class="kw">var</span> date <span class="op">=</span> <span class="va">ee</span>.<span class="at">Date</span>(<span class="va">image</span>.<span class="at">get</span>(timeField))<span class="op">;</span></span>
<span id="cb13-24"><a href="lab5.html#cb13-24"></a>  <span class="kw">var</span> years <span class="op">=</span> <span class="va">date</span>.<span class="at">difference</span>(<span class="va">ee</span>.<span class="at">Date</span>(<span class="st">&#39;1970-01-01&#39;</span>)<span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">;</span></span>
<span id="cb13-25"><a href="lab5.html#cb13-25"></a>  <span class="co">// Return the image with the added bands.</span></span>
<span id="cb13-26"><a href="lab5.html#cb13-26"></a>  <span class="cf">return</span> image</span>
<span id="cb13-27"><a href="lab5.html#cb13-27"></a>  <span class="co">// Add an NDVI band.</span></span>
<span id="cb13-28"><a href="lab5.html#cb13-28"></a>  .<span class="at">addBands</span>(<span class="va">image</span>.<span class="at">normalizedDifference</span>([<span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>]).<span class="at">rename</span>(<span class="st">&#39;NDVI&#39;</span>))</span>
<span id="cb13-29"><a href="lab5.html#cb13-29"></a>  <span class="co">// Add a time band.</span></span>
<span id="cb13-30"><a href="lab5.html#cb13-30"></a>  .<span class="at">addBands</span>(<span class="va">ee</span>.<span class="at">Image</span>(years).<span class="at">rename</span>(<span class="st">&#39;t&#39;</span>))</span>
<span id="cb13-31"><a href="lab5.html#cb13-31"></a>  .<span class="at">float</span>()</span>
<span id="cb13-32"><a href="lab5.html#cb13-32"></a>  <span class="co">// Add a constant band.</span></span>
<span id="cb13-33"><a href="lab5.html#cb13-33"></a>  .<span class="at">addBands</span>(<span class="va">ee</span>.<span class="va">Image</span>.<span class="at">constant</span>(<span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb13-34"><a href="lab5.html#cb13-34"></a><span class="op">};</span></span>
<span id="cb13-35"><a href="lab5.html#cb13-35"></a><span class="co">// Remove clouds, add variables and filter to the area of interest.</span></span>
<span id="cb13-36"><a href="lab5.html#cb13-36"></a><span class="kw">var</span> filteredLandsat <span class="op">=</span> landsat_8_sr</span>
<span id="cb13-37"><a href="lab5.html#cb13-37"></a>.<span class="at">filterBounds</span>(roi)</span>
<span id="cb13-38"><a href="lab5.html#cb13-38"></a>.<span class="at">map</span>(maskL8sr)</span>
<span id="cb13-39"><a href="lab5.html#cb13-39"></a>.<span class="at">map</span>(addVariables)<span class="op">;</span></span></code></pre></div></li>
<li><p>To visualize the data, make a chart at the location of interest. Add a linear trend line for reference (you’ll compute that line soon):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="lab5.html#cb14-1"></a><span class="co">// Plot a time series of NDVI at a single location.</span></span>
<span id="cb14-2"><a href="lab5.html#cb14-2"></a><span class="kw">var</span> l8Chart <span class="op">=</span> <span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(<span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">,</span> roi)</span>
<span id="cb14-3"><a href="lab5.html#cb14-3"></a>  .<span class="at">setChartType</span>(<span class="st">&#39;ScatterChart&#39;</span>)</span>
<span id="cb14-4"><a href="lab5.html#cb14-4"></a>  .<span class="at">setOptions</span>(<span class="op">{</span></span>
<span id="cb14-5"><a href="lab5.html#cb14-5"></a>   <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Landsat 8 NDVI time series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb14-6"><a href="lab5.html#cb14-6"></a>   <span class="dt">trendlines</span><span class="op">:</span> <span class="op">{</span><span class="dv">0</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb14-7"><a href="lab5.html#cb14-7"></a>                <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span></span>
<span id="cb14-8"><a href="lab5.html#cb14-8"></a>   <span class="op">}},</span></span>
<span id="cb14-9"><a href="lab5.html#cb14-9"></a>   <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-10"><a href="lab5.html#cb14-10"></a>   <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb14-11"><a href="lab5.html#cb14-11"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb14-12"><a href="lab5.html#cb14-12"></a><span class="at">print</span>(l8Chart)<span class="op">;</span></span></code></pre></div></li>
</ol>
<p>You should see something an output similar to the below image. Note that you can see a very slight upwards trend of the value at the point. Additionally, within each year there is seasonality, which means that there is a pattern that repeats within the year.</p>
<p><img src="im_05_03.png" width="95%" style="display: block; margin: auto;" />
<!-- ![Chart, scatter chart  Description automatically generated](./im_05_03.png) --></p>
</div>
<div id="linear-modeling-of-time" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Linear Modeling of Time</h3>
<p>Lots of interesting analyses can be done to time series by harnessing the <code>linearRegression()</code> <a href="https://developers.google.com/earth-engine/api_docs#eereducerlinearregression">reducer</a>. To estimate linear trends over time, consider the following linear model, where <span class="math inline">\(\epsilon_t\)</span> is a random error:</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1X_1 + ... + \beta_nX_n + \epsilon_t \]</span>
This is the model behind the trendline added to the chart you just created. This model is useful for detrending data and reducing variability. For now, the goal is to discover the values of the <span class="math inline">\(\textbf{\beta}\)</span>’s in each pixel.</p>
<ol style="list-style-type: decimal">
<li><p>To fit this trend model to the Landsat-based NDVI series using ordinary least squares, use the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="lab5.html#cb15-1"></a><span class="co">// List of the independent variable names</span></span>
<span id="cb15-2"><a href="lab5.html#cb15-2"></a><span class="kw">var</span> independents <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span>])<span class="op">;</span></span>
<span id="cb15-3"><a href="lab5.html#cb15-3"></a><span class="co">// Name of the dependent variable.</span></span>
<span id="cb15-4"><a href="lab5.html#cb15-4"></a><span class="kw">var</span> dependent <span class="op">=</span> <span class="va">ee</span>.<span class="at">String</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb15-5"><a href="lab5.html#cb15-5"></a><span class="co">// Compute a linear trend. This will have two bands: &#39;residuals&#39; and </span></span>
<span id="cb15-6"><a href="lab5.html#cb15-6"></a><span class="co">// a 2x1 band called coefficients (columns are for dependent variables).</span></span>
<span id="cb15-7"><a href="lab5.html#cb15-7"></a><span class="kw">var</span> trend <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="va">independents</span>.<span class="at">add</span>(dependent))</span>
<span id="cb15-8"><a href="lab5.html#cb15-8"></a>.<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="va">independents</span>.<span class="at">length</span>()<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb15-9"><a href="lab5.html#cb15-9"></a><span class="co">// Map.addLayer(trend, {}, &#39;trend array image&#39;)</span></span>
<span id="cb15-10"><a href="lab5.html#cb15-10"></a><span class="co">// Flatten the coefficients into a 2-band image</span></span>
<span id="cb15-11"><a href="lab5.html#cb15-11"></a><span class="kw">var</span> coefficients <span class="op">=</span> <span class="va">trend</span>.<span class="at">select</span>(<span class="st">&#39;coefficients&#39;</span>)</span>
<span id="cb15-12"><a href="lab5.html#cb15-12"></a>.<span class="at">arrayProject</span>([<span class="dv">0</span>])</span>
<span id="cb15-13"><a href="lab5.html#cb15-13"></a>.<span class="at">arrayFlatten</span>([independents])<span class="op">;</span></span></code></pre></div>
<p>The coefficients’ image is a two band image in which each pixel contains values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p>Use the model to “detrend” the original NDVI time series. By detrend, we mean account for the slope of the chart.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="lab5.html#cb16-1"></a><span class="co">// Compute a de-trended series.</span></span>
<span id="cb16-2"><a href="lab5.html#cb16-2"></a><span class="kw">var</span> detrended <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb16-3"><a href="lab5.html#cb16-3"></a><span class="cf">return</span> <span class="va">image</span>.<span class="at">select</span>(dependent).<span class="at">subtract</span>(</span>
<span id="cb16-4"><a href="lab5.html#cb16-4"></a>       <span class="va">image</span>.<span class="at">select</span>(independents).<span class="at">multiply</span>(coefficients).<span class="at">reduce</span>(<span class="st">&#39;sum&#39;</span>))</span>
<span id="cb16-5"><a href="lab5.html#cb16-5"></a>       .<span class="at">rename</span>(dependent)</span>
<span id="cb16-6"><a href="lab5.html#cb16-6"></a>       .<span class="at">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb16-7"><a href="lab5.html#cb16-7"></a>       <span class="op">}</span>)<span class="op">;</span></span></code></pre></div></li>
<li><p>Plot the detrended results<br />
<code>javascript  var detrendedChart = ui.Chart.image.series(detrended, roi, null, 30)  .setOptions({    title: 'Detrended Landsat time series at ROI',    lineWidth: 1,    pointSize: 3,  });  print(detrendedChart);</code></p></li>
</ol>
</div>
<div id="estimate-seasonality-with-a-harmonic-model" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Estimate Seasonality with a Harmonic Model</h3>
<p>Consider the following linear model, where <span class="math inline">\(e_t\)</span> is random error, <span class="math inline">\(A\)</span> is amplitude, <span class="math inline">\(\omega\)</span> is frequency, and <span class="math inline">\(\phi\)</span> is phase:</p>
<p><span class="math display">\[ 
p_t = \beta_0 + \beta_1t + Acos(2\pi\omega t - \phi) + e_t 
\]</span></p>
<p>which is equivalent to</p>
<p><span class="math display">\[
p_t = \beta_0 + \beta_1t + \beta_2cos(2\pi\omega t) + \beta_3sin(2\pi\omega t) + e_t       
\]</span></p>
<p>Note that <span class="math inline">\(\beta_2 = Acos(\phi)\)</span> and <span class="math inline">\(\beta_3 = Asin(\phi)\)</span>, implying <span class="math inline">\(A = (\beta_2^2 + \beta_3^2)^½\)</span> and <span class="math inline">\(\phi = atan(\frac{\beta_3}{\beta_2})\)</span>). (See <a href="https://virginiatech.on.worldcat.org/v2/oclc/999821221">Shumway and Stoffer (2017)</a> equations 4.1 - 4.2). To fit this model to the time series, set <span class="math inline">\(\omega\)</span>=1 (one cycle per unit time) and use ordinary least squares regression.</p>
<ol style="list-style-type: decimal">
<li>The setup for fitting the model is to first add the harmonic variables (the third and fourth terms of equation 2) to the image collection.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="lab5.html#cb17-1"></a><span class="co">// Use these independent variables in the harmonic regression.</span></span>
<span id="cb17-2"><a href="lab5.html#cb17-2"></a><span class="kw">var</span> harmonicIndependents <span class="op">=</span> <span class="va">ee</span>.<span class="at">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span><span class="op">,</span> <span class="st">&#39;cos&#39;</span><span class="op">,</span> <span class="st">&#39;sin&#39;</span>])<span class="op">;</span></span>
<span id="cb17-3"><a href="lab5.html#cb17-3"></a><span class="co">// Add harmonic terms as new image bands.</span></span>
<span id="cb17-4"><a href="lab5.html#cb17-4"></a><span class="kw">var</span> harmonicLandsat <span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span></span>
<span id="cb17-5"><a href="lab5.html#cb17-5"></a><span class="kw">var</span> timeRadians <span class="op">=</span> <span class="va">image</span>.<span class="at">select</span>(<span class="st">&#39;t&#39;</span>).<span class="at">multiply</span>(<span class="dv">2</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></span>
<span id="cb17-6"><a href="lab5.html#cb17-6"></a><span class="cf">return</span> image</span>
<span id="cb17-7"><a href="lab5.html#cb17-7"></a>.<span class="at">addBands</span>(<span class="va">timeRadians</span>.<span class="at">cos</span>().<span class="at">rename</span>(<span class="st">&#39;cos&#39;</span>))</span>
<span id="cb17-8"><a href="lab5.html#cb17-8"></a>.<span class="at">addBands</span>(<span class="va">timeRadians</span>.<span class="at">sin</span>().<span class="at">rename</span>(<span class="st">&#39;sin&#39;</span>))<span class="op">;</span></span>
<span id="cb17-9"><a href="lab5.html#cb17-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Fit the model as with the linear trend, using the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="lab5.html#cb18-1"></a><span class="kw">var</span> harmonicTrend <span class="op">=</span> harmonicLandsat</span>
<span id="cb18-2"><a href="lab5.html#cb18-2"></a>.<span class="at">select</span>(<span class="va">harmonicIndependents</span>.<span class="at">add</span>(dependent))</span>
<span id="cb18-3"><a href="lab5.html#cb18-3"></a><span class="co">// The output of this reducer is a 4x1 array image.</span></span>
<span id="cb18-4"><a href="lab5.html#cb18-4"></a>.<span class="at">reduce</span>(<span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">linearRegression</span>(<span class="op">{</span></span>
<span id="cb18-5"><a href="lab5.html#cb18-5"></a><span class="dt">numX</span><span class="op">:</span> <span class="va">harmonicIndependents</span>.<span class="at">length</span>()<span class="op">,</span> </span>
<span id="cb18-6"><a href="lab5.html#cb18-6"></a><span class="dt">numY</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb18-7"><a href="lab5.html#cb18-7"></a><span class="op">}</span>))<span class="op">;</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Plug the coefficients in to equation 2 in order to get a time series of fitted values:</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="lab5.html#cb19-1"></a><span class="co">// Turn the array image into a multi-band image of coefficients.</span></span>
<span id="cb19-2"><a href="lab5.html#cb19-2"></a><span class="kw">var</span> harmonicTrendCoefficients <span class="op">=</span> <span class="va">harmonicTrend</span>.<span class="at">select</span>(<span class="st">&#39;coefficients&#39;</span>) .<span class="at">arrayProject</span>([<span class="dv">0</span>]) .<span class="at">arrayFlatten</span>([harmonicIndependents])<span class="op">;</span></span>
<span id="cb19-3"><a href="lab5.html#cb19-3"></a><span class="co">// Compute fitted values.</span></span>
<span id="cb19-4"><a href="lab5.html#cb19-4"></a><span class="kw">var</span> fittedHarmonic <span class="op">=</span> <span class="va">harmonicLandsat</span>.<span class="at">map</span>(<span class="kw">function</span>(image) <span class="op">{</span> </span>
<span id="cb19-5"><a href="lab5.html#cb19-5"></a><span class="cf">return</span> <span class="va">image</span>.<span class="at">addBands</span>(  </span>
<span id="cb19-6"><a href="lab5.html#cb19-6"></a><span class="va">image</span>.<span class="at">select</span>(harmonicIndependents)   </span>
<span id="cb19-7"><a href="lab5.html#cb19-7"></a>.<span class="at">multiply</span>(harmonicTrendCoefficients)   </span>
<span id="cb19-8"><a href="lab5.html#cb19-8"></a>.<span class="at">reduce</span>(<span class="st">&#39;sum&#39;</span>)   </span>
<span id="cb19-9"><a href="lab5.html#cb19-9"></a>.<span class="at">rename</span>(<span class="st">&#39;fitted&#39;</span>))<span class="op">;}</span>)<span class="op">;</span></span>
<span id="cb19-10"><a href="lab5.html#cb19-10"></a><span class="co">// Plot the fitted model and the original data at the ROI.</span></span>
<span id="cb19-11"><a href="lab5.html#cb19-11"></a><span class="at">print</span>(<span class="va">ui</span>.<span class="va">Chart</span>.<span class="va">image</span>.<span class="at">series</span>(<span class="va">fittedHarmonic</span>.<span class="at">select</span>([<span class="st">&#39;fitted&#39;</span><span class="op">,</span><span class="st">&#39;NDVI&#39;</span>])<span class="op">,</span> roi<span class="op">,</span></span>
<span id="cb19-12"><a href="lab5.html#cb19-12"></a>                  <span class="va">ee</span>.<span class="va">Reducer</span>.<span class="at">mean</span>()<span class="op">,</span> <span class="dv">30</span>)  </span>
<span id="cb19-13"><a href="lab5.html#cb19-13"></a>.<span class="at">setSeriesNames</span>([<span class="st">&#39;NDVI&#39;</span><span class="op">,</span> <span class="st">&#39;fitted&#39;</span>])  </span>
<span id="cb19-14"><a href="lab5.html#cb19-14"></a>.<span class="at">setOptions</span>(<span class="op">{</span>   </span>
<span id="cb19-15"><a href="lab5.html#cb19-15"></a><span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Harmonic model: original and fitted values&#39;</span><span class="op">,</span>   </span>
<span id="cb19-16"><a href="lab5.html#cb19-16"></a><span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>   </span>
<span id="cb19-17"><a href="lab5.html#cb19-17"></a><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,}</span>))<span class="op">;</span></span></code></pre></div>
<!-- You should see something like: -->
<!-- ```{r harmonicmodel, out.width='95%', fig.asp=.75, echo = FALSE, fig.align = "center"} -->
<!-- knitr::include_graphics("im_05_04.png") -->
<!-- ``` -->
<hr />
<p><i class="fa fa-file"></i> <strong>Upload the resulting graphic and interpret it. </strong></p>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>Although any coefficients can be mapped directly, it is often useful and interesting to map the phase and amplitude of the estimated harmonic model. First, compute phase and amplitude from the coefficients, then map the resulting image.</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="lab5.html#cb20-1"></a><span class="co">// Compute phase and amplitude.</span></span>
<span id="cb20-2"><a href="lab5.html#cb20-2"></a><span class="kw">var</span> phase <span class="op">=</span> <span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;sin&#39;</span>).<span class="at">atan2</span>(<span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb20-3"><a href="lab5.html#cb20-3"></a><span class="co">// Scale to [0, 1] from radians.  </span></span>
<span id="cb20-4"><a href="lab5.html#cb20-4"></a>           .<span class="at">unitScale</span>(<span class="op">-</span><span class="va">Math</span>.<span class="at">PI</span><span class="op">,</span> <span class="va">Math</span>.<span class="at">PI</span>)<span class="op">;</span></span>
<span id="cb20-5"><a href="lab5.html#cb20-5"></a><span class="kw">var</span> amplitude <span class="op">=</span> <span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;sin&#39;</span>).<span class="at">hypot</span>(<span class="va">harmonicTrendCoefficients</span>.<span class="at">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb20-6"><a href="lab5.html#cb20-6"></a><span class="co">// Add a scale factor for visualization.  </span></span>
<span id="cb20-7"><a href="lab5.html#cb20-7"></a>           .<span class="at">multiply</span>(<span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb20-8"><a href="lab5.html#cb20-8"></a><span class="co">// Compute the mean NDVI.</span></span>
<span id="cb20-9"><a href="lab5.html#cb20-9"></a><span class="kw">var</span> meanNdvi<span class="op">=</span> <span class="va">filteredLandsat</span>.<span class="at">select</span>(<span class="st">&#39;NDVI&#39;</span>).<span class="at">mean</span>()<span class="op">;</span></span>
<span id="cb20-10"><a href="lab5.html#cb20-10"></a><span class="co">// Use the HSV to RGB transformation to display phase and amplitude.</span></span>
<span id="cb20-11"><a href="lab5.html#cb20-11"></a><span class="kw">var</span> rgb <span class="op">=</span> <span class="va">ee</span>.<span class="va">Image</span>.<span class="at">cat</span>([ phase<span class="op">,</span>   </span>
<span id="cb20-12"><a href="lab5.html#cb20-12"></a>               amplitude<span class="op">,</span> </span>
<span id="cb20-13"><a href="lab5.html#cb20-13"></a>               meanNdvi]).<span class="at">hsvToRgb</span>()</span>
<span id="cb20-14"><a href="lab5.html#cb20-14"></a><span class="va">Map</span>.<span class="at">addLayer</span>(rgb<span class="op">,</span> <span class="op">{},</span> <span class="st">&#39;phase (hue), amplitude (sat), ndvi (val)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<hr />
<p><i class="fa fa-file"></i> <strong>Upload the resulting map layer and describe its salient features.</strong></p>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>A time series can be decomposed as the sum of sinusoids at different frequencies (See <a href="https://virginiatech.on.worldcat.org/v2/oclc/999821221">Shumway and Stoffer (2017)</a>, equation 4.7). The harmonic model presented here can be easily extended in this manner by adding bands that represent higher frequencies (e.g. <code>timeRadians.multiply(2).cos().rename('cos2')</code> and the corresponding <code>sin()</code> band for a harmonic component with two cycles per year) and amending the <code>harmonicIndependents</code> variable accordingly.</li>
</ol>
<p>If you’re feeling plucky, check out <a href="https://code.earthengine.google.com/2669122497313113fc4bb81bc8352828">this implementation</a> of that idea for an arbitrary number of harmonic terms. While this will undoubtedly improve the goodness-of-fit of the model, many of the coefficients may be close to zero. To estimate the importance of terms representing seasonality or higher-frequency harmonic behavior (e.g. double-cropping), an F-statistic can be used when the model assumptions are satisfied. See, for example, <a href="https://virginiatech.on.worldcat.org/v2/oclc/999821221">Shumway and Stoffer (2017)</a>, equation 2.11.</p>
</div>
</div>
<div id="additional-exercises-4" class="section level2">
<h2><span class="header-section-number">5.4</span> Additional Exercises</h2>
<p><i class="fa fa-file"></i> <strong>Look in google scholar to identify 2-3 publications that have used a harmonic regression in a time series analysis of remotely sensed data in particular. Provide citations for the articles, and then describe for what purposes was the technique used and what was the justification provided for its use.</strong></p>
</div>
<div id="where-to-submit-4" class="section level2 unnumbered">
<h2>Where to submit</h2>
<p>Submit your responses to these questions on <a href="https://www.gradescope.com/courses/293173/assignments/1446622/submissions">Gradescope</a> by 10am on Wednesday, October 06. If needed, the access code for our course is <code>6PEW3W</code>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab4.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["labs-rsss.pdf"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
