<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Lab 05 - Time Series Modeling | Remote Sensing in the Social Sciences</title>
  <meta name="description" content="5 Lab 05 - Time Series Modeling | Remote Sensing in the Social Sciences" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Lab 05 - Time Series Modeling | Remote Sensing in the Social Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Lab 05 - Time Series Modeling | Remote Sensing in the Social Sciences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lab4.html"/>
<link rel="next" href="lab6.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#why-google-earth-engine"><i class="fa fa-check"></i><b>0.1</b> Why Google Earth Engine?</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#license-and-attribution"><i class="fa fa-check"></i><b>0.2</b> License and Attribution</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html"><i class="fa fa-check"></i>Lab 00 - PreLab: Getting Started</a>
<ul>
<li class="chapter" data-level="0.3" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#overview"><i class="fa fa-check"></i><b>0.3</b> Overview</a></li>
<li class="chapter" data-level="0.4" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#data-and-methods"><i class="fa fa-check"></i><b>0.4</b> Data and Methods</a></li>
<li class="chapter" data-level="0.5" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#images-and-image-collections"><i class="fa fa-check"></i><b>0.5</b> Images and Image Collections</a>
<ul>
<li class="chapter" data-level="0.5.1" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#images"><i class="fa fa-check"></i><b>0.5.1</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="0.6" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#image-collections"><i class="fa fa-check"></i><b>0.6</b> Image Collections</a>
<ul>
<li class="chapter" data-level="0.6.1" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#sensed-versus-derived-imagery"><i class="fa fa-check"></i><b>0.6.1</b> Sensed versus Derived Imagery</a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#geometries"><i class="fa fa-check"></i><b>0.7</b> Geometries</a></li>
<li class="chapter" data-level="0.8" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#features-and-feature-collections"><i class="fa fa-check"></i><b>0.8</b> Features and Feature Collections</a>
<ul>
<li class="chapter" data-level="0.8.1" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#features"><i class="fa fa-check"></i><b>0.8.1</b> Features</a></li>
<li class="chapter" data-level="0.8.2" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#feature-collections"><i class="fa fa-check"></i><b>0.8.2</b> Feature Collections</a></li>
</ul></li>
<li class="chapter" data-level="0.9" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#methods-reducers"><i class="fa fa-check"></i><b>0.9</b> Methods: Reducers</a></li>
<li class="chapter" data-level="0.10" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#joins-and-arrays"><i class="fa fa-check"></i><b>0.10</b> Joins and Arrays</a>
<ul>
<li class="chapter" data-level="0.10.1" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#join"><i class="fa fa-check"></i><b>0.10.1</b> Join</a></li>
<li class="chapter" data-level="0.10.2" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#arrays"><i class="fa fa-check"></i><b>0.10.2</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="0.11" data-path="lab-00-prelab-getting-started.html"><a href="lab-00-prelab-getting-started.html#additional-resources"><i class="fa fa-check"></i><b>0.11</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="lab1.html"><a href="lab1.html"><i class="fa fa-check"></i><b>1</b> Lab 01 - Remote Sensing Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="lab1.html"><a href="lab1.html#overview-1"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="lab1.html"><a href="lab1.html#digital-image"><i class="fa fa-check"></i><b>1.2</b> Digital Image</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="lab1.html"><a href="lab1.html#from-digital-image-to-geospatial-image"><i class="fa fa-check"></i><b>1.2.1</b> From Digital Image to Geospatial Image</a></li>
<li class="chapter" data-level="1.2.2" data-path="lab1.html"><a href="lab1.html#visualize-a-digital-image"><i class="fa fa-check"></i><b>1.2.2</b> Visualize a Digital Image</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="lab1.html"><a href="lab1.html#spatial-resolution"><i class="fa fa-check"></i><b>1.3</b> Spatial Resolution</a></li>
<li class="chapter" data-level="1.4" data-path="lab1.html"><a href="lab1.html#spectral-resolution"><i class="fa fa-check"></i><b>1.4</b> Spectral Resolution</a></li>
<li class="chapter" data-level="1.5" data-path="lab1.html"><a href="lab1.html#temporal-resolution"><i class="fa fa-check"></i><b>1.5</b> Temporal Resolution</a></li>
<li class="chapter" data-level="1.6" data-path="lab1.html"><a href="lab1.html#radiometric-resolution"><i class="fa fa-check"></i><b>1.6</b> Radiometric Resolution</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="lab1.html"><a href="lab1.html#digital-image-visualization-and-stretching"><i class="fa fa-check"></i><b>1.6.1</b> Digital Image Visualization and Stretching</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="lab1.html"><a href="lab1.html#resampling-and-reprojection"><i class="fa fa-check"></i><b>1.7</b> Resampling and ReProjection</a></li>
<li class="chapter" data-level="1.8" data-path="lab1.html"><a href="lab1.html#additional-exercises"><i class="fa fa-check"></i><b>1.8</b> Additional Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab2.html"><a href="lab2.html"><i class="fa fa-check"></i><b>2</b> Lab 02 - Digital Imagery &amp; Image Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lab2.html"><a href="lab2.html#overview-2"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="lab2.html"><a href="lab2.html#searching-for-imagery"><i class="fa fa-check"></i><b>2.2</b> Searching for Imagery</a></li>
<li class="chapter" data-level="2.3" data-path="lab2.html"><a href="lab2.html#visualizing-landsat-imagery"><i class="fa fa-check"></i><b>2.3</b> Visualizing Landsat Imagery</a></li>
<li class="chapter" data-level="2.4" data-path="lab2.html"><a href="lab2.html#at-sensor-radiance"><i class="fa fa-check"></i><b>2.4</b> At-Sensor Radiance</a></li>
<li class="chapter" data-level="2.5" data-path="lab2.html"><a href="lab2.html#top-of-atmosphere-toa-reflectance"><i class="fa fa-check"></i><b>2.5</b> Top-of-Atmosphere (TOA) Reflectance</a></li>
<li class="chapter" data-level="2.6" data-path="lab2.html"><a href="lab2.html#surface-reflectance"><i class="fa fa-check"></i><b>2.6</b> Surface Reflectance</a></li>
<li class="chapter" data-level="2.7" data-path="lab2.html"><a href="lab2.html#additional-exercises-1"><i class="fa fa-check"></i><b>2.7</b> Additional Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab3.html"><a href="lab3.html"><i class="fa fa-check"></i><b>3</b> Lab 03 - Spectral Indices &amp; Transformations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lab3.html"><a href="lab3.html#overview-3"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="lab3.html"><a href="lab3.html#spectral-indices"><i class="fa fa-check"></i><b>3.2</b> Spectral Indices</a></li>
<li class="chapter" data-level="3.3" data-path="lab3.html"><a href="lab3.html#important-indices"><i class="fa fa-check"></i><b>3.3</b> Important Indices</a></li>
<li class="chapter" data-level="3.4" data-path="lab3.html"><a href="lab3.html#transformations"><i class="fa fa-check"></i><b>3.4</b> Transformations</a></li>
<li class="chapter" data-level="3.5" data-path="lab3.html"><a href="lab3.html#spectral-transformation"><i class="fa fa-check"></i><b>3.5</b> Spectral Transformation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="lab3.html"><a href="lab3.html#linear-filtering"><i class="fa fa-check"></i><b>3.5.1</b> Linear Filtering</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="lab3.html"><a href="lab3.html#additional-exercises-2"><i class="fa fa-check"></i><b>3.6</b> Additional Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab4.html"><a href="lab4.html"><i class="fa fa-check"></i><b>4</b> Lab 04 - Classification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lab4.html"><a href="lab4.html#overview-4"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="lab4.html"><a href="lab4.html#introduction-to-classification"><i class="fa fa-check"></i><b>4.2</b> Introduction to Classification</a></li>
<li class="chapter" data-level="4.3" data-path="lab4.html"><a href="lab4.html#unsupervised-classification"><i class="fa fa-check"></i><b>4.3</b> Unsupervised Classification</a></li>
<li class="chapter" data-level="4.4" data-path="lab4.html"><a href="lab4.html#supervised-classification"><i class="fa fa-check"></i><b>4.4</b> Supervised Classification</a></li>
<li class="chapter" data-level="4.5" data-path="lab4.html"><a href="lab4.html#accuracy-assessment"><i class="fa fa-check"></i><b>4.5</b> Accuracy Assessment</a></li>
<li class="chapter" data-level="4.6" data-path="lab4.html"><a href="lab4.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>4.6</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="4.7" data-path="lab4.html"><a href="lab4.html#classification-assignment"><i class="fa fa-check"></i><b>4.7</b> Classification Assignment</a></li>
<li class="chapter" data-level="4.8" data-path="lab4.html"><a href="lab4.html#regression"><i class="fa fa-check"></i><b>4.8</b> Regression</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="lab4.html"><a href="lab4.html#ordinary-least-squares-ols"><i class="fa fa-check"></i><b>4.8.1</b> Ordinary Least Squares (OLS)</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="lab4.html"><a href="lab4.html#nonlinear-regression"><i class="fa fa-check"></i><b>4.9</b> Nonlinear Regression</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab5.html"><a href="lab5.html"><i class="fa fa-check"></i><b>5</b> Lab 05 - Time Series Modeling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="lab5.html"><a href="lab5.html#overview-5"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="lab5.html"><a href="lab5.html#background"><i class="fa fa-check"></i><b>5.2</b> Background</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="lab5.html"><a href="lab5.html#limitations-in-remote-sensing-time-series"><i class="fa fa-check"></i><b>5.2.1</b> Limitations in Remote Sensing Time Series</a></li>
<li class="chapter" data-level="5.2.2" data-path="lab5.html"><a href="lab5.html#multi-temporal-data-in-earth-engine"><i class="fa fa-check"></i><b>5.2.2</b> Multi-Temporal Data in Earth Engine</a></li>
<li class="chapter" data-level="5.2.3" data-path="lab5.html"><a href="lab5.html#data-preparation-and-preprocessing"><i class="fa fa-check"></i><b>5.2.3</b> Data Preparation and Preprocessing</a></li>
<li class="chapter" data-level="5.2.4" data-path="lab5.html"><a href="lab5.html#linear-modeling-of-time"><i class="fa fa-check"></i><b>5.2.4</b> Linear Modeling of Time</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="lab5.html"><a href="lab5.html#estimate-seasonality-with-a-harmonic-model"><i class="fa fa-check"></i><b>5.3</b> Estimate Seasonality with a Harmonic Model</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="lab5.html"><a href="lab5.html#complex-time-series-modeling"><i class="fa fa-check"></i><b>5.3.1</b> Complex Time Series Modeling</a></li>
<li class="chapter" data-level="5.3.2" data-path="lab5.html"><a href="lab5.html#exporting-data"><i class="fa fa-check"></i><b>5.3.2</b> Exporting Data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="lab5.html"><a href="lab5.html#time-series-thresholding"><i class="fa fa-check"></i><b>5.4</b> Time Series Thresholding</a></li>
<li class="chapter" data-level="5.5" data-path="lab5.html"><a href="lab5.html#additional-exercises-3"><i class="fa fa-check"></i><b>5.5</b> Additional Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lab6.html"><a href="lab6.html"><i class="fa fa-check"></i><b>6</b> Night Time Lights Appendix</a>
<ul>
<li class="chapter" data-level="" data-path="lab6.html"><a href="lab6.html#overview-6"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="6.1" data-path="lab6.html"><a href="lab6.html#basic-operations"><i class="fa fa-check"></i><b>6.1</b> Basic Operations</a></li>
<li class="chapter" data-level="6.2" data-path="lab6.html"><a href="lab6.html#conclusion"><i class="fa fa-check"></i><b>6.2</b> Conclusion</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/benamie/remote-sense-social/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Remote Sensing in the Social Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab5" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Lab 05 - Time Series Modeling</h1>
<div id="overview-5" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Overview</h2>
<p>The purpose of this lab is to establish a foundation for time series analysis on remotely sensed data. You will be introduced to the fundamentals of time series modeling, including decomposition, autocorrelation and modeling historical changes. At the completion of this lab, you will be able to build an explanatory model for temporal data which can be used in many different avenues of research.</p>
</div>
<div id="background" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Background</h2>
<p>One of the paradigm-changing features of Earth Engine is the ability to access decades of imagery without the previous limitation of needing to download, organize, store and process this information. For instance, within the Landsat image collection we can access imagery back to 1972, allowing us to look at an area to visualize and quantify how much it’s changed over time. With Earth Engine, Google maintains the data and offers it’s compute power for processing - users can access tens or hundreds of time-sequenced images and quantify change across decades.</p>
<p>To explain the concepts of time series modeling, let’s begin with a dataset that illustrates what we are trying to do. The line chart below references electricity production over thirty years, with one distinct data point per month. What can we observe?</p>
<ol style="list-style-type: decimal">
<li><p>Production tends to increase each year - In this case, it appears to level out after 2010, but there is a general trend upwards.</p></li>
<li><p>Within each yearly cycle, we see that there is a sharp peak in June and July, and a trough in October and December. An annual, 12-month cycle is specifically referred to as ‘seasonality’, although there can be other cyclical time periods (ex., a housing market in a specific area may see a recurring pattern in house prices that occurs roughtly every 7 years)</p></li>
<li><p>Finally, the magnitude of the difference between each yearly peak and trough increases over time as well.</p></li>
</ol>
<div class="figure">
<img src="im/im_05_01.png" alt="" />
<p class="caption">Time Series Example</p>
</div>
<p>With these observations, we can address each of the components individually and perhaps build an explanatory model. The time series decomposition below (generated in R) breaks up the data into separate components.</p>
<ol style="list-style-type: decimal">
<li>The ‘observed’ line chart is the data in original form.</li>
<li>The next chart is a trendline built using a window function (each data point is plotted as the average of the previous 12 data points). You can see the general trend of the data and determine whether a linear fit is appropriate.</li>
<li>The seasonal chart seeks to identify cyclical patterns in the data - in this case, patterns that repeat every 12 months. It subtracts the trend from the observed points and averages the data for each time period (month).<br />
</li>
<li>Finally, the ‘random’ line chart is the residual amount remaining when you remove the trend and seasonality from the data.</li>
</ol>
<div class="figure">
<img src="im/im_05_02.png" alt="" />
<p class="caption">Time Series Decomposition</p>
</div>
<div id="limitations-in-remote-sensing-time-series" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Limitations in Remote Sensing Time Series</h3>
<p>Time Series modeling aims to build an an explanatory model of the data without overfitting the problem set - to use as simple a model as possible while accounting for as much of the data as possible. The previous example was used to illustrate the concepts of breaking down time series data into component parts, but remote sensing data has additional limitations that make this more challenging. Note that in the previous example used there was a well-formed data point for every single month - nothing was missing or obviously erroneous. It is almost inevitable that you will not get this same level of precision from remote sensing data. For instance, Landsat has 16-day temporal resolution - but depending on the area, removing cloudy pixels will remove a significant portion. For instance, in a test area in the Galapagos Islands, over 85% of the data was removed due to cloud masking or atmospheric conditions. Issues such as the Landsat 7 Scan Line Corrector malfunction might prevent a cohesive time series dataset depending on your time period of research. Also, while the time series example we used involved measured values on the same scale throughout the time series (ie, a gigawatt is the same unit of measurement throughout the entire time series), with remote sensing we often run into situations where the magnitude of measurement changes. If we are researching winter crop yield and an image is collected right after a heavy snowfall, how do we compare this value? Do we keep this data or remove it? Additionally, atmospheric conditions can skew the visual results, where the hue of the vegetation changes drastically from image to image due to atmospheric conditions (fog, ground moisture, cloud cover).</p>
<p>For your project, you have to understand the characteristics of both your data and what you are trying to measure. Building a time series model to understand cyclical changes in vegetation can provide useful information in understanding crop yield - but if you do not account for issues in the data, you can end up building a faulty time series model that leads to erroneous results. Many time series modeling tools, such as ARIMA modeling, are not directly applicable in certain settings due to missing data, non-standard collection periods and varying intensity of due to atmospheric conditions. In this lab, we will focus on understanding on linear trends and harmonic modeling.</p>
</div>
<div id="multi-temporal-data-in-earth-engine" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Multi-Temporal Data in Earth Engine</h3>
<p>Time series data in Earth Engine are represented as a series of images called ‘Image Collections’. As a result of the complicating factors in remote sensing discussed earlier, analyzing time series in Earth Engine is unlike time series modeling in traditional methods. From a programming sense, we will join data together to define temporal relationships between collection items and build functions to reduce this tim.</p>
<p>First, some very basic mathematical notation for time series. A time series is an array of the value being measured, sorted chronologically: { <span class="math inline">\(\textbf{p}_{t} = t_{0} + t_{1}... t_{N}\)</span> }, where each <em>t</em> is the given value in the series.</p>
</div>
<div id="data-preparation-and-preprocessing" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Data Preparation and Preprocessing</h3>
<p>The first step in analysis of time series data is to import data of interest and plot the data at an interesting location. In this case, the region of interest is in a deciduous forest near Blacksburg, VA.</p>
<p>We begin by loading in the Landsat 8 Collection and provide a point at the region of interest. Additionally, we will create a time field.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="lab5.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat_8_sr <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;LANDSAT/LC08/C01/T1_SR&quot;</span>)</span>
<span id="cb1-2"><a href="lab5.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="op">-</span><span class="fl">80.49882800809357</span><span class="op">,</span> <span class="fl">37.2544486695189</span>])<span class="op">;</span></span>
<span id="cb1-3"><a href="lab5.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// This field contains UNIX time in milliseconds.</span></span>
<span id="cb1-4"><a href="lab5.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timeField <span class="op">=</span> <span class="st">&#39;system:time_start&#39;</span><span class="op">;</span></span></code></pre></div>
<p>The function <code>maskL8sr</code> is a cloud masking function that uses the Quality Assurance attribute of Landsat 8 to mask out any pixels that that are obscured by cloud. Note that this function is Landsat 8 specific, using other platforms will require a different setup.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="lab5.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to cloud mask from the pixel_qa band of Landsat 8 SR data.</span></span>
<span id="cb2-2"><a href="lab5.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskL8sr</span>(image) {</span>
<span id="cb2-3"><a href="lab5.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 3 and 5 are cloud shadow and cloud, respectively.</span></span>
<span id="cb2-4"><a href="lab5.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb2-5"><a href="lab5.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudsBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb2-6"><a href="lab5.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get the pixel QA band.</span></span>
<span id="cb2-7"><a href="lab5.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb2-8"><a href="lab5.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb2-9"><a href="lab5.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudShadowBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)</span>
<span id="cb2-10"><a href="lab5.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudsBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb2-11"><a href="lab5.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the masked image, scaled to reflectance, without the QA bands.</span></span>
<span id="cb2-12"><a href="lab5.html#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb2-13"><a href="lab5.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B[0-9]*&#39;</span>)</span>
<span id="cb2-14"><a href="lab5.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb2-15"><a href="lab5.html#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can use one of the indices that we built in an earlier lab to measure vegetation health. Normalized Difference Vegetation Index (NDVI) is a well-known metric for quantifying vegetation health - for this region of interest, we expect there to be a strong seasonality, and perhaps a gradual linear trend over time. In the code block below, we create a function called <code>addVariables</code> that extracts the date of each image, calculates NDVI and adds it to an array. We can then use <code>.map()</code> to apply the two functions we built to build a time series model of our data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="lab5.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use this function to add variables for NDVI, time and a constant</span></span>
<span id="cb3-2"><a href="lab5.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// to Landsat 8 imagery.</span></span>
<span id="cb3-3"><a href="lab5.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addVariables <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb3-4"><a href="lab5.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute time in fractional years since the epoch.</span></span>
<span id="cb3-5"><a href="lab5.html#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> date <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(image<span class="op">.</span><span class="fu">get</span>(timeField))<span class="op">;</span></span>
<span id="cb3-6"><a href="lab5.html#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> years <span class="op">=</span> date<span class="op">.</span><span class="fu">difference</span>(ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;1970-01-01&#39;</span>)<span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">;</span></span>
<span id="cb3-7"><a href="lab5.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the image with the added bands.</span></span>
<span id="cb3-8"><a href="lab5.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image</span>
<span id="cb3-9"><a href="lab5.html#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add an NDVI band.</span></span>
<span id="cb3-10"><a href="lab5.html#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">addBands</span>(image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;NDVI&#39;</span>))</span>
<span id="cb3-11"><a href="lab5.html#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add a time band.</span></span>
<span id="cb3-12"><a href="lab5.html#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">addBands</span>(ee<span class="op">.</span><span class="fu">Image</span>(years)<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;t&#39;</span>))</span>
<span id="cb3-13"><a href="lab5.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">float</span>()</span>
<span id="cb3-14"><a href="lab5.html#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add a constant band.</span></span>
<span id="cb3-15"><a href="lab5.html#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">addBands</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(<span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb3-16"><a href="lab5.html#cb3-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-17"><a href="lab5.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove clouds, add variables and filter to the area of interest.</span></span>
<span id="cb3-18"><a href="lab5.html#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredLandsat <span class="op">=</span> landsat_8_sr</span>
<span id="cb3-19"><a href="lab5.html#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb3-20"><a href="lab5.html#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">map</span>(maskL8sr)</span>
<span id="cb3-21"><a href="lab5.html#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">map</span>(addVariables)<span class="op">;</span></span></code></pre></div>
<p>To visualize the data, we will export a chart at the location of interest. We will add a linear trend line for reference.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="lab5.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot a time series of NDVI at a single location.</span></span>
<span id="cb4-2"><a href="lab5.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l8Chart <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">series</span>(filteredLandsat<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">,</span> roi)</span>
<span id="cb4-3"><a href="lab5.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;ScatterChart&#39;</span>)</span>
<span id="cb4-4"><a href="lab5.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb4-5"><a href="lab5.html#cb4-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Landsat 8 NDVI Time Series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb4-6"><a href="lab5.html#cb4-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">trendlines</span><span class="op">:</span> {<span class="dv">0</span><span class="op">:</span> {</span>
<span id="cb4-7"><a href="lab5.html#cb4-7" aria-hidden="true" tabindex="-1"></a>                <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span></span>
<span id="cb4-8"><a href="lab5.html#cb4-8" aria-hidden="true" tabindex="-1"></a>   }}<span class="op">,</span></span>
<span id="cb4-9"><a href="lab5.html#cb4-9" aria-hidden="true" tabindex="-1"></a>   <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb4-10"><a href="lab5.html#cb4-10" aria-hidden="true" tabindex="-1"></a>   <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb4-11"><a href="lab5.html#cb4-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb4-12"><a href="lab5.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(l8Chart)<span class="op">;</span></span></code></pre></div>
<p>You can click on the ‘export’ button next to the chart to view an iteractive chart. Scroll over some of the data points and look at the relationships between the data. A line connecting two dots means that they are sequential data points, and note that there are relatively few of them. We can see that there are relatively large jumps in the data, with an upward climb somewhere between March and late April, and a descent in late August. Each year is slightly different, but we can surmise that this is due to seasonal rains in the spring and leaves dying off in the fall. Finally, the general trend is downward, although the February 2021 datapoint might have significant leverage on the trend.</p>
<div class="figure">
<img src="im/im_05_03.png" alt="" />
<p class="caption">Linear Trend</p>
</div>
</div>
<div id="linear-modeling-of-time" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Linear Modeling of Time</h3>
<p>Lots of interesting analyses can be done to time series by harnessing the <code>linearRegression()</code> <a href="https://developers.google.com/earth-engine/api_docs#eereducerlinearregression">reducer</a>. To estimate linear trends over time, consider the following linear model, where <span class="math inline">\(\epsilon_t\)</span> is a random error:</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1X_1 + ... + \beta_nX_n + \epsilon_t \]</span></p>
<p>This is the model behind the trendline added to the chart you just created. We can use this model to detrend our data (explain the upward or downward movement of the data by subtracting observed values from the fitted model values). For now, the goal is to discover the values of the beta coefficients.</p>
<p>To fit this trend model to the Landsat-based NDVI series using Ordinary Least Squares (<a href="https://statisticsbyjim.com/glossary/ordinary-least-squares/">OLS</a>), use the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="lab5.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// List of the independent variable names</span></span>
<span id="cb5-2"><a href="lab5.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> independents <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span>])<span class="op">;</span></span>
<span id="cb5-3"><a href="lab5.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Name of the dependent variable.</span></span>
<span id="cb5-4"><a href="lab5.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dependent <span class="op">=</span> ee<span class="op">.</span><span class="fu">String</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb5-5"><a href="lab5.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute a linear trend. This will have two bands: &#39;residuals&#39; and </span></span>
<span id="cb5-6"><a href="lab5.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// a 2x1 band called coefficients (columns are for dependent variables).</span></span>
<span id="cb5-7"><a href="lab5.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> trend <span class="op">=</span> filteredLandsat<span class="op">.</span><span class="fu">select</span>(independents<span class="op">.</span><span class="fu">add</span>(dependent))</span>
<span id="cb5-8"><a href="lab5.html#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">linearRegression</span>(independents<span class="op">.</span><span class="fu">length</span>()<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb5-9"><a href="lab5.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(trend<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;Trend Array Image&#39;</span>)</span>
<span id="cb5-10"><a href="lab5.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Flatten the coefficients into a 2-band image</span></span>
<span id="cb5-11"><a href="lab5.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> coefficients <span class="op">=</span> trend<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;coefficients&#39;</span>)</span>
<span id="cb5-12"><a href="lab5.html#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">arrayProject</span>([<span class="dv">0</span>])</span>
<span id="cb5-13"><a href="lab5.html#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">arrayFlatten</span>([independents])<span class="op">;</span></span></code></pre></div>
<p>The image added to the map is a two band image in which each pixel contains values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. Click around the map with inspector, and look at some of the values. We can see that most pixels around our region of interest have a negative trend - although darker values indicate a shallow negative trend, while bright red pixels indicate a steeper descent.</p>
<p>Use the model to “detrend” the original NDVI time series. By detrend, we mean account for the slope of the chart and remove it from the original data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="lab5.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute a de-trended series.</span></span>
<span id="cb6-2"><a href="lab5.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> detrended <span class="op">=</span> filteredLandsat<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(image) {</span>
<span id="cb6-3"><a href="lab5.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> image<span class="op">.</span><span class="fu">select</span>(dependent)<span class="op">.</span><span class="fu">subtract</span>(</span>
<span id="cb6-4"><a href="lab5.html#cb6-4" aria-hidden="true" tabindex="-1"></a>       image<span class="op">.</span><span class="fu">select</span>(independents)<span class="op">.</span><span class="fu">multiply</span>(coefficients)<span class="op">.</span><span class="fu">reduce</span>(<span class="st">&#39;sum&#39;</span>))</span>
<span id="cb6-5"><a href="lab5.html#cb6-5" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">rename</span>(dependent)</span>
<span id="cb6-6"><a href="lab5.html#cb6-6" aria-hidden="true" tabindex="-1"></a>       <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb6-7"><a href="lab5.html#cb6-7" aria-hidden="true" tabindex="-1"></a>       })<span class="op">;</span></span></code></pre></div>
<p>Plot the detrended results</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="lab5.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> detrendedChart <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">series</span>(detrended<span class="op">,</span> roi<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb7-2"><a href="lab5.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb7-3"><a href="lab5.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Detrended Landsat Time Series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb7-4"><a href="lab5.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-5"><a href="lab5.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb7-6"><a href="lab5.html#cb7-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-7"><a href="lab5.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(detrendedChart)<span class="op">;</span></span></code></pre></div>
<p>Compared to our earlier graph, the data looks similar - but now, the slight downward slope is accounted for with our linear model. Each fitted data point (data point on the linear model) is subtracted from each of the observed data points. Additionally, the Y-axis is now centered at 0, and the scale ranges from 0 to +/- 0.45 This allows us to focus on cyclical patterns in the data with long-term trends in the data removed.</p>
<div class="figure">
<img src="im/im_05_04.png" alt="" />
<p class="caption">Detrended Data</p>
</div>
</div>
</div>
<div id="estimate-seasonality-with-a-harmonic-model" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Estimate Seasonality with a Harmonic Model</h2>
<p>Consider the following linear model, where <span class="math inline">\(e_t\)</span> is random error, <span class="math inline">\(A\)</span> is amplitude, <span class="math inline">\(\omega\)</span> is frequency, and <span class="math inline">\(\phi\)</span> is phase:</p>
<p><span class="math display">\[
p_t = \beta_0 + \beta_1t + Acos(2\pi\omega t - \phi) + e_t
\]</span></p>
<p>We can decompose our function into separate cosine and sine elements.</p>
<p><span class="math display">\[
p_t = \beta_0 + \beta_1t + \beta_2cos(2\pi\omega t) + \beta_3sin(2\pi\omega t) + e_t
\]</span></p>
<p>Note that <span class="math inline">\(\beta_2 = Acos(\phi)\)</span> and <span class="math inline">\(\beta_3 = Asin(\phi)\)</span>, implying <span class="math inline">\(A = (\beta_2^2 + \beta_3^2)^½\)</span> and <span class="math inline">\(\phi = atan(\frac{\beta_3}{\beta_2})\)</span>).</p>
<p>If the math here does not make sense, basically we are breaking up more complex curves into a set of simplified cosine waves and an additive term. Mark Jakubauskas has an informative paper that breaks down the process in this <a href="https://www.isprs.org/proceedings/xxxiii/congress/part4/384_xxxiii-part4.pdf">paper</a>, and there are many papers which elaborate more on the math behind harmonic models. Building a harmonic model is used in remote sensing applications because of its flexibility in accounting for cyclicality with simple, reproducible shapes. If there is a seasonal trend in the data, the ordered nature of a cosine curve can likely approximate it.</p>
<p>To fit this model to the time series, set <span class="math inline">\(\omega\)</span>=1 (one cycle per unit time) and use ordinary least squares regression as the metric of error reduction.</p>
<p>First, add the harmonic variables (the third and fourth terms of equation 2) to the image collection.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="lab5.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use these independent variables in the harmonic regression.</span></span>
<span id="cb8-2"><a href="lab5.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> harmonicIndependents <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>([<span class="st">&#39;constant&#39;</span><span class="op">,</span> <span class="st">&#39;t&#39;</span><span class="op">,</span> <span class="st">&#39;cos&#39;</span><span class="op">,</span> <span class="st">&#39;sin&#39;</span>])<span class="op">;</span></span>
<span id="cb8-3"><a href="lab5.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Add harmonic terms as new image bands.</span></span>
<span id="cb8-4"><a href="lab5.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> harmonicLandsat <span class="op">=</span> filteredLandsat<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(image) {</span>
<span id="cb8-5"><a href="lab5.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> timeRadians <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;t&#39;</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">;</span></span>
<span id="cb8-6"><a href="lab5.html#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image</span>
<span id="cb8-7"><a href="lab5.html#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">addBands</span>(timeRadians<span class="op">.</span><span class="fu">cos</span>()<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;cos&#39;</span>))</span>
<span id="cb8-8"><a href="lab5.html#cb8-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">addBands</span>(timeRadians<span class="op">.</span><span class="fu">sin</span>()<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;sin&#39;</span>))<span class="op">;</span></span>
<span id="cb8-9"><a href="lab5.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>Fit the model with a linear trend, using the <code>linearRegression()</code> reducer:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="lab5.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> harmonicTrend <span class="op">=</span> harmonicLandsat</span>
<span id="cb9-2"><a href="lab5.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(harmonicIndependents<span class="op">.</span><span class="fu">add</span>(dependent))</span>
<span id="cb9-3"><a href="lab5.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The output of this reducer is a 4x1 array image.</span></span>
<span id="cb9-4"><a href="lab5.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">linearRegression</span>({</span>
<span id="cb9-5"><a href="lab5.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">numX</span><span class="op">:</span> harmonicIndependents<span class="op">.</span><span class="fu">length</span>()<span class="op">,</span> </span>
<span id="cb9-6"><a href="lab5.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">numY</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb9-7"><a href="lab5.html#cb9-7" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span></code></pre></div>
<p>Plug the coefficients in to equation 2 in order to get a time series of fitted values:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="lab5.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Turn the array image into a multi-band image of coefficients.</span></span>
<span id="cb10-2"><a href="lab5.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> harmonicTrendCoefficients <span class="op">=</span> harmonicTrend<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;coefficients&#39;</span>) </span>
<span id="cb10-3"><a href="lab5.html#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">arrayProject</span>([<span class="dv">0</span>])              </span>
<span id="cb10-4"><a href="lab5.html#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">arrayFlatten</span>([harmonicIndependents])<span class="op">;</span></span>
<span id="cb10-5"><a href="lab5.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute fitted values.</span></span>
<span id="cb10-6"><a href="lab5.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fittedHarmonic <span class="op">=</span> harmonicLandsat<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(image) { </span>
<span id="cb10-7"><a href="lab5.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(  </span>
<span id="cb10-8"><a href="lab5.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  image<span class="op">.</span><span class="fu">select</span>(harmonicIndependents)   </span>
<span id="cb10-9"><a href="lab5.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(harmonicTrendCoefficients)   </span>
<span id="cb10-10"><a href="lab5.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">reduce</span>(<span class="st">&#39;sum&#39;</span>)   </span>
<span id="cb10-11"><a href="lab5.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;fitted&#39;</span>))<span class="op">;</span></span>
<span id="cb10-12"><a href="lab5.html#cb10-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb10-13"><a href="lab5.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot the fitted model and the original data at the ROI.</span></span>
<span id="cb10-14"><a href="lab5.html#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">series</span>(fittedHarmonic<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;fitted&#39;</span><span class="op">,</span><span class="st">&#39;NDVI&#39;</span>])<span class="op">,</span> roi<span class="op">,</span></span>
<span id="cb10-15"><a href="lab5.html#cb10-15" aria-hidden="true" tabindex="-1"></a>                  ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span> <span class="dv">30</span>)  </span>
<span id="cb10-16"><a href="lab5.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setSeriesNames</span>([<span class="st">&#39;NDVI&#39;</span><span class="op">,</span> <span class="st">&#39;fitted&#39;</span>])  </span>
<span id="cb10-17"><a href="lab5.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setOptions</span>({   </span>
<span id="cb10-18"><a href="lab5.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Harmonic Model: Original and Fitted Values&#39;</span><span class="op">,</span>   </span>
<span id="cb10-19"><a href="lab5.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>   </span>
<span id="cb10-20"><a href="lab5.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span>}))<span class="op">;</span></span></code></pre></div>
<p>The harmonic model (red data points) does an adequate job of predicting the data - There is a datapoint in Feb 2021 that is significantly lower, but this appears to be an outlier. Additionally, the model misses a significant dip in July 2015, although this might be due to irregular climate conditions - other years did not have the same dip.</p>
<blockquote>
<p><strong>Question 1</strong>: Upload the resulting graphic and interpret it.</p>
</blockquote>
<p>Although any coefficients can be mapped directly, it is often useful and interesting to map the phase and amplitude of the estimated harmonic model. First, compute phase and amplitude from the coefficients, then incorporate this information into each pixel. Use inspector to look at the pixels and note their phase and amplitude.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="lab5.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute phase and amplitude.</span></span>
<span id="cb11-2"><a href="lab5.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> phase <span class="op">=</span> harmonicTrendCoefficients<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sin&#39;</span>)</span>
<span id="cb11-3"><a href="lab5.html#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">atan2</span>(harmonicTrendCoefficients<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb11-4"><a href="lab5.html#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale to [0, 1] from radians.  </span></span>
<span id="cb11-5"><a href="lab5.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">unitScale</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">;</span></span>
<span id="cb11-6"><a href="lab5.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> amplitude <span class="op">=</span> harmonicTrendCoefficients<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sin&#39;</span>)</span>
<span id="cb11-7"><a href="lab5.html#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">hypot</span>(harmonicTrendCoefficients<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;cos&#39;</span>))  </span>
<span id="cb11-8"><a href="lab5.html#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Add a scale factor for visualization.  </span></span>
<span id="cb11-9"><a href="lab5.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(<span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb11-10"><a href="lab5.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute the mean NDVI.</span></span>
<span id="cb11-11"><a href="lab5.html#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> meanNdvi <span class="op">=</span> filteredLandsat<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb11-12"><a href="lab5.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Use the HSV to RGB transformation to display phase and amplitude.</span></span>
<span id="cb11-13"><a href="lab5.html#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> rgb <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">cat</span>([</span>
<span id="cb11-14"><a href="lab5.html#cb11-14" aria-hidden="true" tabindex="-1"></a>                        phase<span class="op">,</span></span>
<span id="cb11-15"><a href="lab5.html#cb11-15" aria-hidden="true" tabindex="-1"></a>                        amplitude<span class="op">,</span> </span>
<span id="cb11-16"><a href="lab5.html#cb11-16" aria-hidden="true" tabindex="-1"></a>                        meanNdvi</span>
<span id="cb11-17"><a href="lab5.html#cb11-17" aria-hidden="true" tabindex="-1"></a>        ])<span class="op">.</span><span class="fu">hsvToRgb</span>()</span>
<span id="cb11-18"><a href="lab5.html#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(rgb<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;phase (hue), amplitude (sat), ndvi (val)&#39;</span>)<span class="op">;</span></span></code></pre></div>
<blockquote>
<p><strong>Question 2</strong>: Upload the resulting map layer and describe its salient features.</p>
</blockquote>
<hr />
<div id="complex-time-series-modeling" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Complex Time Series Modeling</h3>
<p>A time series can be decomposed as the sum of sinusoids at different frequencies. The harmonic model presented here can be extended by adding bands that represent higher frequencies and the corresponding <code>sin()</code> band for a harmonic component to account for two cycles per year.</p>
<p>You can look at this GEE <a href="https://code.earthengine.google.com/2669122497313113fc4bb81bc8352828">example</a> of using multiple sinusoids to build a more complex harmonic model. Note that each year there is a high peak in June and a secondary peak in January - this harmonic model consisting of two sinusoids with separate frequencies and amplitudes is able to account for that. However, the error values in this model are high and the fit is quite inexact. We can see extreme drops in the NDVI value that the model misses, and several peaks each year that do not fit.</p>
<div class="figure">
<img src="im/im_05_05.png" alt="" />
<p class="caption">Complex Harmonic Model</p>
</div>
<p>More complex harmonic models might not be appropriate due to overfitting - in other words, this model might provide a false sense of comfort in it’s explanatory ability. Time Series modelling of remote sensing data is more difficult than many business or scientific contexts due to masked data, missing data, irregular atmospheric conditions and natural variability.</p>
</div>
<div id="exporting-data" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Exporting Data</h3>
<p>Many of you might be more familiar with building statistical models in other languages or tools, such as Python, R or JMP. After all, JavaScript was not built as a natural statistics tool, and being able to work with the data In that case, you’ll likely want to export the data for your own analysis. There are several ways to do it, but the simplest method is to click the ‘expand into new tab’ button next to the chart that contains the data you want to work with (likely the raw NDVI data) - in the new tab, you can click ‘Download .csv’, which is a datatable that you can use with whichever software you prefer.</p>
<div class="figure">
<img src="im/im_05_06.png" alt="" />
<p class="caption">Exporting Data</p>
</div>
</div>
</div>
<div id="time-series-thresholding" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Time Series Thresholding</h2>
<p>Urban change detection is a burgeoning field in remote sensing that identifies historical urban development and works to predict where future urban development will occur. Remote sensing is a vital partner in this field, as it can provide an unbiased, quantitative assessment of change over time. For instance, <a href="https://www.spiegel.de/international/europe/finding-swimming-pools-with-google-earth-greek-government-hauls-in-billions-in-back-taxes-a-709703.html">Greece</a> is using Google Earth Pro to scour the countryside for signs of tax evaders (ex., a luxury pool built without a permit may indicate sheltered money). Other countries are using classification models in Google Earth Engine to characterize urban development.</p>
<p>In this example, we will go over a simple, but very effective method of identifying urban development, based on real-world experience. In nearby Roanoke (located about 45 minutes east of Virginia Tech), like any other city, there has been significant construction in the past few years. About three years ago, a patch of land was converted from trees and pasture and construction began an assisted living facility. Let’s test to see if we can identify this construction. We will use the Landsat 8 image collection (as we used earlier), and import our test point as <code>var roi</code>. The process of building the chart is the same as earlier, and we will use NDVI as our change metric, as we can hypothesize that new construction will greatly reduce NDVI.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="lab5.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Test area - lat/long acquired from Google Maps</span></span>
<span id="cb12-2"><a href="lab5.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="op">-</span><span class="fl">79.98413</span><span class="op">,</span> <span class="fl">37.2368</span>])<span class="op">;</span></span>
<span id="cb12-3"><a href="lab5.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat_8_sr <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;LANDSAT/LC08/C01/T1_SR&quot;</span>)</span>
<span id="cb12-4"><a href="lab5.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="lab5.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This field contains UNIX time in milliseconds.</span></span>
<span id="cb12-6"><a href="lab5.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timeField <span class="op">=</span> <span class="st">&#39;system:time_start&#39;</span><span class="op">;</span></span>
<span id="cb12-7"><a href="lab5.html#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="lab5.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to cloud mask from the pixel_qa band of Landsat 8 SR data.</span></span>
<span id="cb12-9"><a href="lab5.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskL8sr</span>(image) {</span>
<span id="cb12-10"><a href="lab5.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 3 and 5 are cloud shadow and cloud, respectively.</span></span>
<span id="cb12-11"><a href="lab5.html#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb12-12"><a href="lab5.html#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudsBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb12-13"><a href="lab5.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get the pixel QA band.</span></span>
<span id="cb12-14"><a href="lab5.html#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb12-15"><a href="lab5.html#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb12-16"><a href="lab5.html#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudShadowBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)</span>
<span id="cb12-17"><a href="lab5.html#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudsBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb12-18"><a href="lab5.html#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the masked image, scaled to reflectance, without the QA bands.</span></span>
<span id="cb12-19"><a href="lab5.html#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb12-20"><a href="lab5.html#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B[0-9]*&#39;</span>)</span>
<span id="cb12-21"><a href="lab5.html#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [timeField])<span class="op">;</span></span>
<span id="cb12-22"><a href="lab5.html#cb12-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-23"><a href="lab5.html#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Use this function to add variables for NDVI, time and a constant</span></span>
<span id="cb12-24"><a href="lab5.html#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">// to Landsat 8 imagery.</span></span>
<span id="cb12-25"><a href="lab5.html#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addVariables <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb12-26"><a href="lab5.html#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute time in fractional years since the epoch.</span></span>
<span id="cb12-27"><a href="lab5.html#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> date <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(image<span class="op">.</span><span class="fu">get</span>(timeField))<span class="op">;</span></span>
<span id="cb12-28"><a href="lab5.html#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> years <span class="op">=</span> date<span class="op">.</span><span class="fu">difference</span>(ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;1970-01-01&#39;</span>)<span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">;</span></span>
<span id="cb12-29"><a href="lab5.html#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the image with the added bands.</span></span>
<span id="cb12-30"><a href="lab5.html#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image</span>
<span id="cb12-31"><a href="lab5.html#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add an NDVI band.</span></span>
<span id="cb12-32"><a href="lab5.html#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">addBands</span>(image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;NDVI&#39;</span>))</span>
<span id="cb12-33"><a href="lab5.html#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add a time band.</span></span>
<span id="cb12-34"><a href="lab5.html#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">addBands</span>(ee<span class="op">.</span><span class="fu">Image</span>(years)<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;t&#39;</span>))</span>
<span id="cb12-35"><a href="lab5.html#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">float</span>()</span>
<span id="cb12-36"><a href="lab5.html#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add a constant band.</span></span>
<span id="cb12-37"><a href="lab5.html#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">addBands</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(<span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb12-38"><a href="lab5.html#cb12-38" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb12-39"><a href="lab5.html#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove clouds, add variables and filter to the area of interest.</span></span>
<span id="cb12-40"><a href="lab5.html#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredLandsat <span class="op">=</span> landsat_8_sr</span>
<span id="cb12-41"><a href="lab5.html#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb12-42"><a href="lab5.html#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">map</span>(maskL8sr)</span>
<span id="cb12-43"><a href="lab5.html#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">map</span>(addVariables)<span class="op">;</span></span>
<span id="cb12-44"><a href="lab5.html#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot a time series of NDVI at a single location.</span></span>
<span id="cb12-45"><a href="lab5.html#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l8Chart <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">series</span>(filteredLandsat<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">,</span> roi)</span>
<span id="cb12-46"><a href="lab5.html#cb12-46" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;ScatterChart&#39;</span>)</span>
<span id="cb12-47"><a href="lab5.html#cb12-47" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb12-48"><a href="lab5.html#cb12-48" aria-hidden="true" tabindex="-1"></a>   <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Landsat 8 NDVI Time Series at ROI&#39;</span><span class="op">,</span></span>
<span id="cb12-49"><a href="lab5.html#cb12-49" aria-hidden="true" tabindex="-1"></a>   <span class="dt">trendlines</span><span class="op">:</span> {<span class="dv">0</span><span class="op">:</span> {</span>
<span id="cb12-50"><a href="lab5.html#cb12-50" aria-hidden="true" tabindex="-1"></a>                <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span></span>
<span id="cb12-51"><a href="lab5.html#cb12-51" aria-hidden="true" tabindex="-1"></a>   }}<span class="op">,</span></span>
<span id="cb12-52"><a href="lab5.html#cb12-52" aria-hidden="true" tabindex="-1"></a>   <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb12-53"><a href="lab5.html#cb12-53" aria-hidden="true" tabindex="-1"></a>   <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb12-54"><a href="lab5.html#cb12-54" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb12-55"><a href="lab5.html#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(l8Chart)<span class="op">;</span></span></code></pre></div>
<p>Below is the resulting chart, exactly as expected. NDVI has a max of 0.9 in the summer and a min of 0.4 in the winter, but between March 2018 to April 2018 the NDVI drops from 0.313 to 0.18, and largely stays below this value. In addition, the cyclicality is gone after 2018, and while there are some elevated values in late 2020, that is likely due to atmospheric conditions or sensor calibration. The linear trend is an indication of construction, and perhaps a window function to average out the variability can help identify large drops in the overall average NDVI for this test point.</p>
<div class="figure">
<img src="im/im_05_07.png" alt="" />
<p class="caption">Change Detection</p>
</div>
<p>There are some interesting ways you can expand this general idea - for instance, you might be able to build a system that automatically identifies urban development that occurs when it occurs in your test zone. Global Forest watch is using a similar tactic to automatically detect when there is a large drop in NDVI, and by using MODIS data, they can obtain very high temporal resolution to identify exactly when and where this activity is occuring. Note that different image collections have different time-lines (for instance, Landsat 8 would not be able to detect urban change before 2013), and you may have to set up this system differently.</p>
</div>
<div id="additional-exercises-3" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Additional Exercises</h2>
<blockquote>
<p><strong>Question 3</strong>: Test three different points using Landsat 7, Landsat 8 and MODIS to identify urban development in an area of interest. Do the charts and data provide enough data to determine that urban change occurred?</p>
</blockquote>
<blockquote>
<p><strong>Question 4</strong>: Look in google scholar to identify 2-3 publications that have used a harmonic regression in a time series analysis of remotely sensed data in particular. Provide citations for the articles, and then describe for what purposes was the technique used and what was the justification provided for its use.</p>
</blockquote>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lab6.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/benamie/remote-sense-social/edit/main/06-lab5.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
